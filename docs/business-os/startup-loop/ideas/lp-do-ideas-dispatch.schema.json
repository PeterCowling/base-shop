{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "lp-do-ideas-dispatch.schema.json",
  "title": "lp-do-ideas Dispatch Packet (dispatch.v1)",
  "description": "Dispatch packet emitted by the lp-do-ideas trial orchestrator for each processed standing-artifact delta. All fields labelled required must be present for schema validation to pass.",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "dispatch.v1",
      "description": "Schema version identifier. Must be 'dispatch.v1' in this tranche."
    },
    "dispatch_id": {
      "type": "string",
      "pattern": "^IDEA-DISPATCH-[0-9]{14}-[0-9]{4}$",
      "description": "Unique dispatch identifier. Format: IDEA-DISPATCH-<YYYYMMDDHHmmss>-<seq4>. Example: IDEA-DISPATCH-20260224153000-0001."
    },
    "mode": {
      "type": "string",
      "enum": ["trial"],
      "description": "Operating mode. Only 'trial' is permitted in this tranche. 'live' is reserved for future go-live integration and must be rejected fail-closed."
    },
    "business": {
      "type": "string",
      "minLength": 1,
      "description": "Business identifier. Example: HBAG, BRIK."
    },
    "trigger": {
      "type": "string",
      "enum": ["artifact_delta"],
      "description": "Trigger type. Only 'artifact_delta' is supported in trial mode."
    },
    "artifact_id": {
      "type": "string",
      "minLength": 1,
      "description": "Registered artifact key from the standing registry. Must match an entry in the standing registry."
    },
    "before_sha": {
      "type": "string",
      "minLength": 1,
      "description": "Git commit SHA or content hash of the artifact before the delta."
    },
    "after_sha": {
      "type": "string",
      "minLength": 1,
      "description": "Git commit SHA or content hash of the artifact after the delta."
    },
    "area_anchor": {
      "type": "string",
      "minLength": 1,
      "description": "Feature, component, or system area this dispatch addresses. Required for lp-do-fact-find intake routing."
    },
    "location_anchors": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "minItems": 1,
      "description": "One or more paths, routes, endpoints, or flows relevant to this dispatch. Must be non-empty. Required for lp-do-fact-find intake routing."
    },
    "provisional_deliverable_family": {
      "type": "string",
      "enum": ["code-change", "doc", "multi", "business-artifact", "design", "infra"],
      "description": "Provisional deliverable family for routing and fact-find intake completeness check."
    },
    "current_truth": {
      "type": "string",
      "minLength": 1,
      "description": "Plain-language statement of what is now true after this delta."
    },
    "next_scope_now": {
      "type": "string",
      "minLength": 1,
      "description": "What should be investigated or acted on now in response to this delta."
    },
    "adjacent_later": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "description": "Optional future opportunities identified alongside this dispatch. May be empty."
    },
    "recommended_route": {
      "type": "string",
      "enum": ["lp-do-fact-find", "lp-do-briefing"],
      "description": "Downstream routing recommendation. 'lp-do-fact-find' for planning work; 'lp-do-briefing' for understanding-only work. No other values are valid."
    },
    "status": {
      "type": "string",
      "enum": ["fact_find_ready", "briefing_ready", "auto_executed", "logged_no_action"],
      "description": "Dispatch lifecycle status. Transitions are monotonic: dispatches move forward only."
    },
    "priority": {
      "type": "string",
      "enum": ["P1", "P2", "P3"],
      "description": "Dispatch priority. P1 is highest. Used for escalation path to Option C autonomy mode."
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence score 0.0â€“1.0 for this dispatch being actionable."
    },
    "evidence_refs": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "minItems": 1,
      "description": "One or more artifact paths or anchors supporting this dispatch. Must be non-empty."
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when this dispatch was created."
    },
    "queue_state": {
      "type": "string",
      "enum": ["enqueued", "processed", "skipped", "error"],
      "description": "Current queue lifecycle state for this dispatch."
    }
  },
  "required": [
    "schema_version",
    "dispatch_id",
    "mode",
    "area_anchor",
    "location_anchors",
    "provisional_deliverable_family",
    "recommended_route",
    "status",
    "evidence_refs"
  ],
  "additionalProperties": false
}
