# Environment variable reference

This page describes the environment variables the platform expects. Each variable is read from `.env` files generated for shops and may be required at build or run time.

| Variable | Purpose |
| --- | --- |
| `DATABASE_URL` | PostgreSQL connection string. Required when using Prisma backends; when unset and no `*_BACKEND`/`DB_MODE` force Prisma, data is stored in JSON files. |
| `DB_MODE` | Global default for repository backends (`json` forces filesystem storage, `prisma` forces Prisma when correctly configured). Repo-specific `*_BACKEND` variables override this setting. Any other value causes an error. |
| `DATA_ROOT` | Root directory for per-shop data files. If unset, falls back to `<cwd>/data/shops`. |
| `TEST_DATA_ROOT` | Root directory for test fixtures. Defaults to `__tests__/data/shops`. |
| `INVENTORY_BACKEND` | Explicit backend for inventory (`json` forces JSON/disk storage, `prisma` forces Prisma when correctly configured). When unset, falls back to `DB_MODE` or legacy auto-detection based on `DATABASE_URL`. Any other value causes an error. |
| `PAGES_BACKEND` | Explicit backend for pages (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `SHOP_BACKEND` | Explicit backend for shops (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `PRODUCTS_BACKEND` | Explicit backend for products (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `SETTINGS_BACKEND` | Explicit backend for shop settings (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `THEME_PRESETS_BACKEND` | Explicit backend for theme presets (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `ANALYTICS_BACKEND` | Explicit backend for analytics (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `COUPONS_BACKEND` | Explicit backend for coupons (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `SEO_AUDIT_BACKEND` | Explicit backend for SEO audits (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `PRICING_BACKEND` | Explicit backend for pricing (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `RETURN_LOGISTICS_BACKEND` | Explicit backend for return logistics (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `RETURN_AUTH_BACKEND` | Explicit backend for return authorisation (`json` or `prisma`); when unset, falls back to `DB_MODE` or legacy auto-detection. Any other value causes an error. |
| `STRIPE_SECRET_KEY` | Server-side Stripe API key. |
| `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` | Client-side Stripe key exposed to the browser. |
| `STRIPE_WEBHOOK_SECRET` | Secret used to verify Stripe webhook signatures. |
| `CMS_SPACE_URL` | Base URL of the headless CMS API. |
| `CMS_ACCESS_TOKEN` | Token used to push schemas to the CMS. |
| `SANITY_PROJECT_ID` | Sanity project ID for the optional blog plugin (defaults to `dummy-project-id`). |
| `SANITY_DATASET` | Sanity dataset name (defaults to `production`). |
| `SANITY_API_TOKEN` | Token for Sanity write access (defaults to `dummy-api-token`; unset enables read-only mode). |
| `SANITY_API_VERSION` | API version for the optional Sanity blog plugin. |
| `SANITY_PREVIEW_SECRET` | Secret used to verify Sanity preview requests (defaults to `dummy-preview-secret`). |
| `CART_COOKIE_SECRET` | Secret for signing cart cookies. Required in production. |
| `CART_TTL` | Cart expiration in seconds (defaults to 30 days). |
| `DEPOSIT_RELEASE_ENABLED` | `true` or `false` to toggle automated deposit refunds. |
| `DEPOSIT_RELEASE_INTERVAL_MS` | Interval in milliseconds between deposit refund runs. |
| `REVERSE_LOGISTICS_ENABLED` | `true` or `false` to enable the reverse logistics service. |
| `REVERSE_LOGISTICS_INTERVAL_MS` | Interval in milliseconds for the reverse logistics worker. |
| `LATE_FEE_ENABLED` | `true` or `false` to toggle late fee processing. |
| `LATE_FEE_INTERVAL_MS` | Interval in milliseconds for the late fee job. |
| `LOG_LEVEL` | Logging verbosity (`error`, `warn`, `info`, or `debug`). |
| `EMAIL_PROVIDER` | Campaign email provider (`smtp`, `sendgrid`, or `resend`). |
| `SENDGRID_API_KEY` | API key for SendGrid when using the SendGrid provider. |
| `SENDGRID_MARKETING_KEY` | SendGrid marketing API key for contact and segment endpoints. |
| `RESEND_API_KEY` | API key for Resend when using the Resend provider. |
| `SENDGRID_WEBHOOK_PUBLIC_KEY` | Public key to verify SendGrid webhook signatures. |
| `RESEND_WEBHOOK_SECRET` | Secret used to verify Resend webhook signatures. |
| `NEXTAUTH_SECRET` | Secret for NextAuth session signing (defaults to a dev secret in development; required in production). |
| `SESSION_SECRET` | Secret used to encrypt customer sessions (defaults to a dev secret in development; required in production). |
| `PREVIEW_TOKEN_SECRET` | Secret for HMAC preview tokens (unset disables preview token routes). |
| `CHROMATIC_PROJECT_TOKEN` | Token for publishing Storybook builds to Chromatic. |
| `GA_MEASUREMENT_ID` | Google Analytics measurement ID (without this and `GA_API_SECRET`, events are stored locally). |
| `GA_API_SECRET` | API secret for Google Analytics measurement protocol (without this and `GA_MEASUREMENT_ID`, events are stored locally). |
| `STOCK_ALERT_RECIPIENT` | Email address that receives low stock alerts. Leave unset to disable notifications. |
| `STOCK_ALERT_WEBHOOK` | URL for posting low stock alerts to an external service. |
| `STOCK_ALERT_DEFAULT_THRESHOLD` | Default stock level that triggers alerts. |
| `NEXT_PUBLIC_BASE_URL` | Base URL exposed to the browser for constructing absolute links. |

```env
# DB_MODE=json
# INVENTORY_BACKEND=json
# PAGES_BACKEND=json
# SHOP_BACKEND=json
# PRODUCTS_BACKEND=json
# SETTINGS_BACKEND=json
# THEME_PRESETS_BACKEND=json
# ANALYTICS_BACKEND=json
# COUPONS_BACKEND=json
# SEO_AUDIT_BACKEND=json
# PRICING_BACKEND=json
# RETURN_LOGISTICS_BACKEND=json
# RETURN_AUTH_BACKEND=json
```
