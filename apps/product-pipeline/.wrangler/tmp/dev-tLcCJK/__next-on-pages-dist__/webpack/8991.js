var k={},W=(J,K,Q)=>(k.__chunk_8991=(R,I,L)=>{"use strict";function h(r){let u=function(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){let D=n.trim();if(!D)return null;let l=Number(D);if(Number.isFinite(l))return l}return null}(r);return u===null?null:Math.round(u)}function T(r,u,n){return Math.min(n,Math.max(u,r))}function B(r,u){let n={...u,...r??{}};return{sellThroughDays:T(Math.round(n.sellThroughDays),1,3650),sellThroughTargetPct:T(n.sellThroughTargetPct,0,1),horizonBufferDays:T(Math.round(n.horizonBufferDays),0,3650),salvageValueCents:Math.max(0,Math.round(n.salvageValueCents))}}L.d(I,{a:()=>O});let j={sellThroughDays:90,sellThroughTargetPct:.8,horizonBufferDays:30,salvageValueCents:0};function O({stageB:r,stageC:u,stageM:n,stageS:D,velocityPrior:l,assumptions:M}){let w=function(t){if(!t||typeof t!="object")return null;if("input"in t){let e=t.input;if(e&&typeof e=="object")return e}return t}(r.input),d=function(t){if(!t||typeof t!="object")return null;let e=t.summary;return e&&typeof e=="object"?e:null}(r.output),E=function(t){if(!t||typeof t!="object")return null;let e=t.summary;return e&&typeof e=="object"?e:null}(u.output),g=h(w?.unitsPlanned);if(!g||g<=0)throw Error("missing_units_planned");let C=h(d?.totalLandedCostCents);if(C===null)throw Error("missing_total_landed_cost");let _=h(E?.contributionPerUnitCents);if(_===null)throw Error("missing_contribution_per_unit");let x=h(d?.leadTimeDays??w?.leadTimeDays)??0,S=h(E?.payoutDelayDays)??0,b=h(d?.depositAmountCents??null),P=h(d?.balanceAmountCents??null),z=h(d?.balanceDueDay??null),U=B(M,j),v=M?.sellThroughDays===void 0&&l?.velocityPerDay?function(t,e,s){if(!Number.isFinite(s)||s<=0)return null;let o=Math.max(0,Math.ceil(t*e));return o<=0?null:Math.max(1,Math.ceil(o/s))}(g,U.sellThroughTargetPct,l.velocityPerDay):null,y=v!==null?B({...M??{},sellThroughDays:v},j):U,A=T(Math.max(1,x+y.sellThroughDays+S+y.horizonBufferDays,z??0),1,3650),V=Math.max(0,x),q=Math.max(0,Math.ceil(g*y.sellThroughTargetPct)),N=function({horizonDays:t,salesStartDay:e,sellThroughDays:s,targetUnits:o}){let m=[],c=0;for(let i=0;i<=t;i+=1){let a=0;if(i>e){let p=i-e;a=s<=0||p>=s?o:Math.round(o*p/s)}a<c&&(a=c),a>o&&(a=o),m.push(a),c=a}return m}({horizonDays:A,salesStartDay:V,sellThroughDays:y.sellThroughDays,targetUnits:q}),f=[];b!==null&&P!==null?(b!==0&&f.push({day:0,amountCents:-b}),P!==0&&f.push({day:z??V,amountCents:-P})):C!==0&&f.push({day:0,amountCents:-C}),f.push(...function({unitsSoldByDay:t,contributionPerUnitCents:e,payoutDelayDays:s,horizonDays:o}){let m=[],c=0;for(let i=0;i<t.length;i+=1){let a=t[i]??c,p=a-c;if(c=a,p===0)continue;let F=i+s;F>o||m.push({day:F,amountCents:p*e})}return m}({unitsSoldByDay:N,contributionPerUnitCents:_,payoutDelayDays:S,horizonDays:A})),f.sort((t,e)=>t.day-e.day);let G={horizonDays:A,cashflows:f,unitsPlanned:g,unitsSoldByDay:N,sellThroughTargetPct:y.sellThroughTargetPct,...y.salvageValueCents!==0?{salvageValueCents:y.salvageValueCents}:{}},H={version:"scenario-pack:v1",derivedAt:new Date().toISOString(),sources:{stageB:r,stageC:u,...n?{stageM:n}:{},...D?{stageS:D}:{}},...v!==null&&l?{priors:{velocity:{source:l.source,velocityPerDay:l.velocityPerDay,derivedSellThroughDays:v,unitsSoldTotal:l.unitsSoldTotal??null,maxDay:l.maxDay??null,createdAt:l.createdAt??null,expiresAt:l.expiresAt??null}}}:{},assumptions:y,derived:{unitsPlanned:g,contributionPerUnitCents:_,leadTimeDays:x,payoutDelayDays:S,totalLandedCostCents:C,depositAmountCents:b,balanceAmountCents:P,balanceDueDay:z??null},model:{cashflow:"linear",sellThrough:"linear"}};return{input:G,scenario:H}}},k);export{W as __getNamedExports};
