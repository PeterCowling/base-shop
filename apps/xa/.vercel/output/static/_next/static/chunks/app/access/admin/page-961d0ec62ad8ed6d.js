(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6321],{171:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var s=a(6586),r=a(7826);function o(e){var t;let{monoClassName:a}=e,[o,l]=r.useState(null),[n,i]=r.useState([]),[c,d]=r.useState([]),[u,m]=r.useState(""),[x,p]=r.useState(""),[h,g]=r.useState("1"),[b,v]=r.useState(""),[f,y]=r.useState(null),[k,j]=r.useState(null),[N,w]=r.useState(!1),[S,C]=r.useState(null),E=r.useCallback(async()=>{let e=await fetch("/api/access-admin/session"),t=await e.json();l({authenticated:!!t.authenticated,storeMode:t.storeMode})},[]),P=r.useCallback(async()=>{var e,t;let[a,s]=await Promise.all([fetch("/api/access-admin/invites"),fetch("/api/access-admin/requests")]);if(!a.ok||!s.ok)throw Error("Unable to load admin data.");let r=await a.json(),o=await s.json();i(null!=(e=r.invites)?e:[]),d(null!=(t=o.requests)?t:[])},[]);r.useEffect(()=>{E().catch(()=>l({authenticated:!1}))},[E]),r.useEffect(()=>{(null==o?void 0:o.authenticated)&&P().catch(e=>C(e instanceof Error?e.message:"Load failed"))},[o,P]);let _=async e=>{e.preventDefault(),w(!0),C(null);try{if(!(await fetch("/api/access-admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u})})).ok)throw Error("Unauthorized");await E()}catch(e){C(e instanceof Error?e.message:"Login failed")}finally{w(!1)}},I=async()=>{w(!0),C(null);try{await fetch("/api/access-admin/logout",{method:"POST"}),l({authenticated:!1})}catch(e){C(e instanceof Error?e.message:"Logout failed")}finally{w(!1)}},q=async e=>{e.preventDefault(),w(!0),C(null);try{var t;let e=await fetch("/api/access-admin/invites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:x,maxUses:h?Number(h):void 0,expiresAt:b||void 0})});if(!e.ok)throw Error("Invite creation failed");let a=await e.json();y(null!=(t=a.code)?t:null),j(x||"Manual issue"),await P()}catch(e){C(e instanceof Error?e.message:"Invite creation failed")}finally{w(!1)}},O=async e=>{if(confirm("Revoke this key?")){w(!0),C(null);try{if(!(await fetch("/api/access-admin/invites/".concat(e,"/revoke"),{method:"POST"})).ok)throw Error("Revoke failed");await P()}catch(e){C(e instanceof Error?e.message:"Revoke failed")}finally{w(!1)}}},M=async(e,t)=>{w(!0),C(null);try{var a;let s=await fetch("/api/access-admin/requests/".concat(e,"/issue"),{method:"POST"});if(!s.ok)throw Error("Issue failed");let r=await s.json();y(null!=(a=r.code)?a:null),j(t?"Request: ".concat(t):"Request issue"),await P()}catch(e){C(e instanceof Error?e.message:"Issue failed")}finally{w(!1)}},T=async e=>{w(!0),C(null);try{if(!(await fetch("/api/access-admin/requests/".concat(e,"/dismiss"),{method:"POST"})).ok)throw Error("Dismiss failed");await P()}catch(e){C(e instanceof Error?e.message:"Dismiss failed")}finally{w(!1)}},R=async()=>{if(f)try{await navigator.clipboard.writeText(f)}catch(e){C("Copy failed")}};return null===o?(0,s.jsx)("div",{className:"text-sm text-[color:var(--gate-muted)]",children:"Checking console access..."}):o.authenticated?(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:"Console active"}),(0,s.jsxs)("div",{className:"text-sm text-[color:var(--gate-ink)]",children:["Storage: ",null!=(t=null==o?void 0:o.storeMode)?t:"unknown"]})]}),(0,s.jsx)("button",{type:"button",onClick:I,className:"rounded-md border border-border-2 px-4 py-2 text-xs uppercase tracking-[0.3em] text-[color:var(--gate-ink)] transition hover:underline",children:"Exit console"})]}),f?(0,s.jsxs)("div",{className:"rounded-md border border-border-2 bg-muted p-4 text-sm",children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:"Latest key issued"}),(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-[color:var(--gate-ink)]",children:[(0,s.jsx)("span",{className:a,children:f}),k?(0,s.jsx)("span",{className:"text-xs text-[color:var(--gate-muted)]",children:k}):null,(0,s.jsx)("button",{type:"button",onClick:R,className:"rounded-md border border-border-2 px-3 py-1 text-xs uppercase tracking-[0.3em] text-[color:var(--gate-ink)]",children:"Copy"})]})]}):null,(0,s.jsxs)("section",{className:"rounded-xl border border-border-2 bg-white p-6 shadow-elevation-1",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.35em] text-[color:var(--gate-muted)]",children:"Issue a key"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-[color:var(--gate-muted)]",children:"Create single-use or multi-use keys with optional expiry."})]}),(0,s.jsx)("button",{type:"button",onClick:()=>P().catch(()=>null),className:"rounded-md border border-border-2 px-3 py-1 text-xs uppercase tracking-[0.3em] text-[color:var(--gate-ink)]",children:"Refresh"})]}),(0,s.jsxs)("form",{onSubmit:q,className:"mt-6 grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("label",{className:"block text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:["Label",(0,s.jsx)("input",{value:x,onChange:e=>p(e.target.value),placeholder:"Inner circle",className:"mt-2 w-full rounded-md border border-border-2 bg-white px-3 py-2 text-sm text-[color:var(--gate-ink)] placeholder:text-[color:var(--gate-muted)] focus:border-[color:var(--gate-ink)] focus:outline-none focus:ring-2 focus:ring-[color:var(--gate-ink)]/20"})]}),(0,s.jsxs)("label",{className:"block text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:["Max uses",(0,s.jsx)("input",{value:h,onChange:e=>g(e.target.value),type:"number",min:"1",className:"mt-2 w-full rounded-md border border-border-2 bg-white px-3 py-2 text-sm text-[color:var(--gate-ink)] focus:border-[color:var(--gate-ink)] focus:outline-none focus:ring-2 focus:ring-[color:var(--gate-ink)]/20"})]}),(0,s.jsxs)("label",{className:"block text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:["Expires",(0,s.jsx)("input",{value:b,onChange:e=>v(e.target.value),type:"datetime-local",className:"mt-2 w-full rounded-md border border-border-2 bg-white px-3 py-2 text-sm text-[color:var(--gate-ink)] focus:border-[color:var(--gate-ink)] focus:outline-none focus:ring-2 focus:ring-[color:var(--gate-ink)]/20"})]}),(0,s.jsx)("button",{type:"submit",disabled:N,className:"md:col-span-3 inline-flex items-center justify-center rounded-md border border-[color:var(--gate-ink)] bg-[color:var(--gate-ink)] px-4 py-2 text-sm font-semibold text-white transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:N?"Creating...":"Generate key"})]})]}),(0,s.jsxs)("section",{className:"rounded-xl border border-border-2 bg-white p-6 shadow-elevation-1",children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.35em] text-[color:var(--gate-muted)]",children:"Pending requests"}),(0,s.jsxs)("div",{className:"mt-4 space-y-4",children:[0===c.length?(0,s.jsx)("div",{className:"text-sm text-[color:var(--gate-muted)]",children:"No pending signals."}):null,c.map(e=>(0,s.jsxs)("div",{className:"rounded-md border border-border-2 bg-muted p-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"text-[color:var(--gate-ink)]",children:[e.handle||"Anonymous"," ",(0,s.jsxs)("span",{className:"text-xs text-[color:var(--gate-muted)]",children:["(",new Date(e.createdAt).toLocaleString(),")"]})]}),(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.2em] text-[color:var(--gate-muted)]",children:e.status})]}),(0,s.jsx)("div",{className:"mt-2 text-[color:var(--gate-muted)]",children:e.referredBy?"Sent by: ".concat(e.referredBy):"No referrer"}),(0,s.jsx)("div",{className:"mt-2 text-[color:var(--gate-ink)]",children:e.note}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>M(e.id,e.handle),disabled:N||"pending"!==e.status,className:"rounded-md border border-[color:var(--gate-ink)] bg-[color:var(--gate-ink)] px-3 py-1 text-xs uppercase tracking-[0.3em] text-white transition hover:opacity-90 disabled:opacity-50",children:"Issue key"}),(0,s.jsx)("button",{type:"button",onClick:()=>T(e.id),disabled:N||"pending"!==e.status,className:"rounded-md border border-border-2 px-3 py-1 text-xs uppercase tracking-[0.3em] text-[color:var(--gate-ink)] disabled:opacity-50",children:"Dismiss"}),e.requestIp?(0,s.jsx)("span",{className:"text-[10px] uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:e.requestIp}):null]})]},e.id))]})]}),(0,s.jsxs)("section",{className:"rounded-xl border border-border-2 bg-white p-6 shadow-elevation-1",children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-[0.35em] text-[color:var(--gate-muted)]",children:"Issued keys"}),(0,s.jsxs)("div",{className:"mt-4 space-y-3 text-sm",children:[0===n.length?(0,s.jsx)("div",{className:"text-[color:var(--gate-muted)]",children:"No issued keys."}):null,n.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-md border border-border-2 bg-muted p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-[color:var(--gate-ink)]",children:[e.label||"Untitled"," ",(0,s.jsxs)("span",{className:"text-xs text-[color:var(--gate-muted)]",children:["• ",e.codeHint]})]}),(0,s.jsxs)("div",{className:"text-xs text-[color:var(--gate-muted)]",children:[e.uses,"/",null!=(t=e.maxUses)?t:"∞"," uses \xb7 ",e.status]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>O(e.id),disabled:N||"active"!==e.status,className:"rounded-md border border-border-2 px-3 py-1 text-xs uppercase tracking-[0.3em] text-[color:var(--gate-ink)] disabled:opacity-50",children:"Revoke"})]},e.id)})]})]}),S?(0,s.jsx)("div",{className:"text-sm text-red-700",children:S}):null]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"text-sm text-[color:var(--gate-muted)]",children:"Admin access requires the console token."}),(0,s.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,s.jsxs)("label",{className:"block text-xs uppercase tracking-[0.3em] text-[color:var(--gate-muted)]",children:["Console token",(0,s.jsx)("input",{value:u,onChange:e=>m(e.target.value),className:"mt-2 w-full rounded-md border border-border-2 bg-white px-3 py-3 text-sm text-[color:var(--gate-ink)] placeholder:text-[color:var(--gate-muted)] focus:border-[color:var(--gate-ink)] focus:outline-none focus:ring-2 focus:ring-[color:var(--gate-ink)]/20",autoComplete:"off"})]}),(0,s.jsx)("button",{type:"submit",disabled:N,className:"inline-flex items-center gap-2 rounded-md border border-[color:var(--gate-ink)] bg-[color:var(--gate-ink)] px-4 py-2 text-sm font-semibold text-white transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:N?"Verifying...":"Enter console"}),S?(0,s.jsx)("div",{className:"text-sm text-red-700",children:S}):null]})]})}},2603:e=>{e.exports={style:{fontFamily:"'IBM Plex Mono', 'IBM Plex Mono Fallback'",fontStyle:"normal"},className:"__className_05908d"}},2823:e=>{e.exports={adminFade:"admin_adminFade__RFoyP"}},4095:(e,t,a)=>{Promise.resolve().then(a.bind(a,171)),Promise.resolve().then(a.t.bind(a,55,23)),Promise.resolve().then(a.t.bind(a,9386,23)),Promise.resolve().then(a.t.bind(a,2603,23)),Promise.resolve().then(a.t.bind(a,2823,23))},9386:e=>{e.exports={style:{fontFamily:"'Work Sans', 'Work Sans Fallback'",fontStyle:"normal"},className:"__className_f9d2a6"}}},e=>{var t=t=>e(e.s=t);e.O(0,[113,55,9956,2889,7358],()=>t(4095)),_N_E=e.O()}]);