(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{308:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(8510),a=r(5211),n=r.n(a),i=r(4284),l=r(3246);function o(){let e=(0,i.useSearchParams)(),t=(0,l.useMemo)(()=>e.get("token")||e.get("t")||"",[e]),[r,a]=(0,l.useState)("loading"),[o,u]=(0,l.useState)(null),[c,m]=(0,l.useState)(""),[d,h]=(0,l.useState)(!1),[g,x]=(0,l.useState)("");async function b(e){if(e.preventDefault(),c.trim()&&t){h(!0),u(null);try{let e=await fetch("/api/guest-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,lastName:c.trim()})});if(!e.ok){if(403===e.status)throw Error("That last name does not match our booking.");if(429===e.status)throw Error("Too many attempts. Please try again later.");throw Error("Verification failed. Please try again.")}let r=await e.json();localStorage.setItem("prime_guest_token",t),localStorage.setItem("prime_guest_booking_id",r.bookingId),r.guestUuid&&localStorage.setItem("prime_guest_uuid",r.guestUuid),r.guestFirstName&&localStorage.setItem("prime_guest_first_name",r.guestFirstName),localStorage.setItem("prime_guest_verified_at",new Date().toISOString()),x(r.guestFirstName||""),a("verified")}catch(e){u(e instanceof Error?e.message:"Verification failed.")}finally{h(!1)}}}return((0,l.useEffect)(()=>{if(!t){u("Missing or invalid link."),a("error");return}let e=!0;return async function(){try{let r=await fetch("/api/guest-session?token=".concat(encodeURIComponent(t)));if(!r.ok){if(404===r.status)throw Error("This link is no longer valid.");if(410===r.status)throw Error("This link has expired.");throw Error("Unable to validate this link.")}e&&a("ready")}catch(t){e&&(u(t instanceof Error?t.message:"Unable to validate this link."),a("error"))}}(),()=>{e=!1}},[t]),"loading"===r)?(0,s.jsx)("main",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-4",children:(0,s.jsx)("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):"error"===r?(0,s.jsx)("main",{className:"min-h-screen bg-gray-50 p-4",children:(0,s.jsxs)("div",{className:"mx-auto max-w-md rounded-xl bg-white p-6 text-center shadow-sm",children:[(0,s.jsx)("h1",{className:"mb-2 text-2xl font-bold text-gray-900",children:"Link problem"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:o}),(0,s.jsx)(n(),{href:"/find-my-stay",className:"inline-flex items-center justify-center rounded-lg bg-blue-600 px-5 py-3 text-white hover:bg-blue-700",children:"Find my stay"})]})}):"verified"===r?(0,s.jsx)("main",{className:"min-h-screen bg-gray-50 p-4",children:(0,s.jsxs)("div",{className:"mx-auto max-w-md rounded-xl bg-white p-6 text-center shadow-sm",children:[(0,s.jsx)("h1",{className:"mb-2 text-2xl font-bold text-gray-900",children:g?"Welcome, ".concat(g):"You're in"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:"Your portal is ready. We'll guide you through arrival prep next."}),(0,s.jsx)(n(),{href:"/portal",className:"inline-flex items-center justify-center rounded-lg bg-blue-600 px-5 py-3 text-white hover:bg-blue-700",children:"Continue"})]})}):(0,s.jsx)("main",{className:"min-h-screen bg-gray-50 p-4",children:(0,s.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,s.jsxs)("div",{className:"mb-6 text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Confirm your stay"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Please enter the last name on the booking to continue."})]}),(0,s.jsxs)("form",{onSubmit:b,className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,s.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700",children:"Last name"}),(0,s.jsx)("input",{id:"lastName",type:"text",value:c,onChange:e=>m(e.target.value),placeholder:"Enter your last name",className:"mt-2 w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200",disabled:d}),o&&(0,s.jsx)("div",{className:"mt-4 rounded-lg bg-red-50 p-3 text-sm text-red-700",children:o}),(0,s.jsx)("button",{type:"submit",disabled:d||!c.trim(),className:"mt-5 w-full rounded-lg bg-blue-600 px-4 py-3 text-white hover:bg-blue-700 disabled:opacity-50",children:d?"Checking...":"Continue"})]})]})})}function u(){return(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("main",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-4",children:(0,s.jsx)("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}),children:(0,s.jsx)(o,{})})}},4284:(e,t,r)=>{"use strict";var s=r(5868);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},7652:(e,t,r)=>{Promise.resolve().then(r.bind(r,308))}},e=>{var t=t=>e(e.s=t);e.O(0,[211,493,597,358],()=>t(7652)),_N_E=e.O()}]);