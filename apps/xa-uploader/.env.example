# ============================================================================
# XA Uploader — Environment Variable Reference
# ============================================================================
#
# HOW TO USE THIS FILE
#
# For LOCAL DEVELOPMENT (non-production):
#   Copy to .env.local and fill in only what you need.
#   The 5 session/cookie secrets auto-generate randomly in non-production, so
#   you typically don't need to set them for local dev.
#
# For CLOUDFLARE WORKER DEPLOYMENT (production):
#   SECRETS: Run `wrangler secret put <VAR>` for each required secret.
#     Do NOT put secret values in this file or in wrangler.toml.
#   NON-SECRETS: Set public/optional vars in wrangler.toml [vars].
#
# For LOCAL PRODUCTION BUILD (NODE_ENV=production, CI env var unset):
#   The 5 secrets enforced at build time (marked below) must be present in
#   .env.local at build time, in addition to `wrangler secret put` for runtime.
#   CI builds (GitHub Actions) skip this check automatically (CI=true is set).
#
# IMPORTANT — NEXT_PUBLIC VARS:
#   NEXT_PUBLIC_* vars are baked into the client bundle at build time by
#   Next.js. Setting them only in wrangler.toml [vars] after deploy does NOT
#   update client-visible values — you must rebuild with these vars present in
#   the build environment for client-side changes to take effect.
# ============================================================================


# ============================================================================
# REQUIRED SECRETS
# Never commit real values. Set via `wrangler secret put` for CF deployment.
# For local production builds, also set in .env.local at build time.
# ============================================================================

# Session cookie signing key — HMAC-SHA256 (minimum 32 characters, strong random)
# CF production: wrangler secret put XA_UPLOADER_SESSION_SECRET
# CF preview:    wrangler secret put XA_UPLOADER_SESSION_SECRET --env preview
XA_UPLOADER_SESSION_SECRET=your-session-secret-min-32-chars-here

# Admin login credential (minimum 32 characters, strong random)
# CF production: wrangler secret put XA_UPLOADER_ADMIN_TOKEN
# CF preview:    wrangler secret put XA_UPLOADER_ADMIN_TOKEN --env preview
XA_UPLOADER_ADMIN_TOKEN=your-admin-token-min-32-chars-here

# NextAuth.js session secret — required by shared Next.js platform config (min 32 chars)
# Auto-generated randomly in non-production (local dev / CI). Required for production CF deployment.
# CF production: wrangler secret put NEXTAUTH_SECRET
# CF preview:    wrangler secret put NEXTAUTH_SECRET --env preview
NEXTAUTH_SECRET=your-nextauth-secret-min-32-chars-here

# Session encryption secret — required by shared platform config (min 32 chars)
# Auto-generated randomly in non-production. Required for production CF deployment.
# CF production: wrangler secret put SESSION_SECRET
# CF preview:    wrangler secret put SESSION_SECRET --env preview
SESSION_SECRET=your-session-secret-min-32-chars-here

# Cart cookie signing secret — required by shared platform config
# Auto-generated randomly in non-production. Required for production CF deployment.
# CF production: wrangler secret put CART_COOKIE_SECRET
# CF preview:    wrangler secret put CART_COOKIE_SECRET --env preview
CART_COOKIE_SECRET=your-cart-cookie-secret-here

# Catalog contract endpoint URL — PUT destination for publishing the product catalog
# Set to the URL of your XA catalog contract service.
# Sync returns HTTP 503 "unconfigured" if this is missing or empty.
# CF production: wrangler secret put XA_CATALOG_CONTRACT_BASE_URL
# CF preview:    wrangler secret put XA_CATALOG_CONTRACT_BASE_URL --env preview
XA_CATALOG_CONTRACT_BASE_URL=https://your-catalog-contract-endpoint.example.com

# Catalog contract write token — Bearer token sent as X-XA-Catalog-Token header
# Sync returns HTTP 503 "unconfigured" if this is missing or empty.
# CF production: wrangler secret put XA_CATALOG_CONTRACT_WRITE_TOKEN
# CF preview:    wrangler secret put XA_CATALOG_CONTRACT_WRITE_TOKEN --env preview
XA_CATALOG_CONTRACT_WRITE_TOKEN=your-catalog-contract-write-token-here


# ============================================================================
# OPTIONAL SECRETS (vendor mode only)
# Set via `wrangler secret put` only if using vendor mode.
# ============================================================================

# Separate login token for vendor mode. Falls back to XA_UPLOADER_ADMIN_TOKEN if unset.
# CF production: wrangler secret put XA_UPLOADER_VENDOR_TOKEN
# CF preview:    wrangler secret put XA_UPLOADER_VENDOR_TOKEN --env preview
# XA_UPLOADER_VENDOR_TOKEN=your-vendor-token-here


# ============================================================================
# NEXT_PUBLIC VARS — client-side + server runtime
# Safe to commit (no secrets). Add to wrangler.toml [vars] for deployment.
# NOTE: These are BUILD-TIME INLINED by Next.js for client-side code. To change
# client-visible behavior, set these in the build environment before running
# `opennextjs-cloudflare build` — setting them only in wrangler.toml [vars]
# after deploy will NOT update client bundle values without a rebuild.
# ============================================================================

# Client-side mode indicator. Set to "vendor" for vendor deployments.
# Default: empty (internal mode)
NEXT_PUBLIC_XA_UPLOADER_MODE=

# Minimum image edge for client-side pre-validation (pixels, string)
# Default: "1600"
NEXT_PUBLIC_XA_UPLOADER_MIN_IMAGE_EDGE=1600

# R2 destination path displayed in the submission UI (display text only — NOT the enablement toggle)
# Set to the R2 bucket path when enabling R2 upload (e.g. "r2://my-bucket/uploads")
# Default: "" (shows a placeholder hint in the UI)
NEXT_PUBLIC_XA_UPLOADER_R2_DESTINATION=

# R2 upload URL — THIS IS THE ENABLEMENT TOGGLE for R2 image upload
# Empty string = R2 upload feature disabled (default)
# Set to the presigned upload URL to enable R2 image submission
NEXT_PUBLIC_XA_UPLOADER_R2_UPLOAD_URL=


# ============================================================================
# OPTIONAL SERVER VARS — safe for wrangler.toml [vars]
# These tune behaviour without exposing secrets. Defaults shown.
# ============================================================================

# Deployment mode. Set to "vendor" to enable vendor mode (hides sync, uses vendor token for auth)
# Default: empty (internal mode)
XA_UPLOADER_MODE=

# HTTP timeout for catalog contract publish requests (milliseconds)
# Default: 20000
# XA_CATALOG_CONTRACT_TIMEOUT_MS=20000

# Timeout for the validate phase of the sync script (milliseconds)
# Default: 45000
# XA_UPLOADER_SYNC_VALIDATE_TIMEOUT_MS=45000

# Timeout for the full sync script run (milliseconds)
# Default: 300000 (5 minutes)
# XA_UPLOADER_SYNC_TIMEOUT_MS=300000

# Max bytes of sync log output captured in the response
# Default: 131072 (128 KB)
# XA_UPLOADER_SYNC_LOG_MAX_BYTES=131072

# Set to "1" to include sync stdout/stderr in non-production responses (debugging)
# Default: off (empty)
# XA_UPLOADER_EXPOSE_SYNC_LOGS=

# Max files scanned in a submission zip
# Default: 10000
# XA_UPLOADER_MAX_FILES_SCANNED=10000

# Max files per product spec in a submission
# Default: 500
# XA_UPLOADER_MAX_FILES_PER_SPEC=500

# Max images per product in a submission
# Default: 100
# XA_UPLOADER_MAX_IMAGES_PER_PRODUCT=100

# Max total images across an entire submission
# Default: 400
# XA_UPLOADER_MAX_IMAGES_PER_SUBMISSION=400

# Minimum image edge for server-side validation (pixels)
# Default: 1600
# XA_UPLOADER_MIN_IMAGE_EDGE=1600

# Comma-separated additional allowed image root paths (beyond the default base dir)
# Default: empty (base directory only)
# XA_UPLOADER_ALLOWED_IMAGE_ROOTS=

# Max in-memory rate limit tracking keys
# Default: 20000
# XA_UPLOADER_RATE_LIMIT_MAX_KEYS=20000

# Set to "1" to trust Cloudflare IP headers (CF-Connecting-IP) for rate limiting
# Default: off (empty). Safe to enable when deployed on Cloudflare Workers.
# XA_TRUST_PROXY_IP_HEADERS=1

# Optional uploader ingress allowlist (comma-separated source IPs).
# When set, requests from non-allowlisted IPs are denied.
# XA_UPLOADER_ALLOWED_IPS=203.0.113.10,198.51.100.15


# ============================================================================
# LOCAL DEV / FILESYSTEM-ONLY — .env.local ONLY
# These vars use filesystem paths and are NOT valid in Cloudflare Worker deployments.
# Do NOT add to wrangler.toml [vars].
# ============================================================================

# Override the products CSV path (absolute or repo-relative).
# Only meaningful in environments with direct filesystem access (local dev, CI).
# Default: apps/xa-uploader/data/products.<storefront>.csv
# XA_UPLOADER_PRODUCTS_CSV_PATH=/path/to/products.csv

# Override the Next.js .next dist output directory (build tooling only).
# Default: .next
# XA_UPLOADER_NEXT_DIST_DIR=.next


# ============================================================================
# DEV / E2E TESTING ONLY — NEVER set in production
# ============================================================================

# Override the admin token in non-production for E2E test auth bypass.
# Only active when NODE_ENV !== 'production'. Setting this in production has no effect,
# but for safety: NEVER include this in any production secret store.
# XA_UPLOADER_E2E_ADMIN_TOKEN=e2e-test-token-for-local-use-only
