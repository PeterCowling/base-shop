(self.webpackChunkcms_monorepo=self.webpackChunkcms_monorepo||[]).push([[8484],{"./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/script.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/client/script.js")},"./node_modules/.pnpm/ulid@3.0.1/node_modules/ulid/dist/browser/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z0:()=>ulid});const ENCODING="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ENCODING_LEN=32,RANDOM_LEN=16,TIME_LEN=10,TIME_MAX=0xffffffffffff;var ULIDErrorCode;!function(ULIDErrorCode){ULIDErrorCode.Base32IncorrectEncoding="B32_ENC_INVALID",ULIDErrorCode.DecodeTimeInvalidCharacter="DEC_TIME_CHAR",ULIDErrorCode.DecodeTimeValueMalformed="DEC_TIME_MALFORMED",ULIDErrorCode.EncodeTimeNegative="ENC_TIME_NEG",ULIDErrorCode.EncodeTimeSizeExceeded="ENC_TIME_SIZE_EXCEED",ULIDErrorCode.EncodeTimeValueMalformed="ENC_TIME_MALFORMED",ULIDErrorCode.PRNGDetectFailure="PRNG_DETECT",ULIDErrorCode.ULIDInvalid="ULID_INVALID",ULIDErrorCode.Unexpected="UNEXPECTED",ULIDErrorCode.UUIDInvalid="UUID_INVALID"}(ULIDErrorCode||(ULIDErrorCode={}));class ULIDError extends Error{constructor(errorCode,message){super(`${message} (${errorCode})`),this.name="ULIDError",this.code=errorCode}}function randomChar(prng){const randomPosition=Math.floor(prng()*ENCODING_LEN)%ENCODING_LEN;return ENCODING.charAt(randomPosition)}function detectPRNG(root){const rootLookup=function detectRoot(){if(function inWebWorker(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}())return self;if("undefined"!=typeof window)return window;if(void 0!==__webpack_require__.g)return __webpack_require__.g;if("undefined"!=typeof globalThis)return globalThis;return null}(),globalCrypto=rootLookup&&(rootLookup.crypto||rootLookup.msCrypto)||null;if("function"==typeof globalCrypto?.getRandomValues)return()=>{const buffer=new Uint8Array(1);return globalCrypto.getRandomValues(buffer),buffer[0]/255};if("function"==typeof globalCrypto?.randomBytes)return()=>globalCrypto.randomBytes(1).readUInt8()/255;throw new ULIDError(ULIDErrorCode.PRNGDetectFailure,"Failed to find a reliable PRNG")}function encodeRandom(len,prng){let str="";for(;len>0;len--)str=randomChar(prng)+str;return str}function encodeTime(now,len=TIME_LEN){if(isNaN(now))throw new ULIDError(ULIDErrorCode.EncodeTimeValueMalformed,`Time must be a number: ${now}`);if(now>TIME_MAX)throw new ULIDError(ULIDErrorCode.EncodeTimeSizeExceeded,`Cannot encode a time larger than ${TIME_MAX}: ${now}`);if(now<0)throw new ULIDError(ULIDErrorCode.EncodeTimeNegative,`Time must be positive: ${now}`);if(!1===Number.isInteger(now))throw new ULIDError(ULIDErrorCode.EncodeTimeValueMalformed,`Time must be an integer: ${now}`);let mod,str="";for(let currentLen=len;currentLen>0;currentLen--)mod=now%ENCODING_LEN,str=ENCODING.charAt(mod)+str,now=(now-mod)/ENCODING_LEN;return str}function ulid(seedTime,prng){const currentPRNG=prng||detectPRNG();return encodeTime(!seedTime||isNaN(seedTime)?Date.now():seedTime,TIME_LEN)+encodeRandom(RANDOM_LEN,currentPRNG)}},"./packages/ui/src/components/cms/page-builder/devtools/DevToolsOverlay.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),_DevToolsOverlay__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/ui/src/components/cms/page-builder/devtools/DevToolsOverlay.tsx"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js");function Harness(){const scrollRef=(0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{try{localStorage.setItem("pb:devtools","1")}catch(e){}},[]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"relative h-80 border border-dashed border-muted",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{id:"canvas",className:"relative h-full w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{id:"container-1",className:"absolute left-6 top-6 h-20 w-32 border border-muted"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{id:"container-2",className:"absolute left-52 top-40 h-24 w-36 border border-muted"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{"data-component-id":"a",className:"absolute left-20 top-16 h-10 w-16 border border-info"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{"data-component-id":"b",className:"absolute left-72 top-10 h-12 w-12 border border-info"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_DevToolsOverlay__WEBPACK_IMPORTED_MODULE_1__.A,{scrollRef})]})}const __WEBPACK_DEFAULT_EXPORT__={component:_DevToolsOverlay__WEBPACK_IMPORTED_MODULE_1__.A,tags:["autodocs"],parameters:{docs:{description:{component:"Developer overlay for Page Builder. Story pre-enables the overlay and renders a synthetic canvas with droppable containers and items."}}}},Default={render:()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Harness,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <Harness />\n}",...Default.parameters?.docs?.source}}}},"./packages/ui/src/components/cms/page-builder/devtools/DevToolsOverlay.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>DevToolsOverlay});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),_acme_i18n__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/i18n/src/index.ts"),_hooks_usePageBuilderDnD__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/ui/src/components/cms/page-builder/hooks/usePageBuilderDnD.ts");function getCanvas(){try{return document.getElementById("canvas")}catch(e){return null}}function measure(el,relativeTo){const r=el.getBoundingClientRect();return relativeTo?{left:r.left-relativeTo.left,top:r.top-relativeTo.top,width:r.width,height:r.height}:{left:r.left,top:r.top,width:r.width,height:r.height}}function DevToolsOverlay({scrollRef}){const t=(0,_acme_i18n__WEBPACK_IMPORTED_MODULE_2__.c3)(),[enabled,setEnabled]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(()=>{try{return"1"===localStorage.getItem("pb:devtools")}catch(e){return!1}}),[fps,setFps]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0),[droppables,setDroppables]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),[items,setItems]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),[scrollBands,setScrollBands]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)({}),loopRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),lastRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(Date.now());(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{const onKey=e=>{e.altKey&&(e.ctrlKey||e.metaKey)&&"d"===e.key.toLowerCase()&&(e.preventDefault(),setEnabled(v=>{const next=!v;try{localStorage.setItem("pb:devtools",next?"1":"0")}catch(e){}return next}))};return window.addEventListener("keydown",onKey),()=>window.removeEventListener("keydown",onKey)},[]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!enabled)return;const tick=()=>{const now=Date.now(),dt=now-lastRef.current;lastRef.current=now;const curr=dt>0?Math.round(1e3/dt):0;setFps(p=>.8*p+.2*curr);const canvas=getCanvas(),baseRect=null==canvas?void 0:canvas.getBoundingClientRect();try{const d=[];document.querySelectorAll('[id^="container-"]').forEach(el=>{baseRect&&d.push(measure(el,baseRect))}),setDroppables(d)}catch(e){}try{const i=[];document.querySelectorAll("[data-component-id]").forEach(el=>{baseRect&&i.push(measure(el,baseRect))}),setItems(i)}catch(e){}try{var _scrollRef_current,_ref;const sc=null!==(_ref=null!==(_scrollRef_current=null==scrollRef?void 0:scrollRef.current)&&void 0!==_scrollRef_current?_scrollRef_current:null==canvas?void 0:canvas.closest(".overscroll-contain"))&&void 0!==_ref?_ref:null;if(sc){const r=sc.getBoundingClientRect(),band=_hooks_usePageBuilderDnD__WEBPACK_IMPORTED_MODULE_3__.wM;setScrollBands({top:{left:0,top:0,width:r.width,height:band},bottom:{left:0,top:r.height-band,width:r.width,height:band},left:{left:0,top:0,width:band,height:r.height},right:{left:r.width-band,top:0,width:band,height:r.height}})}else setScrollBands({})}catch(e){}loopRef.current=requestAnimationFrame(tick)};return loopRef.current=requestAnimationFrame(tick),()=>{loopRef.current&&cancelAnimationFrame(loopRef.current)}},[enabled,scrollRef]);const canvas=getCanvas(),baseRect=null==canvas?void 0:canvas.getBoundingClientRect();return enabled&&canvas&&baseRect?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"relative pointer-events-none","aria-hidden":!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"absolute inset-0",children:[droppables.map(b=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute border border-purple-500/60",style:{left:b.left,top:b.top,width:b.width,height:b.height}},`drop-${b.left}-${b.top}-${b.width}-${b.height}`)),items.map(b=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute border border-emerald-500/60",style:{left:b.left,top:b.top,width:b.width,height:b.height}},`item-${b.left}-${b.top}-${b.width}-${b.height}`)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"absolute start-2 top-2 rounded bg-black/70 px-2 py-1 text-xs text-white shadow",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:"DevTools ON"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:["FPS ~ ",Math.round(fps)]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:["Droppables: ",droppables.length," Items: ",items.length]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:t("pb.devtools.toggleHint")})]}),(()=>{var _scrollRef_current;const sc=null!==(_scrollRef_current=null==scrollRef?void 0:scrollRef.current)&&void 0!==_scrollRef_current?_scrollRef_current:canvas.closest(".overscroll-contain");if(!sc)return null;const r=sc.getBoundingClientRect(),s=scrollBands;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"pointer-events-none absolute",style:{left:r.left-baseRect.left,top:r.top-baseRect.top,width:r.width,height:r.height},children:[s.top&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute bg-cyan-500/10",style:{left:s.top.left,top:s.top.top,width:s.top.width,height:s.top.height}}),s.bottom&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute bg-cyan-500/10",style:{left:s.bottom.left,top:s.bottom.top,width:s.bottom.width,height:s.bottom.height}}),s.left&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute bg-cyan-500/10",style:{left:s.left.left,top:s.left.top,width:s.left.width,height:s.left.height}}),s.right&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute bg-cyan-500/10",style:{left:s.right.left,top:s.right.top,width:s.right.width,height:s.right.height}})]})})()]})}):null}DevToolsOverlay.__docgenInfo={description:"",methods:[],displayName:"DevToolsOverlay",props:{scrollRef:{required:!1,tsType:{name:"ReactRefObject",raw:"React.RefObject<HTMLDivElement | null>",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}]},description:"Optional scroll container to draw autoscroll thresholds. If omitted, tries to infer."}}}},"./packages/ui/src/components/cms/page-builder/gridSnap.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>snapToGrid});const snapToGrid=(value,gridSize)=>Math.round(value/gridSize)*gridSize},"./packages/ui/src/components/cms/page-builder/hooks/usePageBuilderDnD.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{wM:()=>AUTOSCROLL_EDGE_PX,Ay:()=>hooks_usePageBuilderDnD});var core_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+core@6.3.1_react-dom@19.2.0-canary-3fbfb9ba-20250409_react@19.2.0-canary-3fbfb_fe9249e4a42fbe7e42b4e4091f9a4c62/node_modules/@dnd-kit/core/dist/core.esm.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),gridSnap=__webpack_require__("./packages/ui/src/components/cms/page-builder/gridSnap.ts"),rules=__webpack_require__("./packages/ui/src/components/cms/page-builder/rules.ts"),coords=__webpack_require__("./packages/ui/src/components/cms/page-builder/utils/coords.ts"),sortable_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+sortable@10.0.0_@dnd-kit+core@6.3.1_react-dom@19.2.0-canary-3fbfb9ba-20250409__571aab38212e666fc4f105bb05843619/node_modules/@dnd-kit/sortable/dist/sortable.esm.js");const AUTOSCROLL_EDGE_PX=48;function speedForDistance(d,edge,maxSpeed){const within=Math.max(0,edge-d);return within>0?Math.ceil(within/edge*maxSpeed):0}function safeDispatchEvent(name,detail){try{window.dispatchEvent(new CustomEvent(name,{detail}))}catch(e){}}var isHiddenForViewport=__webpack_require__("./packages/ui/src/components/cms/page-builder/state/layout/utils/isHiddenForViewport.ts");function hasChildren(c){return Array.isArray(c.children)}function findById(list,id){for(const c of list){if(c.id===id)return c;const children=hasChildren(c)?c.children:void 0;if(children){const found=findById(children,id);if(found)return found}}return null}function findParentId(list,target,pid){for(const c of list){if(c.id===target)return pid;const children=c.children;if(Array.isArray(children)){const res=findParentId(children,target,c.id);if(void 0!==res)return res}}}function getTypeOfId(list,id){if(!id)return null;const node=findById(list,String(id));return(null==node?void 0:node.type)||null}function getVisibleComponents(list,editor,viewport){return list.filter(c=>!(0,isHiddenForViewport.E)(c.id,editor,c.hidden,viewport))}function resolveParentKind(components,parentId){var _findById;return parentId?(null===(_findById=findById(components,parentId))||void 0===_findById?void 0:_findById.type)||"":"ROOT"}var browser=__webpack_require__("./node_modules/.pnpm/ulid@3.0.1/node_modules/ulid/dist/browser/index.js");const noop=()=>{};const hooks_usePageBuilderDnD=function usePageBuilderDnD({components,dispatch,defaults,containerTypes,selectId,gridSize=1,canvasRef,setSnapPosition=noop,editor,viewport,scrollRef,zoom=1,t}){const sensors=function useDndSensors(){return(0,core_esm.FR)((0,core_esm.MS)(core_esm.AN,{activationConstraint:{distance:6}}),(0,core_esm.MS)(core_esm.uN,{coordinateGetter:sortable_esm.JR}))}(),[insertIndex,setInsertIndex]=(0,react.useState)(null),[insertParentId,setInsertParentId]=(0,react.useState)(void 0),[activeType,setActiveType]=(0,react.useState)(null),[dragMeta,setDragMeta]=(0,react.useState)(null),[currentOverId,setCurrentOverId]=(0,react.useState)(null),[dropAllowed,setDropAllowed]=(0,react.useState)(null),zoomRef=(0,react.useRef)(zoom);(0,react.useEffect)(()=>{zoomRef.current=zoom},[zoom]);const{addIframeShields,removeIframeShields}=function useIframeShields(canvasRef){const iframeShieldsRef=(0,react.useRef)([]);return{addIframeShields:(0,react.useCallback)(()=>{try{var _canvasRef_current;const root=null!==(_canvasRef_current=null==canvasRef?void 0:canvasRef.current)&&void 0!==_canvasRef_current?_canvasRef_current:"undefined"!=typeof document?document.getElementById("canvas"):null;if(!root)return;const iframes=root.querySelectorAll("iframe"),shields=[];iframes.forEach(frame=>{const r=frame.getBoundingClientRect(),base=root.getBoundingClientRect(),shield=document.createElement("div");shield.className="pb-iframe-shield";const style={position:"absolute",left:r.left-base.left+"px",top:r.top-base.top+"px",width:`${r.width}px`,height:`${r.height}px`,zIndex:"50",background:"transparent",pointerEvents:"auto"};Object.assign(shield.style,style),root.appendChild(shield),shields.push(shield)}),iframeShieldsRef.current=shields}catch(e){}},[canvasRef]),removeIframeShields:(0,react.useCallback)(()=>{try{iframeShieldsRef.current.forEach(el=>{var _el_parentElement;return null===(_el_parentElement=el.parentElement)||void 0===_el_parentElement?void 0:_el_parentElement.removeChild(el)})}catch(e){}iframeShieldsRef.current=[]},[])}}(canvasRef),lastTabHoverRef=function useLastTabHover(){const lastTabHoverRef=(0,react.useRef)(null);return(0,react.useEffect)(()=>{const onHover=e=>{try{const ce=e;(null==ce?void 0:ce.detail)&&"string"==typeof ce.detail.parentId&&"number"==typeof ce.detail.tabIndex&&(lastTabHoverRef.current={parentId:ce.detail.parentId,tabIndex:ce.detail.tabIndex})}catch(e){}};return window.addEventListener("pb-tab-hover",onHover),()=>window.removeEventListener("pb-tab-hover",onHover)},[]),lastTabHoverRef}(),handleDragMove=(0,react.useCallback)(ev=>{var _canvasRef_current;const{over,delta,activatorEvent}=ev;if(!over||!function isPointerEvent(ev){return!!ev&&"clientX"in ev&&"clientY"in ev}(activatorEvent))return setCurrentOverId(null),void setDropAllowed(null);const overData=over.data.current,visible=getVisibleComponents(components,editor,viewport),rawYScreen=activatorEvent.clientY+delta.y,rawXScreen=activatorEvent.clientX+delta.x,canvasRect=null==canvasRef||null===(_canvasRef_current=canvasRef.current)||void 0===_canvasRef_current?void 0:_canvasRef_current.getBoundingClientRect(),pointerXCanvas=(canvasRect?(0,coords.eG)({x:rawXScreen,y:rawYScreen},canvasRect,zoomRef.current):{x:rawXScreen,y:rawYScreen}).x,snapX=(0,gridSnap.E)(pointerXCanvas,gridSize);setSnapPosition(snapX),function autoScroll(scrollRef,pageX,pageY,edge=AUTOSCROLL_EDGE_PX,maxSpeed=28){try{const sc=null==scrollRef?void 0:scrollRef.current;if(!sc)return;const rect=sc.getBoundingClientRect(),topDist=Math.max(0,pageY-rect.top),bottomDist=Math.max(0,rect.bottom-pageY),leftDist=Math.max(0,pageX-rect.left),rightDist=Math.max(0,rect.right-pageX),vUp=speedForDistance(topDist,edge,maxSpeed),vDown=speedForDistance(bottomDist,edge,maxSpeed),vLeft=speedForDistance(leftDist,edge,maxSpeed),vRight=speedForDistance(rightDist,edge,maxSpeed);vUp&&pageY<rect.top+edge?sc.scrollBy({top:-vUp,behavior:"auto"}):vDown&&pageY>rect.bottom-edge&&sc.scrollBy({top:vDown,behavior:"auto"}),vLeft&&pageX<rect.left+edge?sc.scrollBy({left:-vLeft,behavior:"auto"}):vRight&&pageX>rect.right-edge&&sc.scrollBy({left:vRight,behavior:"auto"})}catch(e){}}(scrollRef,rawXScreen,rawYScreen,AUTOSCROLL_EDGE_PX,28);try{"undefined"!=typeof localStorage&&"1"===localStorage.getItem("pb:devtools")&&safeDispatchEvent("pb-dev:drag-move",{t:Date.now(),x:rawXScreen,y:rawYScreen,overId:over.id})}catch(e){}let parentId;if(setCurrentOverId(String(over.id)),"canvas"===over.id)parentId=void 0;else{const overId=over.id.toString();parentId=overId.startsWith("container-")?overId.replace(/^container-/,""):findParentId(components,overId,void 0)}const parentKind=resolveParentKind(components,parentId),a=ev.active.data.current;let allowed=null;if("palette"===(null==a?void 0:a.from))allowed=!a.type||(0,rules.WL)(parentKind,a.type);else if("library"===(null==a?void 0:a.from)){const arr=a.templates&&a.templates.length?a.templates:a.template?[a.template]:[];allowed=arr&&arr.length?arr.every(n=>(0,rules.WL)(parentKind,n.type)):null}else{const movingType=getTypeOfId(components,ev.active.id)||(null==a?void 0:a.type);allowed=movingType?(0,rules.WL)(parentKind,movingType):null}if(setDropAllowed(allowed),"canvas"===over.id)return setInsertParentId(void 0),void setInsertIndex(visible.length);if(over.id.toString().startsWith("container-")){const pid=parentId;if(setInsertParentId(pid),pid){const parent=findById(components,pid),children=parent&&Array.isArray(parent.children)?getVisibleComponents(parent.children,editor,viewport):[];setInsertIndex(children.length)}else setInsertIndex(visible.length);return}const isBelow=rawYScreen>over.rect.top+over.rect.height/2;var _overData_index;const index=(null!==(_overData_index=null==overData?void 0:overData.index)&&void 0!==_overData_index?_overData_index:visible.length)+(isBelow?1:0);setInsertParentId(parentId),setInsertIndex(index)},[components,gridSize,canvasRef,setSnapPosition,editor,viewport,scrollRef]),handleDragEndInternal=(0,react.useCallback)(ev=>{if(setInsertIndex(null),setSnapPosition(null),removeIframeShields(),dragMeta){var _ev_active,_ev_active1,_ev_active2,_ev_active3;const dataRef=null===(_ev_active=ev.active)||void 0===_ev_active?void 0:_ev_active.data,existing=dataRef&&dataRef.current&&"object"==typeof dataRef.current?dataRef.current:{};var _existing_from;const from=null!==(_existing_from=existing.from)&&void 0!==_existing_from?_existing_from:dragMeta.from,patched={...existing};from&&(patched.from=from),"palette"!==from&&"library"!==from||!dragMeta.type?void 0===patched.type&&dragMeta.type&&(patched.type=dragMeta.type):patched.type=dragMeta.type,void 0!==(null===(_ev_active1=ev.active)||void 0===_ev_active1?void 0:_ev_active1.id)&&null!==(null===(_ev_active2=ev.active)||void 0===_ev_active2?void 0:_ev_active2.id)||!dragMeta.id||(ev.active.id=dragMeta.id),dataRef?dataRef.current=patched:(null===(_ev_active3=ev.active)||void 0===_ev_active3?void 0:_ev_active3.data)&&(ev.active.data.current=patched)}!function finalizeDrop({ev,components,dispatch,defaults,containerTypes,selectId,t,lastTabHoverRef}){const{active,over}=ev;if(!over)return;const a=active.data.current,o=over.data.current||{};let parentId=o.parentId,index=o.index;if("canvas"===over.id)parentId=void 0,index=components.length;else if(void 0===parentId){parentId=over.id.toString().replace(/^container-/,"");const parent=findById(components,parentId);if(index=parent&&hasChildren(parent)?parent.children.length:0,!(over.id.toString().startsWith("container-")||parent&&hasChildren(parent))){const overId=over.id.toString(),actualParentId=findParentId(components,overId,void 0);if(parentId=actualParentId,parentId){const p=findById(components,parentId),children=p&&hasChildren(p)?p.children:[];index=Math.max(0,children.findIndex(c=>c.id===overId))}else index=Math.max(0,components.findIndex(c=>c.id===overId))}}const parentKind=resolveParentKind(components,parentId);if("palette"===(null==a?void 0:a.from)){var _lastTabHoverRef_current;const isContainer=containerTypes.includes(a.type);if(!(0,rules.WL)(parentKind,a.type))return void safeDispatchEvent("pb-live-message","function"==typeof t?t("cannotPlace",{type:a.type}):`Cannot place ${a.type} here`);var _defaults_a_type;const component={id:(0,browser.Z0)(),type:a.type,...null!==(_defaults_a_type=defaults[a.type])&&void 0!==_defaults_a_type?_defaults_a_type:{},...isContainer?{children:[]}:{}};if(parentId&&(null===(_lastTabHoverRef_current=lastTabHoverRef.current)||void 0===_lastTabHoverRef_current?void 0:_lastTabHoverRef_current.parentId)===parentId){const parent=findById(components,parentId);parent&&("Tabs"===parent.type||"TabsAccordionContainer"===parent.type)&&(component.slotKey=String(lastTabHoverRef.current.tabIndex))}return dispatch({type:"add",component,parentId,index:null!=index?index:0}),void selectId(component.id)}if("library"===(null==a?void 0:a.from)&&(a.template||a.templates&&a.templates.length)){var _lastTabHoverRef_current1;const cloneWithIds=node=>{const cloned={...node,id:(0,browser.Z0)()},children=node.children;return Array.isArray(children)&&(cloned.children=children.map(cloneWithIds)),cloned},clones=(a.templates&&a.templates.length?a.templates:a.template?[a.template]:[]).map(cloneWithIds),invalid=clones.find(c=>!(0,rules.WL)(parentKind,c.type));if(invalid)return void safeDispatchEvent("pb-live-message","function"==typeof t?t("cannotPlace",{type:String(invalid.type)}):`Cannot place ${String(invalid.type)} here`);if(parentId&&(null===(_lastTabHoverRef_current1=lastTabHoverRef.current)||void 0===_lastTabHoverRef_current1?void 0:_lastTabHoverRef_current1.parentId)===parentId){const parent=findById(components,parentId);parent&&("Tabs"===parent.type||"TabsAccordionContainer"===parent.type)&&clones.forEach(c=>{c.slotKey=String(lastTabHoverRef.current.tabIndex)})}let insertedFirstId=null;return clones.forEach((component,i)=>{dispatch({type:"add",component,parentId,index:(null!=index?index:0)+i}),insertedFirstId||(insertedFirstId=component.id)}),void(insertedFirstId&&selectId(insertedFirstId))}if("canvas"===(null==a?void 0:a.from)){var _lastTabHoverRef_current2;let toIndex=null!=index?index:0;a.parentId===parentId&&a.index<(null!=index?index:0)&&(toIndex=(null!=index?index:0)-1);const movingType=getTypeOfId(components,ev.active.id)||a.type;if(movingType&&!(0,rules.WL)(parentKind,movingType))return void safeDispatchEvent("pb-live-message","function"==typeof t?t("cannotMove",{type:String(movingType)}):`Cannot move ${String(movingType)} here`);if(dispatch({type:"move",from:{parentId:a.parentId,index:a.index},to:{parentId,index:toIndex}}),parentId&&(null===(_lastTabHoverRef_current2=lastTabHoverRef.current)||void 0===_lastTabHoverRef_current2?void 0:_lastTabHoverRef_current2.parentId)===parentId){const parent=findById(components,parentId);if(parent&&("Tabs"===parent.type||"TabsAccordionContainer"===parent.type)){const movedId=String(ev.active.id);dispatch({type:"update",id:movedId,patch:{slotKey:String(lastTabHoverRef.current.tabIndex)}}),safeDispatchEvent("pb-live-message","function"==typeof t?t("movedToTab",{n:String(lastTabHoverRef.current.tabIndex+1)}):`Moved to tab ${lastTabHoverRef.current.tabIndex+1}`)}}}}({ev,components,dispatch,defaults,containerTypes,selectId,t,lastTabHoverRef})},[dispatch,components,containerTypes,defaults,selectId,setSnapPosition,t,removeIframeShields,lastTabHoverRef,dragMeta]),handleDragStart=(0,react.useCallback)(ev=>{var _a_templates;const a=ev.active.data.current;var _a_type,_a_from,_a_thumbnail;setActiveType(null!==(_a_type=null==a?void 0:a.type)&&void 0!==_a_type?_a_type:null),setDragMeta({from:null!==(_a_from=null==a?void 0:a.from)&&void 0!==_a_from?_a_from:"canvas",type:null==a?void 0:a.type,count:Array.isArray(null==a?void 0:a.templates)?null==a||null===(_a_templates=a.templates)||void 0===_a_templates?void 0:_a_templates.length:(null==a?void 0:a.template)?1:void 0,id:String(ev.active.id),label:null==a?void 0:a.label,thumbnail:null!==(_a_thumbnail=null==a?void 0:a.thumbnail)&&void 0!==_a_thumbnail?_a_thumbnail:null}),setCurrentOverId(null),setDropAllowed(null),addIframeShields(),safeDispatchEvent("pb-drag-start")},[addIframeShields]),handleDragEnd=(0,react.useCallback)(ev=>{setActiveType(null),handleDragEndInternal(ev),setCurrentOverId(null),setDropAllowed(null),setDragMeta(null),safeDispatchEvent("pb-drag-end")},[handleDragEndInternal]),handleDragCancel=(0,react.useCallback)(()=>{setInsertIndex(null),setSnapPosition(null),setActiveType(null),setCurrentOverId(null),setDropAllowed(null),setDragMeta(null),removeIframeShields(),safeDispatchEvent("pb-live-message","function"==typeof t?t("canceled"):"Canceled")},[setSnapPosition,t,removeIframeShields]),dndContext={sensors,collisionDetection:core_esm.fp,onDragStart:handleDragStart,onDragMove:handleDragMove,onDragEnd:handleDragEnd,onDragCancel:handleDragCancel};return{sensors,handleDragStart,handleDragMove,handleDragEnd,handleDragCancel,insertIndex,insertParentId,activeType,dragMeta,dropAllowed,currentOverId,dndContext}}},"./packages/ui/src/components/cms/page-builder/rules.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ai:()=>isTopLevelAllowed,WL:()=>canDropChild,gw:()=>getAllowedChildren});var _blocks__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./packages/ui/src/components/cms/blocks/index.ts");const SECTIONS_ONLY="true"===__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js").env.NEXT_PUBLIC_PB_SECTIONS_ONLY,ATOMS=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__.ll)),MOLECULES=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__.GF)),ORGANISMS=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__.I2)),CONTAINERS=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__.RR)),LAYOUT=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__._g)),OVERLAYS=new Set(Object.keys(_blocks__WEBPACK_IMPORTED_MODULE_0__.ch)),CONTENT=new Set([...ATOMS,...MOLECULES,...ORGANISMS,...OVERLAYS]),set=list=>new Set(list),ALLOWED={ROOT:set(["Section",...SECTIONS_ONLY?[]:["Canvas"]]),Section:set(["MultiColumn","StackFlex","Grid","CarouselContainer","TabsAccordionContainer","Dataset","Repeater","Bind",...Array.from(CONTENT)]),Canvas:set(["MultiColumn","StackFlex","Grid","CarouselContainer","TabsAccordionContainer","Dataset","Repeater","Bind",...Array.from(CONTENT)]),MultiColumn:set(Array.from(CONTENT)),StackFlex:set(Array.from(CONTENT)),Grid:set(Array.from(CONTENT)),CarouselContainer:set(Array.from(CONTENT)),TabsAccordionContainer:set(Array.from(CONTENT)),Dataset:set(Array.from(CONTENT)),Repeater:set(Array.from(CONTENT)),Bind:set(Array.from(CONTENT))};function getAllowedChildren(parent){return ALLOWED[parent]?ALLOWED[parent]:CONTAINERS.has(parent)||LAYOUT.has(parent)?new Set(CONTENT):new Set}function canDropChild(parent,child){return getAllowedChildren(parent).has(child)}function isTopLevelAllowed(t){return canDropChild("ROOT",t)}},"./packages/ui/src/components/cms/page-builder/state/layout/utils/isHiddenForViewport.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function isHiddenForViewport(id,editor,fallbackHidden,viewport){const flags=null==editor?void 0:editor[id];return flags&&flags.hidden?viewport?flags.hidden.includes(viewport):flags.hidden.length>0:!!fallbackHidden}__webpack_require__.d(__webpack_exports__,{E:()=>isHiddenForViewport})},"./packages/ui/src/components/cms/page-builder/utils/coords.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function screenToCanvas(client,canvasRect,zoom=1){return{x:(client.x-canvasRect.left)/Math.max(zoom,1e-4),y:(client.y-canvasRect.top)/Math.max(zoom,1e-4)}}function rectScreenToCanvas(rect,canvasRect,zoom=1){return{left:(rect.left-canvasRect.left)/Math.max(zoom,1e-4),top:(rect.top-canvasRect.top)/Math.max(zoom,1e-4),width:rect.width/Math.max(zoom,1e-4),height:rect.height/Math.max(zoom,1e-4)}}function normalizeDragDelta(start,current,zoom=1){return{x:(current.x-start.x)/Math.max(zoom,1e-4),y:(current.y-start.y)/Math.max(zoom,1e-4)}}function rectsIntersect(a,b){const ax2=a.left+a.width,ay2=a.top+a.height,bx2=b.left+b.width,by2=b.top+b.height;return a.left<bx2&&ax2>b.left&&a.top<by2&&ay2>b.top}__webpack_require__.d(__webpack_exports__,{TT:()=>rectsIntersect,eG:()=>screenToCanvas,kf:()=>normalizeDragDelta,sc:()=>rectScreenToCanvas})}}]);