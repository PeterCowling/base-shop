// functions/tsconfig.json
{
  "extends": "../tsconfig.base.json",

  "compilerOptions": {
    /* referenced-project requirements */
    "composite": true,
    "emitDeclarationOnly": true /* .d.ts only */,
    "noEmit": false,

    /* Cloudflare Workers runtime */
    "types": ["@cloudflare/workers-types", "node"],
    "lib": ["es2022", "webworker"] /* avoid DOM duplication */,
    "skipLibCheck": true /* suppress 3rd-party clang */,

    /* module / output */
    "module": "esnext",
    "moduleResolution": "node",
    "outDir": "dist",
    "declarationMap": true,

    /*
     * Override path mappings for the email package.
     *
     * The default tsconfig.base.json maps `@acme/email` to the package's `src` folder.
     * When compiling the Workers in the `functions` package, that mapping pulls
     * TypeScript source files from outside this package's `rootDir`, which triggers
     * the "File is not under 'rootDir'" error (TS6059). To avoid this,
     * remap `@acme/email` to the package root. TypeScript will then resolve
     * module imports using the package's `types` field (pointing at `dist/index.d.ts`)
     * rather than the `.ts` sources. This keeps all compiled `.ts` inputs within
     * the configured `rootDir` and sidesteps TS6059.
     */
    "baseUrl": ".",
    "paths": {
      "@acme/email": ["../packages/email"]
    }
  },

  /* build these libraries first */
  "references": [
    { "path": "../packages/types" },
    { "path": "../packages/platform-core" },
    { "path": "../packages/lib" },
    { "path": "../packages/config" },
    { "path": "../packages/email" }
  ],

  /* production Workers source only */
  "include": ["src/**/*.ts"],
  "exclude": ["dist", "__tests__/**"]
}
