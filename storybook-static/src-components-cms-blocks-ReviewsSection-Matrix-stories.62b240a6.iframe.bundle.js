"use strict";(self.webpackChunkcms_monorepo=self.webpackChunkcms_monorepo||[]).push([[7310],{"./packages/ui/src/components/cms/blocks/ReviewsSection.Matrix.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,RTL:()=>RTL,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ReviewsSection_Matrix_stories});var ReviewsSection=__webpack_require__("./packages/ui/src/components/cms/blocks/ReviewsSection.tsx"),createStories=__webpack_require__("./packages/ui/src/story-utils/createStories.ts");const ReviewsSection_fixtures_namespaceObject=JSON.parse('{"provider":"custom","minRating":0,"showAggregate":true,"emitJsonLd":true,"items":[{"id":"r1","author":"Alice","rating":5,"title":"Great","body":"Loved it","createdAt":"2025-01-01"},{"id":"r2","author":"Bob","rating":4,"title":"Solid","body":"Pretty good","createdAt":"2025-02-10"}]}');var types=__webpack_require__("./node_modules/.pnpm/zod@3.25.73/node_modules/zod/v3/types.js"),console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");const meta={title:"CMS Blocks/ReviewsSection/Matrix",component:ReviewsSection.A,tags:["autodocs"],args:{provider:"custom",items:ReviewsSection_fixtures_namespaceObject.items,showAggregate:!0,emitJsonLd:!0},parameters:{docs:{description:{component:"Product reviews list with optional aggregate rating and JSON-LD."}}}},ReviewsSection_Matrix_stories=meta,baseArgs=meta.args,ReviewSchema=types.Ik({id:types.Yj(),author:types.Yj().optional(),rating:types.ai().optional(),title:types.Yj().optional(),body:types.Yj().optional(),createdAt:types.Yj().optional()}),FixtureSchema=types.Ik({provider:types.k5(["custom","yotpo","okendo"]).optional(),productId:types.Yj().optional(),items:types.YO(ReviewSchema).optional(),minRating:types.ai().optional(),showAggregate:types.zM().optional(),emitJsonLd:types.zM().optional()});try{FixtureSchema.parse(ReviewsSection_fixtures_namespaceObject)}catch(e){console.error("Invalid ReviewsSection fixture:",e)}const Default=(0,createStories.T)(baseArgs,{},"default",{a11y:!0,viewports:["desktop"],tags:["visual"]}),RTL=(0,createStories.T)(baseArgs,{},"default",{rtl:!0,viewports:["mobile1"],tags:["visual"]}),__namedExportsOrder=["Default","RTL"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {}, 'default', {\n  a11y: true,\n  viewports: ['desktop'],\n  tags: ['visual']\n})",...Default.parameters?.docs?.source}}},RTL.parameters={...RTL.parameters,docs:{...RTL.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {}, 'default', {\n  rtl: true,\n  viewports: ['mobile1'],\n  tags: ['visual']\n})",...RTL.parameters?.docs?.source}}}},"./packages/ui/src/components/cms/blocks/ReviewsSection.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ReviewsSection});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js");function renderJsonLd(items,aggregate){const blocks=[];if(aggregate&&Number.isFinite(aggregate.ratingValue)&&Number.isFinite(aggregate.reviewCount)){const agg={"@context":"https://schema.org","@type":"AggregateRating",ratingValue:aggregate.ratingValue,reviewCount:aggregate.reviewCount};blocks.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(agg)}},"agg"))}if(items.length){const list={"@context":"https://schema.org","@type":"ItemList",itemListElement:items.slice(0,20).map(r=>({"@type":"Review",author:r.author?{"@type":"Person",name:r.author}:void 0,reviewRating:"number"==typeof r.rating?{"@type":"Rating",ratingValue:r.rating}:void 0,datePublished:r.createdAt,name:r.title,reviewBody:r.body}))};blocks.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(list)}},"reviews"))}return blocks}function ReviewsSection({provider="custom",productId,items:inputItems=[],minRating=0,showAggregate=!0,emitJsonLd=!0,adapter,className,...rest}){const[items,setItems]=react__WEBPACK_IMPORTED_MODULE_1__.useState(inputItems),[aggregate,setAggregate]=react__WEBPACK_IMPORTED_MODULE_1__.useState(void 0);react__WEBPACK_IMPORTED_MODULE_1__.useEffect(()=>{let cancelled=!1;return(async()=>{try{if("custom"===provider){if(setItems(inputItems),!showAggregate)return;const ratings=inputItems.map(r=>{var _r_rating;return null!==(_r_rating=r.rating)&&void 0!==_r_rating?_r_rating:0}).filter(n=>n>0),avg=ratings.length?ratings.reduce((a,b)=>a+b,0)/ratings.length:0;return void(cancelled||setAggregate({ratingValue:Number(avg.toFixed(2)),reviewCount:ratings.length}))}if("function"==typeof adapter){const res=await adapter({provider,productId});var _res_items;if(!cancelled)setItems(null!==(_res_items=res.items)&&void 0!==_res_items?_res_items:[]),showAggregate&&setAggregate(res.aggregate)}else cancelled||(setItems([]),showAggregate&&setAggregate(void 0))}catch(e){cancelled||(setItems([]),setAggregate(void 0))}})(),()=>{cancelled=!0}},[provider,productId,inputItems,showAggregate,adapter]);const filtered=items.filter(r=>{var _r_rating;return(null!==(_r_rating=r.rating)&&void 0!==_r_rating?_r_rating:0)>=minRating}),agg=aggregate;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("section",{className,...rest,children:[emitJsonLd?renderJsonLd(filtered,agg):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"mx-auto w-full space-y-6",children:[showAggregate&&agg?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center gap-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"text-xl font-semibold",children:[agg.ratingValue.toFixed(1)," / 5"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"text-sm text-neutral-600",children:(count=agg.reviewCount,`Based on ${count} reviews`)})]}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("ul",{className:"space-y-4",children:filtered.map(r=>{var _r_author;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("li",{className:"rounded border p-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-start justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"font-medium",children:null!==(_r_author=r.author)&&void 0!==_r_author?_r_author:"Anonymous"}),"number"==typeof r.rating?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"text-sm",children:"â˜…".repeat(Math.round(r.rating))}):null]}),r.title?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mt-1 font-semibold",children:r.title}):null,r.body?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-2 text-sm text-neutral-700",children:r.body}):null,r.createdAt?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mt-2 text-xs text-neutral-500",children:new Date(r.createdAt).toLocaleDateString()}):null]},r.id)})})]})]});var count}ReviewsSection.__docgenInfo={description:"",methods:[],displayName:"ReviewsSection",props:{provider:{required:!1,tsType:{name:"union",raw:'"custom" | "yotpo" | "okendo"',elements:[{name:"literal",value:'"custom"'},{name:"literal",value:'"yotpo"'},{name:"literal",value:'"okendo"'}]},description:"",defaultValue:{value:'"custom"',computed:!1}},productId:{required:!1,tsType:{name:"string"},description:""},items:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  id: string;\n  author?: string;\n  rating?: number; // 1-5\n  title?: string;\n  body?: string;\n  createdAt?: string;\n}",signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"author",value:{name:"string",required:!1}},{key:"rating",value:{name:"number",required:!1}},{key:"title",value:{name:"string",required:!1}},{key:"body",value:{name:"string",required:!1}},{key:"createdAt",value:{name:"string",required:!1}}]}}],raw:"Review[]"},description:"",defaultValue:{value:"[]",computed:!1}},minRating:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},showAggregate:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},emitJsonLd:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},adapter:{required:!1,tsType:{name:"signature",type:"function",raw:"(opts: { provider: Provider; productId?: string }) => Promise<{ items: Review[]; aggregate?: Aggregate }>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ provider: Provider; productId?: string }",signature:{properties:[{key:"provider",value:{name:"union",raw:'"custom" | "yotpo" | "okendo"',elements:[{name:"literal",value:'"custom"'},{name:"literal",value:'"yotpo"'},{name:"literal",value:'"okendo"'}],required:!0}},{key:"productId",value:{name:"string",required:!1}}]}},name:"opts"}],return:{name:"Promise",elements:[{name:"signature",type:"object",raw:"{ items: Review[]; aggregate?: Aggregate }",signature:{properties:[{key:"items",value:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  id: string;\n  author?: string;\n  rating?: number; // 1-5\n  title?: string;\n  body?: string;\n  createdAt?: string;\n}",signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"author",value:{name:"string",required:!1}},{key:"rating",value:{name:"number",required:!1}},{key:"title",value:{name:"string",required:!1}},{key:"body",value:{name:"string",required:!1}},{key:"createdAt",value:{name:"string",required:!1}}]}}],raw:"Review[]",required:!0}},{key:"aggregate",value:{name:"signature",type:"object",raw:"{ ratingValue: number; reviewCount: number }",signature:{properties:[{key:"ratingValue",value:{name:"number",required:!0}},{key:"reviewCount",value:{name:"number",required:!0}}]},required:!1}}]}}],raw:"Promise<{ items: Review[]; aggregate?: Aggregate }>"}}},description:""}}}},"./packages/ui/src/story-utils/createStories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function makeStateStory(base,patch,state,opts={}){const{a11y=!0,critical=!1,rtl=!1,viewports=[],tags=[],docsDescription}=opts,parameters={a11y:{disable:!a11y},dataState:state};rtl&&(parameters.rtl=!0),viewports.length&&(parameters.viewport={defaultViewport:viewports[0]}),docsDescription&&(parameters.docs={description:{story:docsDescription}});const computedTags=["autodocs",a11y?"a11y":"no-a11y",critical?"critical":"noncritical",...tags];parameters.chromatic={disable:!computedTags.includes("visual")};return{args:{...base,...patch},parameters,tags:computedTags}}__webpack_require__.d(__webpack_exports__,{T:()=>makeStateStory})}}]);