"use strict";(self.webpackChunkcms_monorepo=self.webpackChunkcms_monorepo||[]).push([[1660],{"./packages/platform-core/src/components/shop/AddToCartButton.client.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>AddToCartButton});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),_contexts_CartContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/platform-core/src/contexts/CartContext.tsx"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),react_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react-dom/index.js");function AddToCartButton({sku,size,disabled=!1,quantity=1}){const[,dispatch]=(0,_contexts_CartContext__WEBPACK_IMPORTED_MODULE_3__._)(),btnRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),[adding,setAdding]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),[forceDisabled,setForceDisabled]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{const el=btnRef.current;if(!el)return;const isDisabled=forceDisabled||adding||!!disabled;el.disabled=isDisabled;try{isDisabled?el.setAttribute("disabled",""):el.removeAttribute("disabled")}catch(e){}},[adding,forceDisabled,disabled]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("fieldset",{disabled:forceDisabled||adding||disabled,className:"border-0 m-0 p-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{ref:btnRef,onClick:async function handleClick(_e){if(!disabled)if(quantity<1)setError("Quantity must be at least 1");else{(0,react_dom__WEBPACK_IMPORTED_MODULE_2__.flushSync)(()=>{setForceDisabled(!0)}),(0,react_dom__WEBPACK_IMPORTED_MODULE_2__.flushSync)(()=>{setAdding(!0),setError(null)});try{await dispatch({type:"add",sku,size,qty:quantity})}catch(err){var _err_message;setError(null!==(_err_message=err.message)&&void 0!==_err_message?_err_message:"Unable to add to cart")}finally{(0,react_dom__WEBPACK_IMPORTED_MODULE_2__.flushSync)(()=>{setAdding(!1)}),(0,react_dom__WEBPACK_IMPORTED_MODULE_2__.flushSync)(()=>{setAdding(!1),setForceDisabled(!1)})}}},disabled:forceDisabled||adding||disabled,"aria-disabled":!!(forceDisabled||adding||disabled)||void 0,"aria-label":"Add to cart",className:"mt-auto rounded bg-gray-900 px-4 py-2 text-sm text-white hover:bg-gray-800 disabled:opacity-50 min-h-10 min-w-10",children:adding?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{className:"inline-flex items-center gap-2","aria-live":"polite",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"Adding..."," "]}):"Add to cart"})}),error&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-2 text-sm text-red-600",role:"alert",children:error})]})}AddToCartButton.__docgenInfo={description:"",methods:[],displayName:"AddToCartButton",props:{sku:{required:!0,tsType:{name:"z.infer",elements:[{name:"skuSchema"}],raw:"z.infer<typeof skuSchema>"},description:""},size:{required:!1,tsType:{name:"string"},description:"Optional selected size"},disabled:{required:!1,tsType:{name:"boolean"},description:"Disable button until prerequisites are met (e.g. size chosen)",defaultValue:{value:"false",computed:!1}},quantity:{required:!1,tsType:{name:"number"},description:"Number of items to add",defaultValue:{value:"1",computed:!1}}}}},"./packages/platform-core/src/contexts/CurrencyContext.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{BD:()=>CurrencyProvider,H2:()=>useCurrency});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js");const DEFAULT_CURRENCY="EUR",LS_KEY="PREFERRED_CURRENCY",WINDOW_OVERRIDE_SYMBOL=Symbol.for("acme.platformCore.currencyWindowOverride");function resolveWindow(){if(Object.prototype.hasOwnProperty.call(globalThis,WINDOW_OVERRIDE_SYMBOL)){const override=globalThis[WINDOW_OVERRIDE_SYMBOL];return null!=override?override:void 0}return window}const CurrencyContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(void 0);function readInitial(){const win=resolveWindow();if(!win)return DEFAULT_CURRENCY;try{const stored=win.localStorage.getItem(LS_KEY);if("EUR"===stored||"USD"===stored||"GBP"===stored)return stored}catch(e){}return DEFAULT_CURRENCY}function CurrencyProvider({children}){const[currency,setCurrency]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(readInitial);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{const win=resolveWindow();if(win)try{win.localStorage.setItem(LS_KEY,currency)}catch(e){}},[currency]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(CurrencyContext.Provider,{value:[currency,setCurrency],children})}function useCurrency(){try{const ctx=(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(CurrencyContext);if(!ctx)throw new Error("useCurrency must be inside CurrencyProvider");return ctx}catch(err){if(err instanceof Error&&(err.message.includes("Invalid hook call")||err.message.includes("reading 'useContext'")))throw new Error("useCurrency must be inside CurrencyProvider");throw err}}CurrencyProvider.__docgenInfo={description:"",methods:[],displayName:"CurrencyProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""}}}},"./packages/shared-utils/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x6:()=>fetchJson,vv:()=>formatCurrency,$g:()=>formatPrice,Qm:()=>getCsrfToken,e6:()=>getShopFromPath,hJ:()=>replaceShopInPath,g6:()=>toggleItem});var types=__webpack_require__("./node_modules/.pnpm/zod@3.25.73/node_modules/zod/v3/types.js");async function fetchJson(input,init,schema){const res=await fetch(input,init);if(res.ok){let data;try{const resWithJson=res;if("function"==typeof resWithJson.json)data=await resWithJson.json();else{const text=await res.text();data=text?JSON.parse(text):void 0}}catch(e){data=void 0}return schema?schema.parse(data):data}const text=await res.text().catch(()=>"");let message,parsed,isJson=!1;try{parsed=text?JSON.parse(text):void 0,isJson=!0}catch(e){parsed=void 0}const error=types.Ik({error:types.Yj()}).safeParse(parsed);throw message=error.success?error.data.error:res.statusText?res.statusText:!isJson&&text?text:`HTTP ${res.status}`,new Error(message)}__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");function toggleItem(list,value){return list.includes(value)?list.filter(v=>v!==value):[...list,value]}function getCsrfToken(req){var _document_querySelector_getAttribute,_document_querySelector,_document_cookie_split_map_find_split_,_document_cookie_split_map_find,_document_querySelector_getAttribute_trim;if(req){var _getHeader,_cookieHeader_split_map_find_,_cookieHeader_split_map_find;const headers=req.headers,getHeader="function"==typeof(null==headers?void 0:headers.get)?name=>{var _headers_get;return null!==(_headers_get=headers.get(name))&&void 0!==_headers_get?_headers_get:void 0}:name=>null==headers?void 0:headers[name],headerToken=null===(_getHeader=getHeader("x-csrf-token"))||void 0===_getHeader?void 0:_getHeader.trim();if(headerToken)return headerToken;const reqUrl=req.url;if(reqUrl){var _searchParams_get;const queryToken=null===(_searchParams_get=new URL(reqUrl,"http://dummy").searchParams.get("csrf_token"))||void 0===_searchParams_get?void 0:_searchParams_get.trim();if(queryToken)return queryToken}var _getHeader1;return(null===(_cookieHeader_split_map_find=(null!==(_getHeader1=getHeader("cookie"))&&void 0!==_getHeader1?_getHeader1:"").split(";").map(row=>row.trim().split("=")).find(([name,value])=>["csrf_token","csrf"].includes(name)&&(null==value?void 0:value.trim())&&!value.trim().startsWith("/")))||void 0===_cookieHeader_split_map_find||null===(_cookieHeader_split_map_find_=_cookieHeader_split_map_find[1])||void 0===_cookieHeader_split_map_find_?void 0:_cookieHeader_split_map_find_.trim())||void 0}if("undefined"==typeof document)return;let csrfToken=null!==(_document_querySelector_getAttribute_trim=null===(_document_querySelector=document.querySelector('meta[name="csrf-token"]'))||void 0===_document_querySelector||null===(_document_querySelector_getAttribute=_document_querySelector.getAttribute("content"))||void 0===_document_querySelector_getAttribute?void 0:_document_querySelector_getAttribute.trim())&&void 0!==_document_querySelector_getAttribute_trim?_document_querySelector_getAttribute_trim:null===(_document_cookie_split_map_find=document.cookie.split(";").map(row=>row.trim()).find(row=>row.startsWith("csrf_token=")))||void 0===_document_cookie_split_map_find||null===(_document_cookie_split_map_find_split_=_document_cookie_split_map_find.split("=")[1])||void 0===_document_cookie_split_map_find_split_?void 0:_document_cookie_split_map_find_split_.trim();return csrfToken||(csrfToken=crypto.randomUUID(),document.cookie=`csrf_token=${csrfToken}; path=/; SameSite=Strict${"https:"===location.protocol?"; secure":""}`),csrfToken}__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/server.js");function formatCurrency(amount,currency="USD",locale){var _Intl_supportedValuesOf,_Intl;if(!/^[A-Z]{3}$/.test(currency))throw new RangeError(`Invalid currency code: ${currency}`);const supported=null===(_Intl_supportedValuesOf=(_Intl=Intl).supportedValuesOf)||void 0===_Intl_supportedValuesOf?void 0:_Intl_supportedValuesOf.call(_Intl,"currency");if(supported&&!supported.includes(currency))throw new RangeError(`Invalid currency code: ${currency}`);const value=null!=amount?amount:NaN;return new Intl.NumberFormat(locale,{style:"currency",currency}).format(value/100)}function formatPrice(amount,currency="USD",locale){if("function"==typeof Intl.supportedValuesOf){if(!Intl.supportedValuesOf("currency").includes(currency))throw new RangeError(`Unsupported currency code: ${currency}`)}const normalizedAmount=null==amount?NaN:amount;return new Intl.NumberFormat(locale,{style:"currency",currency}).format(normalizedAmount)}var _process_env_LOG_LEVEL,browser=__webpack_require__("./node_modules/.pnpm/pino@9.9.0/node_modules/pino/browser.js"),browser_default=__webpack_require__.n(browser);const level=null!==(_process_env_LOG_LEVEL=__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js").env.LOG_LEVEL)&&void 0!==_process_env_LOG_LEVEL?_process_env_LOG_LEVEL:"info";browser_default()({level});function getShopFromPath(pathname){if(!pathname)return;try{const url=new URL(pathname,"http://dummy"),slug=url.searchParams.get("shop");if(slug)return slug;pathname=url.pathname}catch(e){}const segments=pathname.split("/").filter(Boolean);let idx=segments.indexOf("shop");return idx>=0?segments[idx+1]:(idx=segments.indexOf("shops"),idx>=0?segments[idx+1]:void 0)}function replaceShopInPath(pathname,shop){if(!pathname)return`/cms/shop/${shop}`;const hasTrailingSlash=pathname.endsWith("/"),[path,q]=pathname.split("?");let query=q,trailingSlash=path.endsWith("/");hasTrailingSlash&&!trailingSlash&&(trailingSlash=!0,query&&(query=query.replace(/\/$/,"")));const segments=path.split("/").filter(Boolean),idxShop=segments.indexOf("shop"),idxShops=segments.indexOf("shops");if(idxShop>=0){idxShop+1<segments.length?segments[idxShop+1]=shop:segments.push(shop);let newPath="/"+segments.join("/");return trailingSlash&&(newPath+="/"),query?`${newPath}?${query}`:newPath}if(idxShops>=0){idxShops+1<segments.length?segments[idxShops+1]=shop:segments.push(shop);let newPath="/"+segments.join("/");return trailingSlash&&(newPath+="/"),query?`${newPath}?${query}`:newPath}if("cms"===segments[0]){let base=`/cms/shop/${shop}`;return trailingSlash&&(base+="/"),query?`${base}?${query}`:base}return pathname}__webpack_require__("./node_modules/.pnpm/buffer@6.0.3/node_modules/buffer/index.js").hp},"./packages/ui/src/components/cms/blocks/ProductGrid.client.Matrix.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,Empty:()=>Empty,Error:()=>Error,Loading:()=>Loading,RTL:()=>RTL,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ProductGrid_client_Matrix_stories});var http=__webpack_require__("./node_modules/.pnpm/msw@2.11.3_@types+node@20.19.4_typescript@5.8.3/node_modules/msw/lib/core/http.mjs"),delay=__webpack_require__("./node_modules/.pnpm/msw@2.11.3_@types+node@20.19.4_typescript@5.8.3/node_modules/msw/lib/core/delay.mjs"),HttpResponse=__webpack_require__("./node_modules/.pnpm/msw@2.11.3_@types+node@20.19.4_typescript@5.8.3/node_modules/msw/lib/core/HttpResponse.mjs"),products=__webpack_require__("./packages/platform-core/src/products/index.ts"),ProductGrid_client=__webpack_require__("./packages/ui/src/components/cms/blocks/ProductGrid.client.tsx"),createStories=__webpack_require__("./packages/ui/src/story-utils/createStories.ts");const ProductGrid_client_fixtures_namespaceObject=JSON.parse('{"collectionId":"demo","columns":3,"minItems":3,"maxItems":9}');var types=__webpack_require__("./node_modules/.pnpm/zod@3.25.73/node_modules/zod/v3/types.js"),console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");const meta={title:"CMS Blocks/ProductGrid/Matrix",component:ProductGrid_client.A,tags:["autodocs"],args:{collectionId:"demo",columns:3,minItems:3,maxItems:9},parameters:{layout:"padded",docs:{description:{component:"Responsive product grid driven by explicit SKUs or `collectionId`. Stories showcase loading/empty/error and RTL."}}}},ProductGrid_client_Matrix_stories=meta,baseArgs=meta.args,FixtureSchema=types.Ik({collectionId:types.Yj().optional(),skus:types.YO(types.Ik({id:types.Yj()})).optional(),columns:types.ai().optional(),minItems:types.ai().optional(),maxItems:types.ai().optional()});try{FixtureSchema.parse(ProductGrid_client_fixtures_namespaceObject)}catch(e){console.error("Invalid ProductGrid fixture:",e)}const Default=(0,createStories.T)(baseArgs,{},"default",{a11y:!0,viewports:["desktop"],tags:["visual"]}),Loading={...(0,createStories.T)(baseArgs,{},"loading",{viewports:["mobile1"],tags:["visual"]}),parameters:{msw:{handlers:[http.L.get(/\/api\/collections\/.+/,async()=>(await(0,delay.cb)(1500),HttpResponse.c.json({items:products.zv},{status:200})))]}}},Empty={...(0,createStories.T)(baseArgs,{},"empty",{a11y:!0,viewports:["mobile1"],tags:["visual"]}),parameters:{msw:{handlers:[http.L.get(/\/api\/collections\/.+/,async()=>(await(0,delay.cb)(50),HttpResponse.c.json({items:[]},{status:200})))]}}},Error={...(0,createStories.T)(baseArgs,{},"error",{a11y:!0,critical:!0,viewports:["desktop"],tags:["visual","ci"]}),parameters:{msw:{handlers:[http.L.get(/\/api\/collections\/.+/,async()=>(await(0,delay.cb)(50),HttpResponse.c.json({error:"mock-error"},{status:500})))]}}},RTL=(0,createStories.T)(baseArgs,{},"default",{rtl:!0,viewports:["mobile1"],tags:["visual"]}),__namedExportsOrder=["Default","Loading","Empty","Error","RTL"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {}, 'default', {\n  a11y: true,\n  viewports: ['desktop'],\n  tags: ['visual']\n})",...Default.parameters?.docs?.source}}},Loading.parameters={...Loading.parameters,docs:{...Loading.parameters?.docs,source:{originalSource:"{\n  ...makeStateStory(baseArgs, {}, 'loading', {\n    viewports: ['mobile1'],\n    tags: ['visual']\n  }),\n  parameters: {\n    msw: {\n      handlers: [http.get(/\\/api\\/collections\\/.+/, async () => {\n        await delay(1500);\n        return HttpResponse.json({\n          items: PRODUCTS as SKU[]\n        }, {\n          status: 200\n        });\n      })]\n    }\n  }\n}",...Loading.parameters?.docs?.source}}},Empty.parameters={...Empty.parameters,docs:{...Empty.parameters?.docs,source:{originalSource:"{\n  ...makeStateStory(baseArgs, {}, 'empty', {\n    a11y: true,\n    viewports: ['mobile1'],\n    tags: ['visual']\n  }),\n  parameters: {\n    msw: {\n      handlers: [http.get(/\\/api\\/collections\\/.+/, async () => {\n        await delay(50);\n        return HttpResponse.json({\n          items: []\n        }, {\n          status: 200\n        });\n      })]\n    }\n  }\n}",...Empty.parameters?.docs?.source}}},Error.parameters={...Error.parameters,docs:{...Error.parameters?.docs,source:{originalSource:"{\n  ...makeStateStory(baseArgs, {}, 'error', {\n    a11y: true,\n    critical: true,\n    viewports: ['desktop'],\n    tags: ['visual', 'ci']\n  }),\n  parameters: {\n    msw: {\n      handlers: [http.get(/\\/api\\/collections\\/.+/, async () => {\n        await delay(50);\n        return HttpResponse.json({\n          error: 'mock-error'\n        }, {\n          status: 500\n        });\n      })]\n    }\n  }\n}",...Error.parameters?.docs?.source}}},RTL.parameters={...RTL.parameters,docs:{...RTL.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {}, 'default', {\n  rtl: true,\n  viewports: ['mobile1'],\n  tags: ['visual']\n})",...RTL.parameters?.docs?.source}}}},"./packages/ui/src/components/cms/blocks/ProductGrid.client.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ProductGrid_client_ProductGrid,b:()=>getRuntimeProps});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),next_image=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_@swc+core@1.12.9_esbuild@0.25.5_next@15.3.5_@babel+core@7.28.4_f309bebf97d2c09aa3c164b2abf593ce/node_modules/@storybook/nextjs/dist/images/next-image.mjs"),next_link=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),CurrencyContext=__webpack_require__("./packages/platform-core/src/contexts/CurrencyContext.tsx"),src=__webpack_require__("./packages/shared-utils/src/index.ts"),AddToCartButton_client=__webpack_require__("./packages/platform-core/src/components/shop/AddToCartButton.client.tsx");function Price({amount,currency}){const[ctxCurrency]=(0,CurrencyContext.H2)();var _ref;const cur=null!==(_ref=null!=currency?currency:ctxCurrency)&&void 0!==_ref?_ref:"EUR";return(0,jsx_runtime.jsx)("span",{children:(0,src.$g)(amount,cur)})}function ProductCardInner({sku}){var _sku_badges,_sku_badges1;return(0,jsx_runtime.jsxs)("article",{className:"flex flex-col gap-3 rounded-lg border p-4 transition-shadow hover:shadow-md",children:[" ",(0,jsx_runtime.jsx)(link_default(),{href:`../product/${sku.slug}`,className:"relative block aspect-square",children:sku.media[0]&&("image"===sku.media[0].type?(0,jsx_runtime.jsx)(next_image.A,{src:sku.media[0].url,alt:sku.title,fill:!0,sizes:"(min-width: 640px) 25vw, 50vw",className:"rounded-md object-cover"}):(0,jsx_runtime.jsx)("video",{src:sku.media[0].url,className:"h-full w-full rounded-md object-cover","data-aspect":"1/1",muted:!0,playsInline:!0}))}),(null===(_sku_badges=sku.badges)||void 0===_sku_badges?void 0:_sku_badges.sale)&&(0,jsx_runtime.jsx)("span",{"data-cy":"badge-sale",children:"Sale"}),(null===(_sku_badges1=sku.badges)||void 0===_sku_badges1?void 0:_sku_badges1.new)&&(0,jsx_runtime.jsx)("span",{"data-cy":"badge-new",children:"New"}),(0,jsx_runtime.jsx)("h3",{className:"font-medium",children:sku.title}),null!=sku.price&&(0,jsx_runtime.jsx)("div",{className:"font-semibold text-gray-900",children:(0,jsx_runtime.jsx)(Price,{amount:sku.price})}),(0,jsx_runtime.jsx)(AddToCartButton_client.A,{sku})]})}const ProductCard=(0,react.memo)(ProductCardInner);function ProductGridInner({skus,columns,minItems=1,maxItems=3,desktopItems,tabletItems,mobileItems,className,...rest}){const sorted=(0,react.useMemo)(()=>[...skus].sort((a,b)=>a.title.localeCompare(b.title)),[skus]),containerRef=(0,react.useRef)(null);var _ref;const[cols,setCols]=(0,react.useState)(null!==(_ref=null!=columns?columns:desktopItems)&&void 0!==_ref?_ref:minItems);return(0,react.useEffect)(()=>{if(columns||"undefined"==typeof ResizeObserver||!containerRef.current)return;const el=containerRef.current,update=()=>{const width=el.clientWidth;if(desktopItems||tabletItems||mobileItems){const chosen=width>=1024?desktopItems:width>=768?tabletItems:mobileItems;return void setCols(null!=chosen?chosen:minItems)}const ideal=Math.floor(width/250)||1,clamped=Math.max(minItems,Math.min(maxItems,ideal));setCols(clamped)};update();const observer=new ResizeObserver(update);return observer.observe(el),()=>observer.disconnect()},[columns,minItems,maxItems,desktopItems,tabletItems,mobileItems]),(0,jsx_runtime.jsx)("section",{ref:containerRef,...rest,className:`grid gap-6 ${null!=className?className:""}`,style:{gridTemplateColumns:`repeat(${null!=columns?columns:cols}, minmax(0, 1fr))`},children:sorted.length?sorted.map(sku=>(0,jsx_runtime.jsx)(ProductCard,{sku},sku.id)):Array.from({length:null!=columns?columns:cols}).map((_,i)=>(0,jsx_runtime.jsx)("div",{"data-cy":"placeholder",className:"h-64 rounded-lg bg-gray-200 animate-pulse"},i))})}Price.__docgenInfo={description:"",methods:[],displayName:"Price",props:{amount:{required:!0,tsType:{name:"number"},description:""},currency:{required:!1,tsType:{name:"string"},description:""}}},ProductCardInner.__docgenInfo={description:"",methods:[],displayName:"ProductCardInner",props:{sku:{required:!0,tsType:{name:"intersection",raw:"SKU & { badges?: { sale?: boolean; new?: boolean } }",elements:[{name:"z.infer",elements:[{name:"skuSchema"}],raw:"z.infer<typeof skuSchema>"},{name:"signature",type:"object",raw:"{ badges?: { sale?: boolean; new?: boolean } }",signature:{properties:[{key:"badges",value:{name:"signature",type:"object",raw:"{ sale?: boolean; new?: boolean }",signature:{properties:[{key:"sale",value:{name:"boolean",required:!1}},{key:"new",value:{name:"boolean",required:!1}}]},required:!1}}]}}]},description:""}}};const ProductGrid=(0,react.memo)(ProductGridInner);ProductGridInner.__docgenInfo={description:"",methods:[],displayName:"ProductGridInner",props:{skus:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"skuSchema"}],raw:"z.infer<typeof skuSchema>"}],raw:"SKU[]"},description:""},columns:{required:!1,tsType:{name:"number"},description:""},minItems:{required:!1,tsType:{name:"number"},description:"Minimum number of products to display",defaultValue:{value:"1",computed:!1}},maxItems:{required:!1,tsType:{name:"number"},description:"Maximum number of products to display",defaultValue:{value:"3",computed:!1}},desktopItems:{required:!1,tsType:{name:"number"},description:"Items shown on desktop viewports"},tabletItems:{required:!1,tsType:{name:"number"},description:"Items shown on tablet viewports"},mobileItems:{required:!1,tsType:{name:"number"},description:"Items shown on mobile viewports"},className:{required:!1,tsType:{name:"string"},description:""}}};var products=__webpack_require__("./packages/platform-core/src/products/index.ts"),fetchCollection=__webpack_require__("./packages/ui/src/components/cms/blocks/products/fetchCollection.ts");function ProductGrid_client_ProductGrid({skus,collectionId,columns,minItems,maxItems,desktopItems,tabletItems,mobileItems,className}){const[items,setItems]=(0,react.useState)(null!=skus?skus:[]);return(0,react.useEffect)(()=>{let cancelled=!1;return(async()=>{if(collectionId){const fetched=await(0,fetchCollection.t)(collectionId);cancelled||setItems(fetched)}else setItems(null!=skus?skus:[])})(),()=>{cancelled=!0}},[collectionId,skus]),(0,jsx_runtime.jsx)(ProductGrid,{skus:items,columns,minItems,maxItems,desktopItems,tabletItems,mobileItems,className})}function getRuntimeProps(){return{skus:products.zv}}ProductGrid_client_ProductGrid.__docgenInfo={description:"",methods:[],displayName:"ProductGrid",props:{skus:{required:!1,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"skuSchema"}],raw:"z.infer<typeof skuSchema>"}],raw:"SKU[]"},description:""},collectionId:{required:!1,tsType:{name:"string"},description:""},columns:{required:!1,tsType:{name:"number"},description:""},minItems:{required:!1,tsType:{name:"number"},description:""},maxItems:{required:!1,tsType:{name:"number"},description:""},desktopItems:{required:!1,tsType:{name:"number"},description:""},tabletItems:{required:!1,tsType:{name:"number"},description:""},mobileItems:{required:!1,tsType:{name:"number"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./packages/ui/src/components/cms/blocks/products/fetchCollection.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>fetchCollection});var console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");async function fetchCollection(collectionId){try{const res=await fetch(`/api/collections/${collectionId}`,{next:{revalidate:60,tags:["collections",`collection:${collectionId}`]}});if(!res.ok)return console.error(`Failed to fetch collection ${collectionId}:`,res.statusText),[];const data=await res.json();var _data_items,_ref;const products=Array.isArray(data)?data:null!==(_ref=null!==(_data_items=data.items)&&void 0!==_data_items?_data_items:data.products)&&void 0!==_ref?_ref:[];return null!=products?products:[]}catch(err){return console.error("fetchCollection error",err),[]}}},"./packages/ui/src/story-utils/createStories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function makeStateStory(base,patch,state,opts={}){const{a11y=!0,critical=!1,rtl=!1,viewports=[],tags=[],docsDescription}=opts,parameters={a11y:{disable:!a11y},dataState:state};rtl&&(parameters.rtl=!0),viewports.length&&(parameters.viewport={defaultViewport:viewports[0]}),docsDescription&&(parameters.docs={description:{story:docsDescription}});const computedTags=["autodocs",a11y?"a11y":"no-a11y",critical?"critical":"noncritical",...tags];parameters.chromatic={disable:!computedTags.includes("visual")};return{args:{...base,...patch},parameters,tags:computedTags}}__webpack_require__.d(__webpack_exports__,{T:()=>makeStateStory})}}]);