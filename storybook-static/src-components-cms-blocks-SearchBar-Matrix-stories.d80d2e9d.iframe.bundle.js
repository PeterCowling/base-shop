"use strict";(self.webpackChunkcms_monorepo=self.webpackChunkcms_monorepo||[]).push([[6695],{"./packages/i18n/src/resolveText.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function resolveText(value,locale,t){if("string"==typeof value)return value;if("key"===(null==value?void 0:value.type))return t(value.key,value.params);if("inline"===(null==value?void 0:value.type)){const chain=function fallbackChain(locale){switch(locale){case"de":return["de","en"];case"it":return["it","en"];default:return["en"]}}(locale);for(const loc of chain){var _value_value;const v=null===(_value_value=value.value)||void 0===_value_value?void 0:_value_value[loc];if("string"==typeof v&&v.length>0)return v}return""}return""}__webpack_require__.d(__webpack_exports__,{W:()=>resolveText})},"./packages/shared-utils/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x6:()=>fetchJson,vv:()=>formatCurrency,$g:()=>formatPrice,Qm:()=>getCsrfToken,e6:()=>getShopFromPath,hJ:()=>replaceShopInPath,g6:()=>toggleItem});var types=__webpack_require__("./node_modules/.pnpm/zod@3.25.73/node_modules/zod/v3/types.js");async function fetchJson(input,init,schema){const res=await fetch(input,init);if(res.ok){let data;try{const resWithJson=res;if("function"==typeof resWithJson.json)data=await resWithJson.json();else{const text=await res.text();data=text?JSON.parse(text):void 0}}catch(e){data=void 0}return schema?schema.parse(data):data}const text=await res.text().catch(()=>"");let message,parsed,isJson=!1;try{parsed=text?JSON.parse(text):void 0,isJson=!0}catch(e){parsed=void 0}const error=types.Ik({error:types.Yj()}).safeParse(parsed);throw message=error.success?error.data.error:res.statusText?res.statusText:!isJson&&text?text:`HTTP ${res.status}`,new Error(message)}__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");function toggleItem(list,value){return list.includes(value)?list.filter(v=>v!==value):[...list,value]}function getCsrfToken(req){var _document_querySelector_getAttribute,_document_querySelector,_document_cookie_split_map_find_split_,_document_cookie_split_map_find,_document_querySelector_getAttribute_trim;if(req){var _getHeader,_cookieHeader_split_map_find_,_cookieHeader_split_map_find;const headers=req.headers,getHeader="function"==typeof(null==headers?void 0:headers.get)?name=>{var _headers_get;return null!==(_headers_get=headers.get(name))&&void 0!==_headers_get?_headers_get:void 0}:name=>null==headers?void 0:headers[name],headerToken=null===(_getHeader=getHeader("x-csrf-token"))||void 0===_getHeader?void 0:_getHeader.trim();if(headerToken)return headerToken;const reqUrl=req.url;if(reqUrl){var _searchParams_get;const queryToken=null===(_searchParams_get=new URL(reqUrl,"http://dummy").searchParams.get("csrf_token"))||void 0===_searchParams_get?void 0:_searchParams_get.trim();if(queryToken)return queryToken}var _getHeader1;return(null===(_cookieHeader_split_map_find=(null!==(_getHeader1=getHeader("cookie"))&&void 0!==_getHeader1?_getHeader1:"").split(";").map(row=>row.trim().split("=")).find(([name,value])=>["csrf_token","csrf"].includes(name)&&(null==value?void 0:value.trim())&&!value.trim().startsWith("/")))||void 0===_cookieHeader_split_map_find||null===(_cookieHeader_split_map_find_=_cookieHeader_split_map_find[1])||void 0===_cookieHeader_split_map_find_?void 0:_cookieHeader_split_map_find_.trim())||void 0}if("undefined"==typeof document)return;let csrfToken=null!==(_document_querySelector_getAttribute_trim=null===(_document_querySelector=document.querySelector('meta[name="csrf-token"]'))||void 0===_document_querySelector||null===(_document_querySelector_getAttribute=_document_querySelector.getAttribute("content"))||void 0===_document_querySelector_getAttribute?void 0:_document_querySelector_getAttribute.trim())&&void 0!==_document_querySelector_getAttribute_trim?_document_querySelector_getAttribute_trim:null===(_document_cookie_split_map_find=document.cookie.split(";").map(row=>row.trim()).find(row=>row.startsWith("csrf_token=")))||void 0===_document_cookie_split_map_find||null===(_document_cookie_split_map_find_split_=_document_cookie_split_map_find.split("=")[1])||void 0===_document_cookie_split_map_find_split_?void 0:_document_cookie_split_map_find_split_.trim();return csrfToken||(csrfToken=crypto.randomUUID(),document.cookie=`csrf_token=${csrfToken}; path=/; SameSite=Strict${"https:"===location.protocol?"; secure":""}`),csrfToken}__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/server.js");function formatCurrency(amount,currency="USD",locale){var _Intl_supportedValuesOf,_Intl;if(!/^[A-Z]{3}$/.test(currency))throw new RangeError(`Invalid currency code: ${currency}`);const supported=null===(_Intl_supportedValuesOf=(_Intl=Intl).supportedValuesOf)||void 0===_Intl_supportedValuesOf?void 0:_Intl_supportedValuesOf.call(_Intl,"currency");if(supported&&!supported.includes(currency))throw new RangeError(`Invalid currency code: ${currency}`);const value=null!=amount?amount:NaN;return new Intl.NumberFormat(locale,{style:"currency",currency}).format(value/100)}function formatPrice(amount,currency="USD",locale){if("function"==typeof Intl.supportedValuesOf){if(!Intl.supportedValuesOf("currency").includes(currency))throw new RangeError(`Unsupported currency code: ${currency}`)}const normalizedAmount=null==amount?NaN:amount;return new Intl.NumberFormat(locale,{style:"currency",currency}).format(normalizedAmount)}var _process_env_LOG_LEVEL,browser=__webpack_require__("./node_modules/.pnpm/pino@9.9.0/node_modules/pino/browser.js"),browser_default=__webpack_require__.n(browser);const level=null!==(_process_env_LOG_LEVEL=__webpack_require__("./node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js").env.LOG_LEVEL)&&void 0!==_process_env_LOG_LEVEL?_process_env_LOG_LEVEL:"info";browser_default()({level});function getShopFromPath(pathname){if(!pathname)return;try{const url=new URL(pathname,"http://dummy"),slug=url.searchParams.get("shop");if(slug)return slug;pathname=url.pathname}catch(e){}const segments=pathname.split("/").filter(Boolean);let idx=segments.indexOf("shop");return idx>=0?segments[idx+1]:(idx=segments.indexOf("shops"),idx>=0?segments[idx+1]:void 0)}function replaceShopInPath(pathname,shop){if(!pathname)return`/cms/shop/${shop}`;const hasTrailingSlash=pathname.endsWith("/"),[path,q]=pathname.split("?");let query=q,trailingSlash=path.endsWith("/");hasTrailingSlash&&!trailingSlash&&(trailingSlash=!0,query&&(query=query.replace(/\/$/,"")));const segments=path.split("/").filter(Boolean),idxShop=segments.indexOf("shop"),idxShops=segments.indexOf("shops");if(idxShop>=0){idxShop+1<segments.length?segments[idxShop+1]=shop:segments.push(shop);let newPath="/"+segments.join("/");return trailingSlash&&(newPath+="/"),query?`${newPath}?${query}`:newPath}if(idxShops>=0){idxShops+1<segments.length?segments[idxShops+1]=shop:segments.push(shop);let newPath="/"+segments.join("/");return trailingSlash&&(newPath+="/"),query?`${newPath}?${query}`:newPath}if("cms"===segments[0]){let base=`/cms/shop/${shop}`;return trailingSlash&&(base+="/"),query?`${base}?${query}`:base}return pathname}__webpack_require__("./node_modules/.pnpm/buffer@6.0.3/node_modules/buffer/index.js").hp},"./packages/ui/src/components/cms/blocks/SearchBar.Matrix.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,RTL:()=>RTL,__namedExportsOrder:()=>__namedExportsOrder,default:()=>SearchBar_Matrix_stories});var SearchBar=__webpack_require__("./packages/ui/src/components/cms/blocks/SearchBar.tsx"),createStories=__webpack_require__("./packages/ui/src/story-utils/createStories.ts");const SearchBar_fixtures_namespaceObject=JSON.parse('{"placeholder":"Search products","limit":5,"locale":"en"}');var types=__webpack_require__("./node_modules/.pnpm/zod@3.25.73/node_modules/zod/v3/types.js"),console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");const meta={title:"CMS Blocks/SearchBar/Matrix",component:SearchBar.A,tags:["autodocs"],args:{...SearchBar_fixtures_namespaceObject}},SearchBar_Matrix_stories=meta,baseArgs=meta.args,TT=types.KC([types.Yj(),types.Ik({type:types.eu("inline"),value:types.Yj(),locale:types.Yj().optional()}),types.Ik({type:types.eu("key"),key:types.Yj(),params:types.g1(types.bz()).optional()})]);try{types.Ik({placeholder:TT.optional(),limit:types.ai().optional(),locale:types.Yj().optional()}).parse(SearchBar_fixtures_namespaceObject)}catch(e){console.error("Invalid SearchBar fixture:",e)}const Default=(0,createStories.T)(baseArgs,{},"default",{a11y:!0,viewports:["desktop"],tags:["visual"]}),RTL=(0,createStories.T)(baseArgs,{locale:"ar"},"default",{rtl:!0,viewports:["mobile1"],tags:["visual"]}),__namedExportsOrder=["Default","RTL"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {}, 'default', {\n  a11y: true,\n  viewports: ['desktop'],\n  tags: ['visual']\n})",...Default.parameters?.docs?.source}}},RTL.parameters={...RTL.parameters,docs:{...RTL.parameters?.docs,source:{originalSource:"makeStateStory(baseArgs, {\n  locale: 'ar' as unknown as import('@acme/types').Locale\n}, 'default', {\n  rtl: true,\n  viewports: ['mobile1'],\n  tags: ['visual']\n})",...RTL.parameters?.docs?.source}}}},"./packages/ui/src/components/cms/blocks/SearchBar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>SearchBar});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),_radix_ui_react_icons__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/@radix-ui+react-icons@1.3.2_react@19.2.0-canary-3fbfb9ba-20250409/node_modules/@radix-ui/react-icons/dist/react-icons.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),_atoms_shadcn__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./packages/ui/src/components/atoms/shadcn/index.ts"),_acme_shared_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./packages/shared-utils/src/index.ts"),_acme_i18n__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/i18n/src/index.ts"),_i18n_resolveText__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/i18n/src/resolveText.ts");function SearchBar({placeholder,limit=5,locale="en"}){const t=(0,_acme_i18n__WEBPACK_IMPORTED_MODULE_4__.c3)(),[query,setQuery]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[results,setResults]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]),effPlaceholder=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>placeholder?"string"==typeof placeholder?placeholder:"type"in placeholder&&"key"===placeholder.type?t(placeholder.key,placeholder.params):"type"in placeholder&&"inline"===placeholder.type?(0,_i18n_resolveText__WEBPACK_IMPORTED_MODULE_5__.W)(placeholder,locale,t):t("search.products.placeholder"):t("search.products.placeholder"),[placeholder,t,locale]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!query)return void setResults(prev=>prev.length?[]:prev);const controller=new AbortController;return(async()=>{try{const origin=window.location.origin,url=new URL("/api/products",origin);url.searchParams.set("q",query);const shop=(0,_acme_shared_utils__WEBPACK_IMPORTED_MODULE_3__.e6)(window.location.pathname);shop&&url.searchParams.set("shop",shop);const res=await fetch(url.toString(),{signal:controller.signal}),next=(await res.json()).slice(0,limit);setResults(prev=>prev.length===next.length&&prev.every((p,i)=>{var _next_i,_next_i1;return p.slug===(null===(_next_i=next[i])||void 0===_next_i?void 0:_next_i.slug)&&p.title===(null===(_next_i1=next[i])||void 0===_next_i1?void 0:_next_i1.title)})?prev:next)}catch(e){}})(),()=>controller.abort()},[query,limit]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"relative w-full sm:w-80","data-token":"--color-bg",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_atoms_shadcn__WEBPACK_IMPORTED_MODULE_2__.pd,{type:"search",value:query,onChange:e=>setQuery(e.target.value),placeholder:effPlaceholder,className:"pe-8"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_radix_ui_react_icons__WEBPACK_IMPORTED_MODULE_6__.$p$,{className:"text-muted-foreground pointer-events-none absolute top-2 end-2 h-4 w-4","data-token":"--color-muted-fg"}),results.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("ul",{className:"bg-surface-2 absolute mt-1 w-full rounded-md border border-border-2 shadow","data-token":"--color-bg",children:results.map(r=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("li",{onMouseDown:()=>(r=>{setQuery(r.title),setResults([])})(r),role:"button",tabIndex:0,className:"text-fg hover:bg-accent hover:text-accent-foreground cursor-pointer px-3 py-1 min-h-10 flex items-center","data-token":"--color-fg",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{children:r.title})},r.slug))})]})}SearchBar.__docgenInfo={description:"",methods:[],displayName:"SearchBar",props:{placeholder:{required:!1,tsType:{name:"TranslatableText"},description:""},limit:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},locale:{required:!1,tsType:{name:"Locale"},description:"",defaultValue:{value:'"en"',computed:!1}}}}},"./packages/ui/src/story-utils/createStories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function makeStateStory(base,patch,state,opts={}){const{a11y=!0,critical=!1,rtl=!1,viewports=[],tags=[],docsDescription}=opts,parameters={a11y:{disable:!a11y},dataState:state};rtl&&(parameters.rtl=!0),viewports.length&&(parameters.viewport={defaultViewport:viewports[0]}),docsDescription&&(parameters.docs={description:{story:docsDescription}});const computedTags=["autodocs",a11y?"a11y":"no-a11y",critical?"critical":"noncritical",...tags];parameters.chromatic={disable:!computedTags.includes("visual")};return{args:{...base,...patch},parameters,tags:computedTags}}__webpack_require__.d(__webpack_exports__,{T:()=>makeStateStory})}}]);