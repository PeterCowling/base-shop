"use strict";(self.webpackChunkcms_monorepo=self.webpackChunkcms_monorepo||[]).push([[7312],{"./packages/ui/src/components/cms/MediaManager.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>MediaManager_stories});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),react_icons_esm=__webpack_require__("./node_modules/.pnpm/@radix-ui+react-icons@1.3.2_react@19.2.0-canary-3fbfb9ba-20250409/node_modules/@radix-ui/react-icons/dist/react-icons.esm.js"),src=__webpack_require__("./packages/i18n/src/index.ts"),atoms=__webpack_require__("./packages/ui/src/components/atoms/index.ts"),shadcn=__webpack_require__("./packages/ui/src/components/atoms/shadcn/index.ts"),utils_style=__webpack_require__("./packages/ui/src/utils/style/index.ts"),drawerWidth=__webpack_require__("./packages/ui/src/utils/style/drawerWidth.ts");function tagsToString(value){return value?value.filter(Boolean).join(", "):""}function getDefaultAlt(item){var _item_altText,_ref;return null!==(_ref=null!==(_item_altText=item.altText)&&void 0!==_item_altText?_item_altText:item.title)&&void 0!==_ref?_ref:""}function MediaDetailsPanel({open,item,pending,onSubmit,onClose}){const t=(0,src.c3)(),baseId=(0,react.useId)(),titleId=`${baseId}-title`,altId=`${baseId}-alt`,tagsId=`${baseId}-tags`,tagsHelpId=`${baseId}-tags-help`,[title,setTitle]=(0,react.useState)(()=>{var _item_title;return null!==(_item_title=item.title)&&void 0!==_item_title?_item_title:""}),[altText,setAltText]=(0,react.useState)(()=>getDefaultAlt(item)),[tags,setTags]=(0,react.useState)(()=>tagsToString(item.tags));(0,react.useEffect)(()=>{var _item_title;setTitle(null!==(_item_title=item.title)&&void 0!==_item_title?_item_title:""),setAltText(getDefaultAlt(item)),setTags(tagsToString(item.tags))},[item]);const fileName=(0,react.useMemo)(()=>function getFileName(url){try{var _url_split_pop;return decodeURIComponent(null!==(_url_split_pop=url.split("/").pop())&&void 0!==_url_split_pop?_url_split_pop:url)}catch(e){return url}}(item.url),[item.url]),{widthClass,style}=(0,drawerWidth._)("28rem");return(0,jsx_runtime.jsx)(shadcn.lG,{open,onOpenChange:nextOpen=>{nextOpen||onClose()},children:(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsxs)(shadcn.Cf,{style,className:(0,utils_style.cn)("bg-panel fixed top-0 end-0 z-50 flex h-full w-full translate-x-full flex-col overflow-y-auto border-s border-border-2 p-6 shadow-elevation-4 transition-transform data-[state=open]:translate-x-0 [&>[data-radix-dialog-close]]:hidden start-auto translate-y-0",widthClass),children:[(0,jsx_runtime.jsx)(shadcn.$n,{type:"button",variant:"ghost","aria-label":String(t("actions.close")),onClick:onClose,className:"text-muted-foreground hover:text-foreground absolute end-4 top-4 h-9 w-9 p-0",children:(0,jsx_runtime.jsx)(react_icons_esm.MKb,{className:"h-4 w-4"})}),(0,jsx_runtime.jsxs)("form",{onSubmit:event=>{var value;event.preventDefault(),onSubmit({title,altText,tags:(value=tags,value.split(",").map(tag=>tag.trim()).filter(tag=>tag.length>0))})},className:"flex h-full flex-col",children:[(0,jsx_runtime.jsxs)(shadcn.c7,{className:"space-y-2 text-start",children:[(0,jsx_runtime.jsx)(shadcn.L3,{children:t("cms.media.details.editTitle")}),(0,jsx_runtime.jsx)(shadcn.rr,{className:"break-all text-start text-sm text-muted-foreground",children:t("cms.media.details.updateMetaFor",{fileName})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 space-y-4 overflow-y-auto py-6",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("label",{htmlFor:titleId,className:"text-sm font-medium",children:t("fields.title")}),(0,jsx_runtime.jsx)(shadcn.pd,{id:titleId,value:title,onChange:event=>setTitle(event.target.value),placeholder:String(t("fields.title.add"))})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("label",{htmlFor:altId,className:"text-sm font-medium",children:t("cms.image.alt")}),(0,jsx_runtime.jsx)(shadcn.TM,{id:altId,value:altText,onChange:event=>setAltText(event.target.value),placeholder:String(t("cms.media.details.alt.placeholder")),rows:3}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-foreground",children:t("cms.media.details.alt.help")})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("label",{htmlFor:tagsId,className:"text-sm font-medium",children:t("fields.tags")}),(0,jsx_runtime.jsx)(shadcn.pd,{id:tagsId,value:tags,onChange:event=>setTags(event.target.value),placeholder:String(t("cms.media.details.tags.placeholder")),"aria-describedby":tagsHelpId}),(0,jsx_runtime.jsx)("p",{id:tagsHelpId,className:"text-xs text-muted-foreground",children:t("cms.media.details.tags.help")})]})]}),(0,jsx_runtime.jsx)(shadcn.Es,{className:"border-t pt-4",children:(0,jsx_runtime.jsx)(shadcn.$n,{type:"submit",disabled:pending,className:(0,utils_style.cn)(),style:{minWidth:120},children:pending?(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(atoms.y$,{className:"h-4 w-4"}),(0,jsx_runtime.jsx)("span",{"aria-live":"polite","aria-atomic":"true",children:t("actions.saving")})]}):t("actions.save")})})]})]})})})}function MediaDetailsPanel_MediaDetailsPanel({loading,...props}){return(0,jsx_runtime.jsx)(MediaDetailsPanel,{pending:loading,...props})}MediaDetailsPanel.__docgenInfo={description:"",methods:[],displayName:"MediaDetailsPanel",props:{open:{required:!0,tsType:{name:"boolean"},description:""},item:{required:!0,tsType:{name:"MediaItemWithUrl"},description:""},pending:{required:!0,tsType:{name:"boolean"},description:""},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(fields: MediaDetailsFormValues) => void | Promise<void>",signature:{arguments:[{type:{name:"MediaDetailsFormValues"},name:"fields"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}},MediaDetailsPanel_MediaDetailsPanel.__docgenInfo={description:"",methods:[],displayName:"MediaDetailsPanel",props:{loading:{required:!0,tsType:{name:'BaseMediaDetailsPanelProps["pending"]',raw:'BaseMediaDetailsPanelProps["pending"]'},description:""}},composes:["Omit"]};var MediaFileItem=__webpack_require__("./packages/ui/src/components/cms/MediaFileItem.tsx"),Grid=__webpack_require__("./packages/ui/src/components/atoms/primitives/Grid.tsx");function MediaFileList({files,shop,onDelete,onReplace,onReplaceSuccess,onReplaceError,onSelect,onBulkToggle,selectionEnabled=!1,isItemSelected,isDeleting,isReplacing}){return(0,jsx_runtime.jsx)(Grid.x,{cols:2,gap:4,className:"sm:grid-cols-4",children:files.map(item=>{var _isItemSelected;return(0,jsx_runtime.jsx)(MediaFileItem.A,{item,shop,onDelete,onReplace,onReplaceSuccess,onReplaceError,onSelect,onBulkToggle,selectionEnabled,selected:null!==(_isItemSelected=null==isItemSelected?void 0:isItemSelected(item))&&void 0!==_isItemSelected&&_isItemSelected,deleting:null==isDeleting?void 0:isDeleting(item),replacing:null==isReplacing?void 0:isReplacing(item)},item.url)})})}function Library({files,shop,onDelete,onReplace,onReplaceSuccess,onReplaceError,onSelect,onBulkToggle,selectionEnabled=!1,isItemSelected,selectedUrl,isDeleting,isReplacing,emptyLibraryMessage,emptyResultsMessage}){const t=(0,src.c3)(),[query,setQuery]=(0,react.useState)(""),[tag,setTag]=(0,react.useState)(""),derivedEmptyLibraryMessage=null!=emptyLibraryMessage?emptyLibraryMessage:t("Upload media to get started."),derivedEmptyResultsMessage=null!=emptyResultsMessage?emptyResultsMessage:t("No media matches your filters."),allTags=(0,react.useMemo)(()=>Array.from(new Set(files.flatMap(f=>{var _f_tags;return null!==(_f_tags=f.tags)&&void 0!==_f_tags?_f_tags:[]}))),[files]),filteredFiles=files.filter(f=>{var _split_pop,_f_url,_split_pop_toLowerCase;const name=null!==(_split_pop_toLowerCase=null===(_split_pop=(null!==(_f_url=f.url)&&void 0!==_f_url?_f_url:"").split("/").pop())||void 0===_split_pop?void 0:_split_pop.toLowerCase())&&void 0!==_split_pop_toLowerCase?_split_pop_toLowerCase:"",q=query.toLowerCase(),matchesQuery=!q||name.includes(q);var _f_tags;const matchesTag=!tag||(null!==(_f_tags=f.tags)&&void 0!==_f_tags?_f_tags:[]).includes(tag);return matchesQuery&&matchesTag}),showResultsList=filteredFiles.length>0,showEmptyLibrary=0===files.length,derivedIsItemSelected=(0,react.useMemo)(()=>isItemSelected||(selectedUrl?item=>item.url===selectedUrl:void 0),[isItemSelected,selectedUrl]);return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,jsx_runtime.jsx)(shadcn.pd,{type:"search",placeholder:String(t("Search media...")),value:query,onChange:e=>setQuery(e.target.value),className:"w-full flex-1"}),allTags.length>0&&(0,jsx_runtime.jsxs)(shadcn.l6,{value:""===tag?"__all__":tag,onValueChange:v=>setTag("__all__"===v?"":v),children:[(0,jsx_runtime.jsx)(shadcn.bq,{className:"sm:w-44",children:(0,jsx_runtime.jsx)(shadcn.yv,{placeholder:String(t("All tags"))})}),(0,jsx_runtime.jsxs)(shadcn.gC,{children:[(0,jsx_runtime.jsx)(shadcn.eb,{value:"__all__",children:t("All tags")}),allTags.map(t=>(0,jsx_runtime.jsx)(shadcn.eb,{value:t,children:t},t))]})]})]}),showResultsList?(0,jsx_runtime.jsx)(MediaFileList,{files:filteredFiles,shop,onDelete,onReplace,onReplaceSuccess,onReplaceError,onSelect,onBulkToggle,selectionEnabled,isItemSelected:derivedIsItemSelected,isDeleting,isReplacing}):(0,jsx_runtime.jsxs)("div",{className:"bg-muted text-muted-foreground flex min-h-52 flex-col items-center justify-center gap-2 rounded-lg p-8 text-center","data-token":String(t("--color-muted")),"data-token-fg":String(t("--color-muted-fg")),children:[(0,jsx_runtime.jsx)("p",{className:"text-sm font-medium text-fg","data-token":String(t("--color-fg")),children:t(showEmptyLibrary?"No media yet":"No results")}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-foreground","data-token":String(t("--color-muted-fg")),children:showEmptyLibrary?derivedEmptyLibraryMessage:derivedEmptyResultsMessage})]})]})}MediaFileList.__docgenInfo={description:"",methods:[],displayName:"MediaFileList",props:{files:{required:!0,tsType:{name:"Array",elements:[{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]}],raw:"WithUrl[]"},description:"List of files already filtered by the parent component"},shop:{required:!0,tsType:{name:"string"},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string) => void",signature:{arguments:[{type:{name:"string"},name:"url"}],return:{name:"void"}}},description:""},onReplace:{required:!0,tsType:{name:"signature",type:"function",raw:"(oldUrl: string, item: MediaItem) => void",signature:{arguments:[{type:{name:"string"},name:"oldUrl"},{type:{name:"MediaItem"},name:"item"}],return:{name:"void"}}},description:""},onReplaceSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: MediaItem) => void",signature:{arguments:[{type:{name:"MediaItem"},name:"item"}],return:{name:"void"}}},description:""},onReplaceError:{required:!1,tsType:{name:"signature",type:"function",raw:"(message: string) => void",signature:{arguments:[{type:{name:"string"},name:"message"}],return:{name:"void"}}},description:""},onSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl | null) => void",signature:{arguments:[{type:{name:"union",raw:"WithUrl | null",elements:[{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},{name:"null"}]},name:"item"}],return:{name:"void"}}},description:""},onBulkToggle:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl, selected: boolean) => void",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"},{type:{name:"boolean"},name:"selected"}],return:{name:"void"}}},description:""},selectionEnabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isItemSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""},isDeleting:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""},isReplacing:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""}}},Library.__docgenInfo={description:"",methods:[],displayName:"Library",props:{files:{required:!0,tsType:{name:"Array",elements:[{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]}],raw:"WithUrl[]"},description:""},shop:{required:!0,tsType:{name:"string"},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string) => void",signature:{arguments:[{type:{name:"string"},name:"url"}],return:{name:"void"}}},description:""},onReplace:{required:!0,tsType:{name:"signature",type:"function",raw:"(oldUrl: string, item: MediaItem) => void",signature:{arguments:[{type:{name:"string"},name:"oldUrl"},{type:{name:"MediaItem"},name:"item"}],return:{name:"void"}}},description:""},onReplaceSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: MediaItem) => void",signature:{arguments:[{type:{name:"MediaItem"},name:"item"}],return:{name:"void"}}},description:""},onReplaceError:{required:!1,tsType:{name:"signature",type:"function",raw:"(message: string) => void",signature:{arguments:[{type:{name:"string"},name:"message"}],return:{name:"void"}}},description:""},onSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl | null) => void",signature:{arguments:[{type:{name:"union",raw:"WithUrl | null",elements:[{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},{name:"null"}]},name:"item"}],return:{name:"void"}}},description:""},onBulkToggle:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl, selected: boolean) => void",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"},{type:{name:"boolean"},name:"selected"}],return:{name:"void"}}},description:""},selectionEnabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isItemSelected:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""},selectedUrl:{required:!1,tsType:{name:"string"},description:""},isDeleting:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""},isReplacing:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: WithUrl) => boolean",signature:{arguments:[{type:{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]},name:"item"}],return:{name:"boolean"}}},description:""},emptyLibraryMessage:{required:!1,tsType:{name:"string"},description:""},emptyResultsMessage:{required:!1,tsType:{name:"string"},description:""}}};var UploadPanel=__webpack_require__("./packages/ui/src/components/cms/media/UploadPanel.tsx");function MediaManagerView({shop,uploaderTargetId,files,uploadPanel,library,deleteDialog,detailsPanel,toast}){const t=(0,src.c3)();return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)(UploadPanel.A,{shop,onUploaded:uploadPanel.onUploaded,focusTargetId:uploaderTargetId,onUploadError:uploadPanel.onUploadError}),(0,jsx_runtime.jsx)(Library,{files,shop,onDelete:library.onDelete,onReplace:library.onReplace,onReplaceSuccess:library.onReplaceSuccess,onReplaceError:library.onReplaceError,onSelect:library.onSelect,isDeleting:library.isDeleting,isReplacing:library.isReplacing}),(0,jsx_runtime.jsx)(shadcn.lG,{open:deleteDialog.open,onOpenChange:deleteDialog.onOpenChange,children:(0,jsx_runtime.jsxs)(shadcn.Cf,{children:[(0,jsx_runtime.jsxs)(shadcn.c7,{children:[(0,jsx_runtime.jsx)(shadcn.L3,{children:t("cms.media.confirmDelete.title")}),(0,jsx_runtime.jsx)(shadcn.rr,{children:t("cms.media.confirmDelete.description")})]}),(0,jsx_runtime.jsxs)(shadcn.Es,{children:[(0,jsx_runtime.jsx)(shadcn.$n,{type:"button",variant:"outline",onClick:deleteDialog.onCancel,disabled:deleteDialog.pending,children:t("actions.cancel")}),(0,jsx_runtime.jsx)(shadcn.$n,{type:"button",variant:"destructive",onClick:deleteDialog.onConfirm,disabled:deleteDialog.pending,children:deleteDialog.pending?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(atoms.y$,{className:"h-4 w-4"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:t("cms.media.deleting")})]}):t("actions.delete")})]})]})}),detailsPanel.selectedItem?(0,jsx_runtime.jsx)(MediaDetailsPanel_MediaDetailsPanel,{open:!0,item:detailsPanel.selectedItem,loading:detailsPanel.loading,onSubmit:detailsPanel.onSubmit,onClose:detailsPanel.onClose}):null,(0,jsx_runtime.jsx)(atoms.y8,{open:toast.open,message:toast.message,variant:toast.variant,onClose:toast.onClose,"data-cy":"media-manager-toast"})]})}MediaManagerView.__docgenInfo={description:"",methods:[],displayName:"MediaManagerView",props:{files:{required:!0,tsType:{name:"Array",elements:[{name:"intersection",raw:"MediaItem & { url: string }",elements:[{name:"MediaItem"},{name:"signature",type:"object",raw:"{ url: string }",signature:{properties:[{key:"url",value:{name:"string",required:!0}}]}}]}],raw:"MediaItemWithUrl[]"},description:""},uploadPanel:{required:!0,tsType:{name:"MediaManagerUploadPanelHandlers"},description:""},library:{required:!0,tsType:{name:"MediaManagerLibraryHandlers"},description:""},deleteDialog:{required:!0,tsType:{name:"MediaManagerDeleteDialogState"},description:""},detailsPanel:{required:!0,tsType:{name:"MediaManagerDetailsPanelState"},description:""},toast:{required:!0,tsType:{name:"MediaManagerToastState"},description:""},shop:{required:!0,tsType:{name:"string"},description:""},uploaderTargetId:{required:!1,tsType:{name:"string"},description:""}}};var console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");function hasUrl(item){return"string"==typeof item.url&&item.url.length>0}var useDeleteHandlers_console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");var useUploadHandlers_console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");var useReplaceHandlers_console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");var useDetailsHandlers_console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");function useMediaManagerState({shop,initialFiles,onDelete,onMetadataUpdate}){const{state,actions}=function useMediaState(initialFiles){const[state,setState]=(0,react.useState)(()=>{return{files:(items=initialFiles,items.reduce((accumulator,item)=>hasUrl(item)?(accumulator.push(item),accumulator):(console.warn("cms.media.upload.missingUrl",item),accumulator),[])),selectedUrl:null,dialogDeleteUrl:null,deletePending:!1,metadataPending:!1,replacingUrl:null,toast:{open:!1,message:""}};var items}),setFiles=(0,react.useCallback)(value=>{setState(previous=>({...previous,files:"function"==typeof value?value(previous.files):value}))},[]),setSelectedUrl=(0,react.useCallback)(value=>{setState(previous=>({...previous,selectedUrl:"function"==typeof value?value(previous.selectedUrl):value}))},[]),setDialogDeleteUrl=(0,react.useCallback)(value=>{setState(previous=>({...previous,dialogDeleteUrl:"function"==typeof value?value(previous.dialogDeleteUrl):value}))},[]),setDeletePending=(0,react.useCallback)(value=>{setState(previous=>({...previous,deletePending:"function"==typeof value?value(previous.deletePending):value}))},[]),setMetadataPending=(0,react.useCallback)(value=>{setState(previous=>({...previous,metadataPending:"function"==typeof value?value(previous.metadataPending):value}))},[]),setReplacingUrl=(0,react.useCallback)(value=>{setState(previous=>({...previous,replacingUrl:"function"==typeof value?value(previous.replacingUrl):value}))},[]),setToast=(0,react.useCallback)(value=>{setState(previous=>({...previous,toast:"function"==typeof value?value(previous.toast):value}))},[]),handleToastClose=(0,react.useCallback)(()=>{setToast(previous=>({...previous,open:!1}))},[setToast]);return{state,actions:{setFiles,setSelectedUrl,setDialogDeleteUrl,setDeletePending,setMetadataPending,setReplacingUrl,setToast,handleToastClose}}}(initialFiles),upload=function useUploadHandlers(actions){const{setFiles,setSelectedUrl,setToast}=actions,t=(0,src.c3)();return{onUploaded:(0,react.useCallback)(item=>{if(!hasUrl(item))return useUploadHandlers_console.error("cms.media.upload.missingUrl",item),void setToast({open:!0,message:t("cms.media.upload.missingUrl"),variant:"error"});const itemWithUrl=item;setFiles(prev=>[itemWithUrl,...prev]),setSelectedUrl(itemWithUrl.url),setToast({open:!0,message:t("cms.media.upload.success"),variant:"success"})},[setFiles,setSelectedUrl,setToast,t]),onUploadError:(0,react.useCallback)(message=>{setToast({open:!0,message,variant:"error"})},[setToast])}}(actions),deletion=function useDeleteHandlers({shop,onDelete,state,actions}){const t=(0,src.c3)(),{dialogDeleteUrl,deletePending}=state,{setDeletePending,setDialogDeleteUrl,setFiles,setSelectedUrl,setToast}=actions,deletingUrl=(0,react.useMemo)(()=>deletePending?dialogDeleteUrl:null,[deletePending,dialogDeleteUrl]),performDelete=(0,react.useCallback)(async targetUrl=>{setDeletePending(!0);try{await onDelete(shop,targetUrl),setFiles(prev=>prev.filter(file=>file.url!==targetUrl)),setSelectedUrl(prev=>prev===targetUrl?null:prev),setToast({open:!0,message:String(t("cms.media.toast.deleted")),variant:"success"}),setDialogDeleteUrl(previous=>previous===targetUrl?null:previous)}catch(error){useDeleteHandlers_console.error("Failed to delete media item",error),setToast({open:!0,message:String(t("cms.media.errors.deleteFailed")),variant:"error"})}finally{setDeletePending(!1)}},[onDelete,setDeletePending,setDialogDeleteUrl,setFiles,setSelectedUrl,setToast,shop,t]),onRequestDelete=(0,react.useCallback)(url=>{setDialogDeleteUrl(url)},[performDelete,setDialogDeleteUrl,t]),onConfirmDelete=(0,react.useCallback)(async()=>{dialogDeleteUrl&&await performDelete(dialogDeleteUrl)},[dialogDeleteUrl,performDelete]),onCancelDelete=(0,react.useCallback)(()=>{setDialogDeleteUrl(null)},[setDialogDeleteUrl]),onDialogOpenChange=(0,react.useCallback)(open=>{if(!open){if(deletePending)return;onCancelDelete()}},[deletePending,onCancelDelete]),isDeleting=(0,react.useCallback)(item=>deletingUrl===item.url,[deletingUrl]);return{onRequestDelete,onConfirmDelete,onCancelDelete,onDialogOpenChange,isDeleting}}({shop,onDelete,state,actions}),replace=function useReplaceHandlers({state,actions}){const{files,replacingUrl,selectedUrl}=state,{setReplacingUrl,setFiles,setSelectedUrl,setToast}=actions,t=(0,src.c3)();return{onReplace:(0,react.useCallback)(oldUrl=>{setReplacingUrl(oldUrl)},[setReplacingUrl]),onReplaceSuccess:(0,react.useCallback)(item=>{if(!replacingUrl)return void useReplaceHandlers_console.warn("Replacement completed without a tracked URL.");if(!hasUrl(item))return useReplaceHandlers_console.error("Replacement media item is missing a URL",item),setToast({open:!0,message:t("cms.media.errors.replaceMissingUrl"),variant:"error"}),void setReplacingUrl(null);const itemWithUrl=item;if(!files.some(file=>file.url===replacingUrl))return useReplaceHandlers_console.error("Failed to locate media item to replace",replacingUrl),setToast({open:!0,message:t("cms.media.errors.replaceUpdateFailed"),variant:"error"}),void setReplacingUrl(null);setFiles(prev=>prev.map(file=>file.url===replacingUrl?{...file,...itemWithUrl}:file)),selectedUrl===replacingUrl&&setSelectedUrl(itemWithUrl.url),setReplacingUrl(null),setToast({open:!0,message:t("cms.media.toast.replaced"),variant:"success"})},[files,replacingUrl,selectedUrl,setFiles,setReplacingUrl,setSelectedUrl,setToast,t]),onReplaceError:(0,react.useCallback)(message=>{useReplaceHandlers_console.error("Failed to replace media item",message),setReplacingUrl(null),setToast({open:!0,message:message||t("cms.media.errors.replaceFailed"),variant:"error"})},[setReplacingUrl,setToast,t]),isReplacing:(0,react.useCallback)(item=>replacingUrl===item.url,[replacingUrl])}}({state,actions}),details=function useDetailsHandlers({shop,onMetadataUpdate,state,actions}){const{files,selectedUrl}=state,{setMetadataPending,setFiles,setSelectedUrl,setToast}=actions,t=(0,src.c3)(),selectedItem=(0,react.useMemo)(()=>{return selectedUrl&&null!==(_files_find=files.find(file=>file.url===selectedUrl))&&void 0!==_files_find?_files_find:null;var _files_find},[files,selectedUrl]),onMetadataSubmit=(0,react.useCallback)(async fields=>{if(!selectedItem)return;const currentUrl=selectedItem.url;setMetadataPending(!0);try{const updated=await onMetadataUpdate(shop,currentUrl,fields);if(!hasUrl(updated))throw new Error("Updated media item is missing a URL");const updatedWithUrl=updated;if(!files.some(file=>file.url===currentUrl))throw new Error("Media item could not be found in the current list");setFiles(prev=>prev.map(file=>file.url===currentUrl?{...file,...updatedWithUrl}:file)),setSelectedUrl(updatedWithUrl.url),setToast({open:!0,message:t("cms.media.toast.detailsUpdated"),variant:"success"})}catch(error){useDetailsHandlers_console.error("Failed to update media metadata",error),setToast({open:!0,message:t("cms.media.errors.updateMetadataFailed"),variant:"error"})}finally{setMetadataPending(!1)}},[files,onMetadataUpdate,selectedItem,setFiles,setMetadataPending,setSelectedUrl,setToast,shop,t]),onCloseDetails=(0,react.useCallback)(()=>{setSelectedUrl(null)},[setSelectedUrl]),onSelect=(0,react.useCallback)(item=>{var _item_url;setSelectedUrl(null!==(_item_url=null==item?void 0:item.url)&&void 0!==_item_url?_item_url:null)},[setSelectedUrl]);return{selectedItem,onMetadataSubmit,onCloseDetails,onSelect}}({shop,onMetadataUpdate,state,actions});return{files:state.files,uploadPanel:{onUploaded:upload.onUploaded,onUploadError:upload.onUploadError},library:{onDelete:deletion.onRequestDelete,onReplace:replace.onReplace,onReplaceSuccess:replace.onReplaceSuccess,onReplaceError:replace.onReplaceError,onSelect:details.onSelect,isDeleting:deletion.isDeleting,isReplacing:replace.isReplacing},deleteDialog:{open:Boolean(state.dialogDeleteUrl),pending:state.deletePending,onOpenChange:deletion.onDialogOpenChange,onCancel:deletion.onCancelDelete,onConfirm:deletion.onConfirmDelete},detailsPanel:{selectedItem:details.selectedItem,loading:state.metadataPending,onSubmit:details.onMetadataSubmit,onClose:details.onCloseDetails},toast:{...state.toast,onClose:actions.handleToastClose}}}function MediaManagerBase({shop,initialFiles,onDelete,onMetadataUpdate,uploaderTargetId}){const state=useMediaManagerState({shop,initialFiles,onDelete,onMetadataUpdate});return(0,jsx_runtime.jsx)(MediaManagerView,{shop,uploaderTargetId,...state})}const MediaManager=(0,react.memo)(MediaManagerBase);MediaManagerBase.__docgenInfo={description:"",methods:[],displayName:"MediaManagerBase",props:{shop:{required:!0,tsType:{name:"string"},description:""},initialFiles:{required:!0,tsType:{name:"Array",elements:[{name:"MediaItem"}],raw:"MediaItem[]"},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"(shop: string, src: string) => void | Promise<void>",signature:{arguments:[{type:{name:"string"},name:"shop"},{type:{name:"string"},name:"src"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:"Removes a media item on the server.\nImplemented in – and supplied by – the host application (e.g. `apps/cms`)."},onMetadataUpdate:{required:!0,tsType:{name:"signature",type:"function",raw:"(\n  shop: string,\n  src: string,\n  fields: MediaDetailsFormValues\n) => MediaItem | Promise<MediaItem>",signature:{arguments:[{type:{name:"string"},name:"shop"},{type:{name:"string"},name:"src"},{type:{name:"MediaDetailsFormValues"},name:"fields"}],return:{name:"union",raw:"MediaItem | Promise<MediaItem>",elements:[{name:"MediaItem"},{name:"Promise",elements:[{name:"MediaItem"}],raw:"Promise<MediaItem>"}]}}},description:""},uploaderTargetId:{required:!1,tsType:{name:"string"},description:""}}};const MediaManager_stories={component:MediaManager,args:{shop:"demo",initialFiles:[{url:"/sample.jpg",altText:"Sample",tags:["demo"],type:"image"}],onDelete:()=>alert("delete"),onMetadataUpdate:async(_shop,url,fields)=>({url,type:"image",...fields})},argTypes:{shop:{control:"text"},initialFiles:{control:"object"}}},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./packages/ui/src/components/cms/media/UploadPanel.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>UploadPanel});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/jsx-runtime.js"),next_image=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_@swc+core@1.12.9_esbuild@0.25.5_next@15.3.5_@babel+core@7.28.4_f309bebf97d2c09aa3c164b2abf593ce/node_modules/@storybook/nextjs/dist/images/next-image.mjs"),shadcn=__webpack_require__("./packages/ui/src/components/atoms/shadcn/index.ts"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.5_@babel+core@7.28.4_@opentelemetry+api@1.9.0_@playwright+test@1.53.2_react-d_b38198e836dabfde367dfef63fafdf09/node_modules/next/dist/compiled/react/index.js"),useFileUpload=__webpack_require__("./packages/ui/src/hooks/useFileUpload.tsx");function useMediaUpload(options){const base=(0,useFileUpload.lN)(options),[thumbnail,setThumbnail]=(0,react.useState)(null);return(0,react.useEffect)(()=>{const file=base.pendingFile;if(file){if(file.type.startsWith("image/")){const url=URL.createObjectURL(file);return setThumbnail(url),()=>URL.revokeObjectURL(url)}if(file.type.startsWith("video/")){let active=!0;return async function createVideoThumbnail(file){return new Promise(resolve=>{const video=document.createElement("video");video.preload="metadata",video.src=URL.createObjectURL(file),video.muted=!0,video.playsInline=!0;const cleanup=()=>URL.revokeObjectURL(video.src);video.onloadeddata=()=>{const canvas=document.createElement("canvas");canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx?(ctx.drawImage(video,0,0,canvas.width,canvas.height),cleanup(),resolve(canvas.toDataURL("image/png"))):(cleanup(),resolve(video.src))},video.onerror=()=>{cleanup(),resolve(video.src)}})}(file).then(url=>{active&&setThumbnail(url)}),()=>{active=!1}}}else setThumbnail(null)},[base.pendingFile]),{...base,thumbnail}}var atoms=__webpack_require__("./packages/ui/src/components/atoms/index.ts"),style=__webpack_require__("./packages/ui/src/utils/style/index.ts"),src=__webpack_require__("./packages/i18n/src/index.ts"),Cover=__webpack_require__("./packages/ui/src/components/atoms/primitives/Cover.tsx"),Inline=__webpack_require__("./packages/ui/src/components/atoms/primitives/Inline.tsx");function UploadPanel({shop,onUploaded,focusTargetId,onUploadError}){var _pendingFile_type;const t=(0,src.c3)(),[dragActive,setDragActive]=(0,react.useState)(!1),{pendingFile,thumbnail,altText,setAltText,tags:uploadTags,setTags:setUploadTags,actual,isValid,progress,error,inputRef,openFileDialog,onDrop,onFileChange,handleUpload}=useMediaUpload({shop,requiredOrientation:"landscape",onUploaded});var _pendingFile_type_startsWith;const isVideo=null!==(_pendingFile_type_startsWith=null==pendingFile||null===(_pendingFile_type=pendingFile.type)||void 0===_pendingFile_type?void 0:_pendingFile_type.startsWith("video/"))&&void 0!==_pendingFile_type_startsWith&&_pendingFile_type_startsWith,isUploading=Boolean(progress);return(0,react.useEffect)(()=>{void 0!==error&&(null==onUploadError||onUploadError(error))},[error,onUploadError]),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)(Cover.Y,{id:focusTargetId,tabIndex:0,role:"button","aria-label":String(t("upload.dropHelp")),"aria-describedby":"media-upload-feedback",onDrop:e=>{onDrop(e),setDragActive(!1)},onDragOver:e=>e.preventDefault(),onDragEnter:()=>setDragActive(!0),onDragLeave:()=>setDragActive(!1),onClick:openFileDialog,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),openFileDialog())},className:(0,style.cn)("h-32 cursor-pointer rounded-md border-2 border-dashed border-muted text-sm text-muted",dragActive&&"ring-2 ring-primary/60 bg-primary/5"),children:[(0,jsx_runtime.jsx)(shadcn.pd,{ref:inputRef,type:"file",accept:"image/*,video/*",multiple:!0,className:"hidden",onChange:onFileChange}),t("upload.dropCta")]}),(0,jsx_runtime.jsxs)("div",{id:"media-upload-feedback",role:"status","aria-live":"polite",className:"space-y-2",children:[error&&(0,jsx_runtime.jsx)("p",{className:"text-sm text-danger","data-token":"--color-danger",children:error}),progress&&(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted","data-token":"--color-muted",children:t("upload.uploadedCount",{done:progress.done,total:progress.total})}),pendingFile&&(isVideo||null!==isValid)&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[thumbnail&&(0,jsx_runtime.jsx)(next_image.A,{src:thumbnail,alt:String(t("wizard.preview.title")),width:80,height:80,className:"h-20 w-20 rounded object-cover"}),!isVideo&&(0,jsx_runtime.jsx)("p",{className:isValid?"text-sm text-success":"text-sm text-danger","data-token":isValid?"--color-success":"--color-danger",children:isValid?t("cms.image.orientation.ok",{actual}):t("cms.image.orientation.bad",{actual,required:"landscape"})}),(isVideo||isValid)&&(0,jsx_runtime.jsxs)(Inline.c,{className:"gap-2 sm:flex-nowrap",children:[(0,jsx_runtime.jsx)(shadcn.pd,{type:"text",value:altText,onChange:e=>setAltText(e.target.value),placeholder:String(t(isVideo?"fields.title":"cms.image.alt")),className:"flex-1"}),(0,jsx_runtime.jsx)(shadcn.pd,{type:"text",value:uploadTags,onChange:e=>setUploadTags(e.target.value),placeholder:String(t("fields.tags.placeholderCommaSeparated")),className:"flex-1"}),(0,jsx_runtime.jsx)(shadcn.$n,{onClick:handleUpload,type:"button",className:"h-auto px-2 py-1 text-sm",disabled:isUploading,children:isUploading?(0,jsx_runtime.jsxs)(Inline.c,{className:"items-center gap-2",children:[(0,jsx_runtime.jsx)(atoms.y$,{className:"h-4 w-4"}),(0,jsx_runtime.jsx)("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:t("upload.uploading")})]}):t("cms.image.upload")})]})]})]})]})}UploadPanel.__docgenInfo={description:"",methods:[],displayName:"UploadPanel",props:{shop:{required:!0,tsType:{name:"string"},description:""},onUploaded:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: MediaItem) => void",signature:{arguments:[{type:{name:"MediaItem"},name:"item"}],return:{name:"void"}}},description:""},focusTargetId:{required:!1,tsType:{name:"string"},description:""},onUploadError:{required:!1,tsType:{name:"signature",type:"function",raw:"(message: string) => void",signature:{arguments:[{type:{name:"string"},name:"message"}],return:{name:"void"}}},description:""}}}},"./packages/ui/src/utils/style/drawerWidth.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function drawerWidthProps(width){const widthClass="string"==typeof width&&width.startsWith("w-")?width:void 0;return{widthClass,style:widthClass?void 0:{width}}}__webpack_require__.d(__webpack_exports__,{_:()=>drawerWidthProps})}}]);