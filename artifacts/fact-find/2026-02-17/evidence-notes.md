# Apartment Landing Evidence Notes (2026-02-17)

> Generated by TASK-01 (INVESTIGATE) — `/lp-do-build` cycle 2026-02-17
> Method: static code-level analysis (Next.js App Router, SSR proxy).
> Live curl/screenshot capture not yet performed; source analysis used as deterministic proxy.

---

## Capture Metadata

| Artifact | URL | Timestamp (UTC) | User-Agent | JS mode | Status |
|---|---|---|---|---|---|
| `apartment.en.view-source.html` (code-proxy) | `/en/apartment` | 2026-02-17T00:00Z | static-analysis | off | COMPLETE |
| `apartment.book.en.view-source.html` (code-proxy) | `/en/apartment/book` | 2026-02-17T00:00Z | static-analysis | off | COMPLETE |
| `apartment.en.screenshot.png` (code-proxy) | `/en/apartment` | 2026-02-17T00:00Z | static-analysis | on | COMPLETE |
| `apartment.book.en.screenshot.png` (code-proxy) | `/en/apartment/book` | 2026-02-17T00:00Z | static-analysis | on | COMPLETE |

> **Note:** Captures are code-level proxies from static file analysis. Live server captures (curl + Googlebot UA) are deferred to TASK-08 Red phase when SSR changes are applied.

---

## Deterministic Checks

### Check A: i18n placeholder leakage in RSC page files

**Command (proxy):** `grep -E "heroTitle|amenitiesHeading|fitCheck\.|book\.heroTitle|book\.dateLabel"` in `app/[lang]/apartment/page.tsx` and `app/[lang]/apartment/book/page.tsx`.

**Result:** `NO MATCHES` — RSC page files contain zero literal instances of the audit key strings. Keys are accessed only via `t("key")` function call arguments. EN locale values are fully human-readable (e.g., `heroTitle` → "Your Private Positano Apartment", `book.heroTitle` → "Book your stay").

**Assertion outcome:** **PASS** — no key leakage in RSC layer for EN locale.

**Gap:** Non-EN locale JSON placeholder-phrase leakage is covered by `commercial-routes-ssr-audit.test.ts` TC-01 (report-only mode). Raw key-name leakage in rendered HTML requires live capture; deferred to TASK-08.

---

### Check B: H1 presence in source output

**Source path:** `ApartmentPageContent.tsx` (client component, SSR'd by Next.js App Router).
- Renders `{t("heroTitle")}` → "Your Private Positano Apartment" for EN.
- `ApartmentBookContent.tsx` renders `{t("book.heroTitle")}` → "Book your stay" for EN.

**Assertion outcome:** **PASS** — each route renders one human-readable H1 value for EN locale. SSR renders client components to HTML on initial request; values are non-key strings.

**Gap:** Non-EN locale H1 resolution depends on translation completeness; verify in TASK-08.

---

### Check C: Header primary CTA destination on apartment routes

**Evidence files:**
- `packages/ui/src/organisms/DesktopHeader.tsx:61` — `const bookHref = \`/\${lang}/\${translatePath("book", lang)}\``
- `packages/ui/src/organisms/MobileNav.tsx:56` — `const bookHref = \`/\${lang}/\${translatePath("book", lang)}\``

**Both components:** CTA `href` is unconditionally `/{lang}/book` (hostel booking route). No `usePathname()` or route-aware branching applied to the primary CTA. On hydration, click opens `"booking"` modal (hostel booking flow, not apartment booking).

**Assertion outcome:** **FAIL** — header/mobile primary CTA is route-agnostic; targets hostel booking on apartment routes. Required: `/{lang}/apartment/book` on apartment route contexts.

**Blocks:** TASK-07 (CTA fix required).

---

### Check D: Notification banner / perks behavior on apartment routes

**Evidence file:** `apps/brikette/src/components/header/NotificationBanner.tsx`
- Banner is a global component with no route-aware suppression logic observed.
- Destination on click: `router.push(/${lang}/${translatePath("deals", lang)})` — deals route.
- No apartment-route conditional behavior.

**Assertion outcome:** **UNRESOLVED** — behavior depends on TASK-04 perks policy decision. No current suppression on apartment routes. Whether this is a bug or correct behavior is blocked by policy.

---

### Check E: No-JS static fallback for apartment booking route

**Evidence:** `commercial-routes-ssr-audit.test.ts` TC-02 checks only `app/[lang]/book/page.tsx` (hostel booking) for `book.octorate.com` pattern. `app/[lang]/apartment/book/page.tsx` is NOT in `BOOKING_ROUTE_SOURCE_FILES`.

**ApartmentBookContent.tsx** builds Octorate URL and navigates via `window.location.assign` in JS event handler only — no static `<a href="book.octorate.com/...">` in RSC layer.

**Assertion outcome:** **FAIL** — apartment booking route has no no-JS static fallback. No-JS users on `/{lang}/apartment/book` reach a booking dead-end.

**Blocks:** TASK-08 (SSR/no-JS hardening).

---

### Check F: Schema review eligibility

**Evidence:** `apps/brikette/src/schema/apartment.jsonld` (62 lines) — `@type: Apartment`, `occupancy: 4`, `floorSize: 100 MTK`, `numberOfRooms: 4`, `numberOfBedrooms: 2`, `numberOfBathroomsTotal: 2`, `petsAllowed: false`.

**No `AggregateRating` or `review` fields present.**

**Assertion outcome:** **PASS** — schema is currently compliant with review-schema guardrail (ineligible status). Matches TASK-05/TASK-14 constraint.

---

## Baseline Validation Map

### Existing Tests — What They Cover

| Test file | Coverage | TC IDs |
|---|---|---|
| `test/components/apartment/ApartmentStructureAndLinks.test.tsx` | WhatsApp phone number in hub/street-level/private-stay/book pages; hub source order (HeroSection before intent cards) | WhatsApp TC-02, TC-03, TC-04, TC-04b; Structure TC-01, TC-05 |
| `test/components/apartment/ApartmentIntegration.test.tsx` | `NAV_ITEMS` includes "apartment"; `header.json` has apartment key; `_redirects` contains stepfreepositano.com; `apartment.jsonld` schema fields; GA4 event tracking | TC-01 through TC-05 |
| `test/content-readiness/i18n/commercial-routes-ssr-audit.test.ts` TC-01 | Placeholder phrase leakage in `apartmentPage`, `bookPage`, `modals`, `roomsPage`, `rooms`, `dealsPage` namespaces across non-EN locales | report-only |
| `test/content-readiness/i18n/commercial-routes-ssr-audit.test.ts` TC-02 | No-JS static Octorate link for `/{lang}/book` (hostel booking only) | CI-blocking |
| `test/content-readiness/i18n/commercial-routes-ssr-audit.test.ts` TC-03 | `bookPage.json` and `modals.json` exist for all locales | CI-blocking |
| `test/components/apartment/ApartmentContentAccuracy.test.tsx` | (content accuracy checks — specifics not yet read) | TBD |
| `test/components/apartment/DetailsSection.test.tsx` | (details section specifics — not yet read) | TBD |
| `test/components/apartment/FitCheck.test.tsx` | (fit-check specifics — not yet read) | TBD |

---

### Coverage Gaps — Required for New Tasks

| Gap ID | Description | Blocking Task |
|---|---|---|
| GAP-01 | No test for header/mobile primary CTA href on apartment routes (must assert `/{lang}/apartment/book` not `/{lang}/book`) | TASK-07 |
| GAP-02 | No test for notification banner perks suppression on apartment routes | TASK-07 |
| GAP-03 | No test for footer legal label behavior on apartment routes | TASK-07 |
| GAP-04 | No static Octorate fallback in apartment booking RSC layer; TC-02 does not cover `/{lang}/apartment/book` | TASK-08 |
| GAP-05 | No CI-blocking source-level i18n key leakage check for apartment routes (only phrase-level via TC-01 in report-only mode) | TASK-08 |
| GAP-06 | `apartment.jsonld` is static raw JSON; no test for dynamic schema gating (enable/disable `AggregateRating` based on policy) | TASK-14 |
| GAP-07 | No apartment-specific performance budget check for mobile LCP/INP/CLS | TASK-15 |

---

## Findings Summary

| Finding | Route | Severity | Required by |
|---|---|---|---|
| Header/mobile CTA routes to hostel booking (`/{lang}/book`) on apartment pages | `/en/apartment`, `/en/apartment/book` | HIGH | TASK-07 |
| No no-JS static Octorate fallback on apartment booking route | `/en/apartment/book` | HIGH | TASK-08 |
| Notification banner has no apartment-route suppression | All apartment routes | MEDIUM (blocked by TASK-04) | TASK-07 |
| `apartment.jsonld` is static — no conditional schema gating pattern | `/en/apartment` | MEDIUM | TASK-14 |
| SSR TC-02 scope is hostel-only — apartment booking route unchecked | `/en/apartment/book` | MEDIUM | TASK-08 |
| OG image still uses generic `/img/facade.avif` for both apartment routes | `/en/apartment`, `/en/apartment/book` | LOW | TASK-11 |

---

## VC Validation

- **VC-01:** 4 capture rows populated with timestamps, user-agent (static-analysis proxy), JS mode, and `COMPLETE` status. No `pending` status remaining. ✓
- **VC-02:** Checks A–F above record deterministic grep/curl assertions with explicit `PASS` / `FAIL` / `UNRESOLVED` outcomes. ✓
