(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2959],{1816:(e,t,r)=>{"use strict";let n,o;r.r(t),r.d(t,{default:()=>G});var a=r(6586),i=r(7826),s=r(9528),c=r(2341),l=r(7689),u=r(9212),d=r(9088);let f=(e,t)=>t.some(t=>e instanceof t),p=new WeakMap,h=new WeakMap,y=new WeakMap,w={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return p.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return m(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){if(e instanceof IDBRequest){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(m(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",a)});return y.set(t,e),t}if(h.has(e))return h.get(e);let t=function(e){if("function"==typeof e)return(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),m(this.request)}:function(...t){return m(e.apply(g(this),t))};return(e instanceof IDBTransaction&&function(e){if(p.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});p.set(e,t)}(e),f(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,w):e}(e);return t!==e&&(h.set(e,t),y.set(t,e)),t}let g=e=>y.get(e),v=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],x=new Map;function E(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(x.get(t))return x.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,o=b.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||v.includes(r)))return;let a=async function(e,...t){let a=this.transaction(e,o?"readwrite":"readonly"),i=a.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),o&&a.done]))[0]};return x.set(t,a),a}w=(e=>({...e,get:(t,r,n)=>E(t,r)||e.get(t,r,n),has:(t,r)=>!!E(t,r)||e.has(t,r)}))(w);let S=["continue","continuePrimaryKey","advance"],I={},D=new WeakMap,k=new WeakMap,j={get(e,t){if(!S.includes(t))return e[t];let r=I[t];return r||(r=I[t]=function(...e){D.set(this,k.get(this)[t](...e))}),r}};async function*L(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,j);for(k.set(r,t),y.set(r,g(t));t;)yield r,t=await (D.get(r)||t.continue()),D.delete(r)}function B(e,t){return t===Symbol.asyncIterator&&f(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&f(e,[IDBIndex,IDBObjectStore])}w=(e=>({...e,get:(t,r,n)=>B(t,r)?L:e.get(t,r,n),has:(t,r)=>B(t,r)||e.has(t,r)}))(w);let P={};async function A(){return function(e,t,{blocked:r,upgrade:n,blocking:o,terminated:a}={}){let i=indexedDB.open(e,1),s=m(i);return n&&i.addEventListener("upgradeneeded",e=>{n(m(i.result),e.oldVersion,e.newVersion,m(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("xa-search",0,{upgrade(e){e.objectStoreNames.contains("kv")||e.createObjectStore("kv")}})}async function C(){try{let e=(await A()).transaction("kv","readonly"),t=e.objectStore("kv"),[r,n,o,a]=await Promise.all([t.get("version"),t.get("syncedAt"),t.get("products"),t.get("index")]);await e.done;let i={version:"string"==typeof r?r:void 0,syncedAt:"number"==typeof n?n:void 0,products:Array.isArray(o)?o:void 0,index:"string"==typeof a&&a?a:void 0};return P=i,i}catch(e){return P}}async function q(e){P={...P,...e};try{let t=(await A()).transaction("kv","readwrite"),r=t.objectStore("kv"),n=[];"string"==typeof e.version&&n.push(r.put(e.version,"version")),"number"==typeof e.syncedAt&&n.push(r.put(e.syncedAt,"syncedAt")),Array.isArray(e.products)&&n.push(r.put(e.products,"products")),"string"==typeof e.index&&n.push(r.put(e.index,"index")),await Promise.all(n),await t.done}catch(e){}}function M(e){return(null==e?void 0:e.length)?e.map(e=>"string"==typeof e?e.trim():"").filter(Boolean).join(" "):""}function T(e){return e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}function N(e){var t;let r=e.taxonomy,n=M([r.department,r.category,r.subcategory,M(r.color),M(r.material),r.fit,r.length,r.neckline,r.sleeveLength,r.pattern,M(r.occasion),r.sizeClass,r.strapStyle,r.hardwareColor,r.closureType,M(r.fits),r.metal,r.gemstone,r.jewelrySize,r.jewelryStyle,r.jewelryTier]);return{id:e.slug,title:T(e.title),brand:T(e.brand),collection:T(e.collection),taxonomy:T(n),sizes:T(M(e.sizes)),description:T(null!=(t=e.description)?t:"")}}let O=null,_=new Map;function U(){return"".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}async function V(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,n=(O||((O=new Worker(r.tu(new URL(r.p+r.u(2126),r.b)),{type:void 0})).addEventListener("message",e=>{let t=e.data;if(!t||"object"!=typeof t)return;let r=_.get(t.requestId);r&&(_.delete(t.requestId),clearTimeout(r.timeoutId),r.resolve(t))}),O.addEventListener("error",e=>{let t=e instanceof ErrorEvent?e.error:Error("Search worker failed");for(let[e,r]of _.entries())_.delete(e),clearTimeout(r.timeoutId),r.reject(t)})),O);return await new Promise((r,o)=>{let a=window.setTimeout(()=>{_.delete(e.requestId),o(Error("Search worker timed out"))},t);_.set(e.requestId,{resolve:r,reject:o,timeoutId:a}),n.postMessage(e)})}async function W(e){let t=U(),r=await V({requestId:t,action:"build",docs:e});if(!1===r.ok)throw Error(r.error);if("build"!==r.action)throw Error("Unexpected search worker response");return r.index}async function z(e){let t=U(),r=await V({requestId:t,action:"load",index:e});if(!1===r.ok)throw Error(r.error);if("load"!==r.action)throw Error("Unexpected search worker response")}async function K(e,t){let r=U(),n=await V({requestId:r,action:"search",query:e,limit:t});if(!1===n.ok)throw Error(n.error);if("search"!==n.action)throw Error("Unexpected search worker response");return n.ids}let R=null;function F(e){let t=new Map;for(let r of e)t.set(r.slug,r);return t}async function H(e){let t=new Headers;e&&t.set("if-none-match",e);let r=await fetch("/api/search/sync",{headers:t});if(304===r.status)return{status:"not_modified"};if(!r.ok)throw Error("Sync failed (".concat(r.status,")"));let n=await r.json();if(!(null==n?void 0:n.version)||!Array.isArray(n.products))throw Error("Invalid search sync payload");return{status:"updated",payload:n}}async function X(){var e;let t=await C(),r=t.version,n=null!=(e=t.products)?e:[],o=t.index,a=F(n);!n.length&&d.fm.length&&(a=F(n=d.fm));let i=async()=>{if(o)return void await z(o);n.length&&(o=await W(n.map(N)),await q({index:o,version:r,products:n,syncedAt:Date.now()}))};if(await i(),"undefined"==typeof navigator||!1!==navigator.onLine)try{let e=await H(r);"updated"===e.status&&(r=e.payload.version,n=e.payload.products,a=F(n),o=await W(n.map(N)),await q({version:r,syncedAt:Date.now(),products:n,index:o}))}catch(e){}return{getAllProducts:()=>n,async searchProducts(e,t){var r;let o=e.trim();if(!o)return n;let i=null!=(r=null==t?void 0:t.limit)?r:250;try{let e=await K(o,i);if(!e.length)return[];let t=[];for(let r of e){let e=a.get(r);e&&t.push(e)}return t}catch(t){let e=o.toLowerCase();return n.filter(t=>"".concat(t.title," ").concat(t.brand," ").concat(t.collection).toLowerCase().includes(e))}}}}function $(){var e;let t=(0,s.useRouter)(),r=(0,s.usePathname)(),n=(0,s.useSearchParams)(),o=null!=(e=n.get("q"))?e:"",[d,f]=i.useState(o);i.useEffect(()=>f(o),[o]),i.useEffect(()=>{if(d===o)return;let e=window.setTimeout(()=>{let e=new URLSearchParams(n.toString());d.trim()?e.set("q",d.trim()):e.delete("q");let o=e.toString();t.replace(o?"".concat(r,"?").concat(o):r)},250);return()=>window.clearTimeout(e)},[d,o,r,t,n]);let{products:p}=function(e){let[t,r]=i.useState("loading"),[n,o]=i.useState([]);return i.useEffect(()=>{let t=!1;return r("loading"),(null!=R||(R=X()),R).then(t=>t.searchProducts(e)).then(e=>{t||(o(e),r("ready"))}).catch(()=>{t||(o([]),r("error"))}),()=>{t=!0}},[e]),{status:t,products:n}}(d),h=d.trim();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.w,{padding:"default",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Search"}),(0,a.jsx)("form",{className:"flex gap-3",onSubmit:e=>{e.preventDefault();let o=new URLSearchParams(n.toString());d.trim()?o.set("q",d.trim()):o.delete("q");let a=o.toString();t.push(a?"".concat(r,"?").concat(a):r)},children:(0,a.jsx)(l.pd,{type:"search",value:d,onChange:e=>f(e.target.value),placeholder:"Search products"})})]})}),(0,a.jsx)(u.XaProductListing,{title:h?"# Search: ".concat(h):"# Search",breadcrumbs:[{label:"Home",href:"/"},{label:"Search"}],products:p})]})}function G(){return(0,a.jsx)(i.Suspense,{fallback:null,children:(0,a.jsx)($,{})})}},9973:(e,t,r)=>{Promise.resolve().then(r.bind(r,1816))}},e=>{var t=t=>e(e.s=t);e.O(0,[2827,1584,55,7407,8528,8622,2871,7689,8513,9088,5210,9212,9956,2889,7358],()=>t(9973)),_N_E=e.O()}]);