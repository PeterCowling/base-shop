(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621],{773:(e,t,s)=>{"use strict";s.d(t,{default:()=>eg});var r=s(6586),n=s(7826),a=s(8902);function l(e){if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}}function i(e,t){return null!=e?e:t}function o(e){let{artifacts:t,strings:s}=e;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:s.artifacts.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:s.artifacts.title})]}),(0,r.jsx)(a.BJ,{gap:3,className:"mt-4 text-sm",children:0===t.length?(0,r.jsx)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3 text-foreground/60",children:s.notAvailable}):t.map(e=>{var t,n;let a=function(e){if(!e)return null;if(e.startsWith("http"))return e;let t=function(e){if(!e.startsWith("r2://"))return null;let t=e.split("/");return t.length<4?null:t.slice(3).join("/")}(e);return t?"/api/artifacts/download?key=".concat(encodeURIComponent(t)):null}(e.uri),l=function(e,t,s){if(!e)return s;switch(e){case"snapshot_html":return t.kindSnapshotHtml;case"snapshot_png":return t.kindSnapshotPng;default:return e}}(null!=(t=e.kind)?t:null,s.artifacts,s.notAvailable);return(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsxs)("div",{className:"text-xs text-foreground/60",children:[s.artifacts.kindLabel,":"," ",(0,r.jsx)("span",{className:"text-foreground",children:l})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-foreground/60",children:[s.artifacts.uriLabel,":"," ",a?(0,r.jsx)("a",{className:"inline-flex min-h-12 min-w-12 items-center justify-center text-primary underline",href:a,target:"_blank",rel:"noreferrer",children:s.artifacts.openLabel}):(0,r.jsx)("span",{className:"text-foreground",children:null!=(n=e.uri)?n:s.notAvailable})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-foreground/60",children:[s.artifacts.createdLabel,":"," ",(0,r.jsx)("span",{className:"text-foreground",children:i(e.createdAt,s.notAvailable)})]})]},e.id)})})]})}function d(e){let{candidateId:t,stageRuns:s,loading:l,strings:i,onUploaded:o}=e,[d,u]=(0,n.useState)(!1),[c,m]=(0,n.useState)(null),[x,g]=(0,n.useState)({stageRunId:"",kind:"",file:null}),p=(0,n.useMemo)(()=>s.map(e=>({id:e.id,label:function(e){var t;let s=null!=(t=e.createdAt)?t:"";return"".concat(e.stage," | ").concat(e.status).concat(s?" | ".concat(s):"")}(e)})),[s]);(0,n.useEffect)(()=>{x.stageRunId&&(p.some(e=>e.id===x.stageRunId)||g(e=>({...e,stageRunId:""}))),x.stageRunId||1!==p.length||g(e=>({...e,stageRunId:p[0].id}))},[x.stageRunId,p]);let f=(0,n.useCallback)(async e=>{if(e.preventDefault(),!x.stageRunId||!x.kind||!x.file)return void m(i.artifactUpload.errorMessage);u(!0),m(null);let s=new FormData;s.set("candidateId",t),s.set("stageRunId",x.stageRunId),s.set("kind",x.kind),s.set("file",x.file);try{(await fetch("/api/artifacts/upload",{method:"POST",body:s})).ok?(m(i.artifactUpload.successMessage),g({stageRunId:"",kind:"",file:null}),await o()):m(i.artifactUpload.errorMessage)}catch(e){console.error(e),m(i.artifactUpload.errorMessage)}finally{u(!1)}},[t,x,o,i.artifactUpload]),b=l||0===p.length||d;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:i.artifactUpload.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:i.artifactUpload.title})]}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:f,children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[i.artifactUpload.stageRunLabel,(0,r.jsxs)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x.stageRunId,onChange:e=>g(t=>({...t,stageRunId:e.target.value})),disabled:b,children:[(0,r.jsx)("option",{value:"",children:l?i.artifactUpload.loadingRuns:0===p.length?i.artifactUpload.emptyRuns:i.notAvailable}),p.map(e=>(0,r.jsx)("option",{value:e.id,children:e.label},e.id))]})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[i.artifactUpload.kindLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x.kind,onChange:e=>g(t=>({...t,kind:e.target.value})),disabled:d,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[i.artifactUpload.fileLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",onChange:e=>g(t=>{var s,r;return{...t,file:null!=(r=null==(s=e.target.files)?void 0:s[0])?r:null}}),disabled:d,type:"file"})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:null!=c?c:i.notAvailable}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:d||!x.stageRunId||!x.kind||!x.file||b,children:i.artifactUpload.submitLabel})]})]})]})}function u(e){var t,s,n,l;let{candidate:i,strings:o}=e;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:o.overview.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:o.overview.title})]}),(0,r.jsxs)(a.BJ,{gap:3,className:"mt-4 text-sm",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:o.fields.candidateId}),(0,r.jsx)("div",{className:"font-mono text-xs text-foreground/70",children:null!=(t=null==i?void 0:i.id)?t:o.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:o.fields.stageStatus}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(s=null==i?void 0:i.stageStatus)?s:o.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:o.fields.decision}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(n=null==i?void 0:i.decision)?n:o.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:o.fields.decisionReason}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(l=null==i?void 0:i.decisionReason)?l:o.notAvailable})]})]})]})}let c={reasonCode:"",severity:"short_cooldown",recheckDays:"21",whatWouldChange:""};function m(e){var t,s,l,i;let{candidateId:o,candidate:d,loading:u,strings:m,onUpdated:x}=e,[g,p]=(0,n.useState)(c),[f,b]=(0,n.useState)(!1),[h,v]=(0,n.useState)(null),y=null!=(t=null==d?void 0:d.cooldown)?t:null,j=(null==y?void 0:y.active)?m.cooldown.activeLabel:m.cooldown.noneLabel,N=(null==y?void 0:y.active)?m.cooldown.activeMessage:m.cooldown.noneMessage,w=function(e,t){if(!e)return t;let s=Date.parse(e);return Number.isNaN(s)?t:new Date(s).toLocaleDateString("en-GB")}(null!=(s=null==y?void 0:y.recheckAfter)?s:null,m.cooldown.severityPermanent),k=(l=null==y?void 0:y.severity,i=m.cooldown,l?"permanent"===l?i.severityPermanent:"long_cooldown"===l?i.severityLong:i.severityShort:i.severityShort),C=(0,n.useCallback)(async e=>{if(e.preventDefault(),!d)return;let t=g.reasonCode.trim(),s=g.whatWouldChange.trim();if(!t||!s)return void v({tone:"error",text:m.cooldown.errorMessage});let r={candidateId:o,reasonCode:t,severity:g.severity,whatWouldChange:s};if("permanent"!==g.severity){let e=Number.parseInt(g.recheckDays,10);if(!Number.isFinite(e)||e<=0)return void v({tone:"error",text:m.cooldown.errorMessage});r.recheckAfterDays=e}b(!0),v(null);try{(await fetch("/api/cooldowns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok?(v({tone:"success",text:m.cooldown.successMessage}),p(c)):v({tone:"error",text:m.cooldown.errorMessage})}catch(e){console.error(e),v({tone:"error",text:m.cooldown.errorMessage})}finally{b(!1),await x()}},[d,o,g.reasonCode,g.recheckDays,g.severity,g.whatWouldChange,x,m.cooldown]),S=f||u||!d,R=(0,n.useMemo)(()=>{var e;return(null==y?void 0:y.active)?{reason:y.reasonCode,severity:k,recheck:w,change:null!=(e=y.whatWouldChange)?e:m.notAvailable}:null},[y,w,k,m.notAvailable]);return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:m.cooldown.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:m.cooldown.title})]}),(0,r.jsxs)("div",{className:"mt-4 rounded-2xl border border-border-1 bg-surface-2 px-4 py-3 text-sm",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:j}),R?(0,r.jsxs)(a.BJ,{gap:2,className:"mt-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.cooldown.reasonLabel}),(0,r.jsx)("div",{className:"font-semibold",children:R.reason})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.cooldown.severityLabel}),(0,r.jsx)("div",{className:"font-semibold",children:R.severity})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.cooldown.recheckLabel}),(0,r.jsx)("div",{className:"font-semibold",children:R.recheck})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.cooldown.whatWouldChangeLabel}),(0,r.jsx)("div",{className:"font-semibold",children:R.change})]})]}):(0,r.jsx)("div",{className:"mt-2 text-xs text-foreground/60",children:N})]}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4",onSubmit:C,children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[m.cooldown.reasonLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:g.reasonCode,onChange:e=>p(t=>({...t,reasonCode:e.target.value})),disabled:S,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[m.cooldown.severityLabel,(0,r.jsxs)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:g.severity,onChange:e=>p(t=>({...t,severity:e.target.value})),disabled:S,children:[(0,r.jsx)("option",{value:"short_cooldown",children:m.cooldown.severityShort}),(0,r.jsx)("option",{value:"long_cooldown",children:m.cooldown.severityLong}),(0,r.jsx)("option",{value:"permanent",children:m.cooldown.severityPermanent})]})]}),"permanent"!==g.severity?(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[m.cooldown.recheckLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:g.recheckDays,onChange:e=>p(t=>({...t,recheckDays:e.target.value})),disabled:S,type:"number",min:1,max:3650})]}):null,(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[m.cooldown.whatWouldChangeLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:g.whatWouldChange,onChange:e=>p(t=>({...t,whatWouldChange:e.target.value})),disabled:S,type:"text"})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3",children:[h?(0,r.jsx)("span",{className:"success"===h.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:h.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:N}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:S,children:m.cooldown.submitLabel})]})]})]})}function x(e){var t,s,n,l,i,o,d,u;let{candidate:c,strings:m}=e;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:m.lead.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:m.lead.title})]}),(0,r.jsxs)(a.BJ,{gap:3,className:"mt-4 text-sm",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.fields.leadTitle}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(i=null==c||null==(t=c.lead)?void 0:t.title)?i:m.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.fields.leadSource}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(o=null==c||null==(s=c.lead)?void 0:s.source)?o:m.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.fields.leadUrl}),(0,r.jsx)("div",{className:"text-sm font-semibold break-all",children:null!=(d=null==c||null==(n=c.lead)?void 0:n.url)?d:m.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:m.fields.leadStatus}),(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(u=null==c||null==(l=c.lead)?void 0:l.status)?u:m.notAvailable})]})]})]})}var g=s(5480);function p(e){var t;let{summary:s,strings:n,notAvailable:l}=e;if(!s)return null;let i=function(e,t,s){if(!e)return s;switch(e){case"advance":return t.advance;case"review":return t.review;case"reject":return t.reject;default:return s}}(null!=(t=s.action)?t:null,n.actions,l);return(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryMargin}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==s.marginPct&&void 0!==s.marginPct?(0,g.l9)(s.marginPct/100):l})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryNetPerUnit}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:function(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}(s.netPerUnitCents,l)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryThreshold}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==s.targetMarginPct&&void 0!==s.targetMarginPct?(0,g.l9)(s.targetMarginPct/100):l})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryAction}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:i})]})]})}function f(e){let{form:t,setForm:s,disabled:n,strings:a,onEdit:l}=e,i=e=>t=>{let r=t.target.value;s(t=>({...t,[e]:r})),l()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputSalePrice,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.salePrice,onChange:i("salePrice"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputUnitCost,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.unitCost,onChange:i("unitCost"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputShipping,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.shipping,onChange:i("shipping"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputFeesPct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.feesPct,onChange:i("feesPct"),disabled:n,type:"number",min:0,max:100,step:"0.1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetMarginPct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetMarginPct,onChange:i("targetMarginPct"),disabled:n,type:"number",min:0,max:100,step:"0.1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.notes,onChange:i("notes"),disabled:n})]})]})}let b={salePrice:"24.99",unitCost:"8.5",shipping:"2.0",feesPct:"15",targetMarginPct:"25",notes:""};function h(e){let t=e.trim();if(!t)return null;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}function v(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0||s>100?null:s}function y(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"A"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(b),[y,j]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),[k,C]=(0,n.useState)(null),S=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t;y||g((e=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c))?{salePrice:void 0!==e.salePriceCents?String(e.salePriceCents/100):"24.99",unitCost:void 0!==e.unitCostCents?String(e.unitCostCents/100):"8.5",shipping:void 0!==e.shippingCents?String(e.shippingCents/100):"2.0",feesPct:void 0!==e.feesPct?String(e.feesPct):"15",targetMarginPct:void 0!==e.targetMarginPct?String(e.targetMarginPct):"25",notes:null!=(t=e.notes)?t:""}:b)},[y,c]);let R=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;C(null),w(!0);let t=function(e){let t=h(e.salePrice),s=h(e.unitCost);if(null===t||null===s)return null;let r=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}(e.shipping),n=v(e.feesPct),a=v(e.targetMarginPct);return null===r||null===n||null===a?null:{salePriceCents:t,unitCostCents:s,...void 0!==r?{shippingCents:r}:{},...void 0!==n?{feesPct:n}:{},...void 0!==a?{targetMarginPct:a}:{}}}(x);if(!t){C({tone:"error",text:d.stageA.errorInvalid}),w(!1);return}let r={candidateId:s,...t,...x.notes.trim()?{notes:x.notes.trim()}:{}};try{let e=await fetch("/api/stages/a/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json().catch(()=>null);if(e.ok)C({tone:"success",text:d.stageA.success});else{var n;let e=null==t||null==(n=t.details)?void 0:n.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageA.errorRun;C({tone:"error",text:s})}}catch(e){console.error(e),C({tone:"error",text:d.stageA.errorRun})}finally{w(!1),await u()}},[l,s,x,u,d.cooldown,d.stageA]),M=N||o||S;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageA.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageA.title})]}),(0,r.jsx)(p,{summary:m,strings:d.stageA,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:R,children:[(0,r.jsx)(f,{form:x,setForm:g,disabled:M,strings:d.stageA,onEdit:()=>j(!0)}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[k?(0,r.jsx)("span",{className:"success"===k.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:k.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:S?d.cooldown.activeMessage:d.stageA.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:M,children:d.stageA.runLabel})]})]})]})}function j(e){var t,s,l,i,o,d;let{laneMeta:u,disabled:c,strings:m,notAvailable:x,onApplied:g}=e,[p,f]=(0,n.useState)([]),[b,h]=(0,n.useState)(!0),[v,y]=(0,n.useState)(""),[j,N]=(0,n.useState)(null),[w,k]=(0,n.useState)(!1),C=(0,n.useCallback)(async()=>{h(!0),N(null);try{let e=await fetch("/api/logistics/lanes?limit=200&active=true");if(!e.ok)return void N({tone:"error",text:m.lane.errorLoad});let t=await e.json();t.ok&&Array.isArray(t.lanes)?f(t.lanes):N({tone:"error",text:m.lane.errorLoad})}catch(e){console.error(e),N({tone:"error",text:m.lane.errorLoad})}finally{h(!1)}},[m.lane.errorLoad]);(0,n.useEffect)(()=>{C()},[C]);let S=(0,n.useMemo)(()=>p.filter(e=>{var t;return null==(t=e.latestVersion)?void 0:t.id}),[p]),R=(0,n.useCallback)(async()=>{if(!v)return void N({tone:"error",text:m.lane.errorApply});k(!0),N(null);try{var e,t,s,r,n,a,l,i,o,d,u,c,x,p,f,b,h;let y=await fetch("/api/logistics/lane-versions/".concat(v));if(!y.ok)return void N({tone:"error",text:m.lane.errorApply});let j=await y.json();if(!j.ok||!j.version)return void N({tone:"error",text:m.lane.errorApply});let w=null!=(e=j.lane)?e:null,k=j.version,C={laneId:null!=(t=null==w?void 0:w.id)?t:null,laneName:null!=(s=null==w?void 0:w.name)?s:null,laneModel:null!=(r=null==w?void 0:w.model)?r:null,laneIncoterm:null!=(n=null==w?void 0:w.incoterm)?n:null,laneVersionId:k.id,laneVersionLabel:null!=(a=k.versionLabel)?a:null,laneStatus:null!=(l=k.status)?l:null,laneConfidence:null!=(i=k.confidence)?i:null,laneExpiresAt:null!=(o=k.expiresAt)?o:null,laneCurrency:null!=(d=k.currency)?d:null,laneSourceCurrency:null!=(u=k.sourceCurrency)?u:null,laneFxRate:null!=(c=k.fxRate)?c:null,laneFxDate:null!=(x=k.fxDate)?x:null,laneFxSource:null!=(p=k.fxSource)?p:null,laneLeadTimeBaseDays:null!=(f=k.leadTimeBaseDays)?f:null,laneCostBasis:null!=(b=k.costBasis)?b:null,laneCostAmount:null!=(h=k.costAmount)?h:null},S={...null===k.costAmount||void 0===k.costAmount?{}:{freight:String(k.costAmount)},...null===k.leadTimeBaseDays||void 0===k.leadTimeBaseDays?{}:{leadTimeDays:String(k.leadTimeBaseDays)},...(null==w?void 0:w.incoterm)?{incoterms:w.incoterm}:{}};g(C,S),N({tone:"success",text:m.lane.successApply})}catch(e){console.error(e),N({tone:"error",text:m.lane.errorApply})}finally{k(!1)}},[g,v,m.lane.errorApply,m.lane.successApply]),M=function(e,t){if(!e)return null;let s=new Date(e);if(Number.isNaN(s.getTime()))return null;let r=Math.ceil((s.getTime()-Date.now())/864e5);return r<0?t.lane.warningExpired:r<=14?t.lane.warningExpiring.replace("{days}",String(r)):null}(null==u?void 0:u.laneExpiresAt,m),P=function(e,t){if(!e)return null;let s=e.toUpperCase();return"C0"===s||"C1"===s?t.lane.warningLowConfidence.replace("{confidence}",e):null}(null!=(t=null==u?void 0:u.laneConfidence)?t:null,m),D=!function(e){if(!e)return!1;let t=e.toLowerCase();return!(t.includes("unit")||t.includes("/unit"))}(null!=(s=null==u?void 0:u.laneCostBasis)?s:null)?null:m.lane.warningBasis,A=u?"".concat(null!=(l=u.laneName)?l:x," | ").concat(null!=(i=u.laneConfidence)?i:x," | ").concat(null!=(o=u.laneCostAmount)?o:x," ").concat(null!=(d=u.laneCostBasis)?d:""):m.lane.appliedEmpty;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:m.lane.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:m.lane.title})]}),(0,r.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[m.lane.selectLabel,(0,r.jsxs)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v,onChange:e=>y(e.target.value),disabled:c||b||w,children:[(0,r.jsx)("option",{value:"",children:m.lane.selectPlaceholder}),S.map(e=>{var t,s,n,a;return(0,r.jsx)("option",{value:null!=(n=null==(t=e.latestVersion)?void 0:t.id)?n:"",children:function(e){var t,s;if(!e.latestVersion)return e.name;let r=e.latestVersion,n=null!=(t=r.confidence)?t:"-",a=null===r.costAmount||void 0===r.costAmount?"-":String(r.costAmount),l=null!=(s=r.costBasis)?s:"",i=null===r.leadTimeBaseDays||void 0===r.leadTimeBaseDays?"-":"".concat(r.leadTimeBaseDays,"d");return"".concat(e.name," | ").concat(n," | ").concat(a," ").concat(l," | ").concat(i)}(e)},null!=(a=null==(s=e.latestVersion)?void 0:s.id)?a:e.id)})]})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:j?j.text:m.lane.help}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full border border-border-2 px-4 py-2 text-xs font-semibold disabled:cursor-not-allowed disabled:opacity-60",type:"button",onClick:R,disabled:c||b||w||0===S.length,children:m.lane.applyLabel})]})]}),(0,r.jsxs)("div",{className:"mt-4 rounded-2xl border border-border-1 bg-surface-2 px-4 py-3 text-xs text-foreground/70",children:[(0,r.jsx)("div",{className:"text-foreground/60",children:m.lane.appliedLabel}),(0,r.jsx)("div",{className:"mt-1 font-semibold",children:A}),M?(0,r.jsx)("div",{className:"mt-2 text-amber-600",children:M}):null,P?(0,r.jsx)("div",{className:"mt-2 text-amber-600",children:P}):null,D?(0,r.jsx)("div",{className:"mt-2 text-amber-600",children:D}):null,b&&0===S.length?(0,r.jsx)("div",{className:"mt-2 text-foreground/60",children:m.lane.loading}):null,b||0!==S.length?null:(0,r.jsx)("div",{className:"mt-2 text-foreground/60",children:m.lane.empty})]})]})}function N(e){let{strings:t}=e;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:t.label}),(0,r.jsx)("h3",{className:"text-lg font-semibold tracking-tight",children:t.title})]}),(0,r.jsxs)("div",{className:"mt-4 grid gap-6 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:t.glossaryLabel}),(0,r.jsxs)("ul",{className:"mt-2 space-y-2 text-sm text-foreground/70",children:[(0,r.jsx)("li",{children:t.glossaryFba}),(0,r.jsx)("li",{children:t.glossaryIncoterms})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:t.costTimingLabel}),(0,r.jsx)("div",{className:"mt-2 text-sm text-foreground/70",children:t.costTimingText}),(0,r.jsx)("div",{className:"mt-4 text-xs uppercase tracking-widest text-foreground/60",children:t.confidenceLabel}),(0,r.jsx)("div",{className:"mt-2 text-sm text-foreground/70",children:t.confidenceText})]})]})]})}function w(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}function k(e){var t;let{summary:s,strings:n,notAvailable:l}=e;if(!s)return null;let i=null!==s.depositPct&&void 0!==s.depositPct?"".concat(s.depositPct.toFixed(0),"%"):l;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryUnitCost}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:w(s.perUnitLandedCostCents,l)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryTotalCost}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:w(s.totalLandedCostCents,l)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryDeposit}),(0,r.jsxs)("div",{className:"mt-1 text-sm font-semibold",children:[w(s.depositAmountCents,l)," ",(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:i})]})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryBalance}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:w(s.balanceAmountCents,l)})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-xs text-foreground/60",children:[n.summaryLeadTime,":"," ",null!=(t=s.leadTimeDays)?t:l,null!==s.balanceDueDay&&void 0!==s.balanceDueDay?" \xb7 ".concat(s.balanceDueDay):""]})]})}function C(e){let{form:t,setForm:s,disabled:n,strings:a,onEdit:l}=e,i=e=>t=>{let r=t.target.value;s(t=>({...t,[e]:r})),l()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputUnitsPlanned,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.unitsPlanned,onChange:i("unitsPlanned"),disabled:n,type:"number",min:1,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputUnitCost,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.unitCost,onChange:i("unitCost"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputFreight,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.freight,onChange:i("freight"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputDuty,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.duty,onChange:i("duty"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputVat,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.vat,onChange:i("vat"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputPackaging,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.packaging,onChange:i("packaging"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputInspection,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.inspection,onChange:i("inspection"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputOther,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.other,onChange:i("other"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputLeadTime,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.leadTimeDays,onChange:i("leadTimeDays"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputDepositPct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.depositPct,onChange:i("depositPct"),disabled:n,type:"number",min:0,max:100,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputBalanceDueDays,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.balanceDueDays,onChange:i("balanceDueDays"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputIncoterms,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.incoterms,onChange:i("incoterms"),disabled:n,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.notes,onChange:i("notes"),disabled:n})]})]})}let S={unitsPlanned:"500",unitCost:"5.5",freight:"1.2",duty:"0.3",vat:"0.8",packaging:"0.25",inspection:"0.1",other:"",leadTimeDays:"45",depositPct:"30",balanceDueDays:"0",incoterms:"FOB",notes:""};function R(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}function M(e){let t=e.trim();if(!t)return;let s=Number.parseInt(t,10);return!Number.isFinite(s)||s<0?null:s}function P(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"B"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(S),[p,f]=(0,n.useState)(null),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[w,P]=(0,n.useState)(null),D=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t,s;if(b)return;let r=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c);g(r?{unitsPlanned:void 0!==r.unitsPlanned?String(r.unitsPlanned):"500",unitCost:void 0!==r.unitCostCents?String(r.unitCostCents/100):"5.5",freight:void 0!==r.freightCents?String(r.freightCents/100):"1.2",duty:void 0!==r.dutyCents?String(r.dutyCents/100):"0.3",vat:void 0!==r.vatCents?String(r.vatCents/100):"0.8",packaging:void 0!==r.packagingCents?String(r.packagingCents/100):"0.25",inspection:void 0!==r.inspectionCents?String(r.inspectionCents/100):"0.1",other:void 0!==r.otherCents?String(r.otherCents/100):"",leadTimeDays:void 0!==r.leadTimeDays?String(r.leadTimeDays):"45",depositPct:void 0!==r.depositPct?String(r.depositPct):"30",balanceDueDays:void 0!==r.balanceDueDays?String(r.balanceDueDays):"0",incoterms:null!=(t=r.incoterms)?t:"FOB",notes:null!=(s=r.notes)?s:""}:S),f(null!=(e=null==r?void 0:r.lane)?e:null)},[b,c]);let A=(0,n.useCallback)((e,t)=>{h(!0),f(e),g(e=>({...e,...void 0!==t.freight?{freight:t.freight}:{},...void 0!==t.leadTimeDays?{leadTimeDays:t.leadTimeDays}:{},...void 0!==t.incoterms?{incoterms:t.incoterms}:{}}))},[]),T=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;P(null),y(!0);let t=function(e){let t=function(e){let t=Number.parseInt(e,10);return!Number.isFinite(t)||t<=0?null:t}(e.unitsPlanned),s=function(e){let t=e.trim();if(!t)return null;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}(e.unitCost);if(null===t||null===s)return null;let r=R(e.freight),n=R(e.duty),a=R(e.vat),l=R(e.packaging),i=R(e.inspection),o=R(e.other),d=M(e.leadTimeDays),u=M(e.balanceDueDays),c=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0||s>100?null:s}(e.depositPct);return null===r||null===n||null===a||null===l||null===i||null===o||null===d||null===u||null===c?null:{unitsPlanned:t,unitCostCents:s,...void 0!==r?{freightCents:r}:{},...void 0!==n?{dutyCents:n}:{},...void 0!==a?{vatCents:a}:{},...void 0!==l?{packagingCents:l}:{},...void 0!==i?{inspectionCents:i}:{},...void 0!==o?{otherCents:o}:{},...void 0!==d?{leadTimeDays:d}:{},...void 0!==c?{depositPct:c}:{},...void 0!==u?{balanceDueDays:u}:{}}}(x);if(!t){P({tone:"error",text:d.stageB.errorInvalid}),y(!1);return}let r={candidateId:s,...t,...x.incoterms.trim()?{incoterms:x.incoterms.trim()}:{},...x.notes.trim()?{notes:x.notes.trim()}:{},...p?{lane:p}:{}};try{let e=await fetch("/api/stages/b/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json().catch(()=>null);if(e.ok)P({tone:"success",text:d.stageB.success});else{var n;let e=null==t||null==(n=t.details)?void 0:n.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageB.errorRun;P({tone:"error",text:s})}}catch(e){console.error(e),P({tone:"error",text:d.stageB.errorRun})}finally{y(!1),await u()}},[l,s,x,p,u,d.cooldown,d.stageB]),L=v||o||D;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageB.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageB.title})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(j,{laneMeta:p,disabled:L,strings:d.stageB,notAvailable:d.notAvailable,onApplied:A})}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(N,{strings:d.stageB.guidance})}),(0,r.jsx)(k,{summary:m,strings:d.stageB,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:T,children:[(0,r.jsx)(C,{form:x,setForm:g,disabled:L,strings:d.stageB,onEdit:()=>h(!0)}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[w?(0,r.jsx)("span",{className:"success"===w.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:w.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:D?d.cooldown.activeMessage:d.stageB.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:L,children:d.stageB.runLabel})]})]})]})}function D(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}function A(e){var t;let{summary:s,strings:n,notAvailable:l}=e;return s?(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-5",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryNetRevenue}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:D(s.netRevenuePerUnitCents,l)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryContribution}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:D(s.contributionPerUnitCents,l)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryMargin}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==s.contributionMarginPct&&void 0!==s.contributionMarginPct?(0,g.l9)(s.contributionMarginPct/100):l})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryPayoutDelay}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(t=s.payoutDelayDays)?t:l})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:n.summaryTotalContribution}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:D(s.totalContributionCents,l)})]})]}):null}function T(e){let{form:t,setForm:s,disabled:n,strings:a,onEdit:l}=e,i=e=>t=>{let r=t.target.value;s(t=>({...t,[e]:r})),l()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputSalePrice,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.salePrice,onChange:i("salePrice"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputPlatformFeePct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.platformFeePct,onChange:i("platformFeePct"),disabled:n,type:"number",min:0,max:100,step:"0.1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputFulfillment,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.fulfillment,onChange:i("fulfillment"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputStorage,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.storage,onChange:i("storage"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputAdvertising,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.advertising,onChange:i("advertising"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputOtherFees,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.otherFees,onChange:i("otherFees"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputReturnRatePct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.returnRatePct,onChange:i("returnRatePct"),disabled:n,type:"number",min:0,max:100,step:"0.1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputPayoutDelay,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.payoutDelayDays,onChange:i("payoutDelayDays"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputUnitsPlanned,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.unitsPlanned,onChange:i("unitsPlanned"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.notes,onChange:i("notes"),disabled:n})]})]})}let L={salePrice:"24.9",platformFeePct:"15",fulfillment:"3.2",storage:"0.3",advertising:"1.1",otherFees:"",returnRatePct:"4",payoutDelayDays:"14",unitsPlanned:"500",notes:""};function F(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}function B(e){let t=e.trim();if(!t)return;let s=Number.parseInt(t,10);return!Number.isFinite(s)||s<0?null:s}function I(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"C"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(L),[p,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),j=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t;p||g((e=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c))?{salePrice:void 0!==e.salePriceCents?String(e.salePriceCents/100):"24.9",platformFeePct:void 0!==e.platformFeePct?String(e.platformFeePct):"15",fulfillment:void 0!==e.fulfillmentFeeCents?String(e.fulfillmentFeeCents/100):"3.2",storage:void 0!==e.storageFeeCents?String(e.storageFeeCents/100):"0.3",advertising:void 0!==e.advertisingCents?String(e.advertisingCents/100):"1.1",otherFees:void 0!==e.otherFeesCents?String(e.otherFeesCents/100):"",returnRatePct:void 0!==e.returnRatePct?String(e.returnRatePct):"4",payoutDelayDays:void 0!==e.payoutDelayDays?String(e.payoutDelayDays):"14",unitsPlanned:void 0!==e.unitsPlanned?String(e.unitsPlanned):"500",notes:null!=(t=e.notes)?t:""}:L)},[p,c]);let N=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;y(null),h(!0);let t=function(e){let t=function(e){let t=e.trim();if(!t)return null;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}(e.salePrice),s=function(e){let t=e.trim();if(!t)return null;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0||s>100?null:s}(e.platformFeePct);if(null===t||null===s)return null;let r=F(e.fulfillment),n=F(e.storage),a=F(e.advertising),l=F(e.otherFees),i=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0||s>100?null:s}(e.returnRatePct),o=B(e.payoutDelayDays),d=B(e.unitsPlanned);return null===r||null===n||null===a||null===l||null===i||null===o||null===d?null:{salePriceCents:t,platformFeePct:s,...void 0!==r?{fulfillmentFeeCents:r}:{},...void 0!==n?{storageFeeCents:n}:{},...void 0!==a?{advertisingCents:a}:{},...void 0!==l?{otherFeesCents:l}:{},...void 0!==i?{returnRatePct:i}:{},...void 0!==o?{payoutDelayDays:o}:{},...void 0!==d?{unitsPlanned:d}:{}}}(x);if(!t){y({tone:"error",text:d.stageC.errorInvalid}),h(!1);return}let r={candidateId:s,...t,...x.notes.trim()?{notes:x.notes.trim()}:{}};try{let e=await fetch("/api/stages/c/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json().catch(()=>null);if(e.ok)y({tone:"success",text:d.stageC.success});else{var n;let e=null==t||null==(n=t.details)?void 0:n.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageC.errorRun;y({tone:"error",text:s})}}catch(e){console.error(e),y({tone:"error",text:d.stageC.errorRun})}finally{h(!1),await u()}},[l,s,x,u,d.cooldown,d.stageC]),w=b||o||j;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageC.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageC.title})]}),(0,r.jsx)(A,{summary:m,strings:d.stageC,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:N,children:[(0,r.jsx)(T,{form:x,setForm:g,disabled:w,strings:d.stageC,onEdit:()=>f(!0)}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[v?(0,r.jsx)("span",{className:"success"===v.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:v.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:j?d.cooldown.activeMessage:d.stageC.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:w,children:d.stageC.runLabel})]})]})]})}function _(e){var t,s,n,l;let{summary:i,strings:o,notAvailable:d}=e;if(!i)return null;let u=function(e,t,s){if(!e)return s;switch(e){case"not_started":return t.notStarted;case"in_progress":return t.inProgress;case"ready":return t.ready;default:return s}}(null!=(t=i.assetReadiness)?t:null,o.assetReadiness,d);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryAssetReadiness}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:u})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryOneTimeCost}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:function(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}(i.oneTimeCostCents,d)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summarySamplingRounds}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(s=i.samplingRounds)?s:d})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryLeadTime}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(n=i.leadTimeDays)?n:d})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-xs text-foreground/60",children:[o.summaryPackagingStatus,": ",null!=(l=i.packagingStatus)?l:d]})]})}function O(e){let{form:t,setForm:s,disabled:n,strings:a,readinessOptions:l,onEdit:i}=e,o=e=>t=>{let r=t.target.value;s(t=>({...t,[e]:r})),i()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputAssetReadiness,(0,r.jsx)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.assetReadiness,onChange:e=>{s(t=>({...t,assetReadiness:e.target.value})),i()},disabled:n,children:l.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputOneTimeCost,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.oneTimeCost,onChange:o("oneTimeCost"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputSamplingRounds,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.samplingRounds,onChange:o("samplingRounds"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputLeadTime,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.leadTimeDays,onChange:o("leadTimeDays"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputPackagingStatus,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.packagingStatus,onChange:o("packagingStatus"),disabled:n,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.notes,onChange:o("notes"),disabled:n})]})]})}let E={assetReadiness:"not_started",oneTimeCost:"",samplingRounds:"",leadTimeDays:"",packagingStatus:"",notes:""};function J(e){let t=e.trim();if(!t)return;let s=Number.parseInt(t,10);return!Number.isFinite(s)||s<0?null:s}function U(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"D"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(E),[p,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),j=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t,s,r;p||g((e=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c))?{assetReadiness:null!=(t=e.assetReadiness)?t:"not_started",oneTimeCost:void 0!==e.oneTimeCostCents?String(e.oneTimeCostCents/100):"",samplingRounds:void 0!==e.samplingRounds?String(e.samplingRounds):"",leadTimeDays:void 0!==e.leadTimeDays?String(e.leadTimeDays):"",packagingStatus:null!=(s=e.packagingStatus)?s:"",notes:null!=(r=e.notes)?r:""}:E)},[p,c]);let N=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;y(null),h(!0);let t=function(e){let t=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}(e.oneTimeCost),s=J(e.samplingRounds),r=J(e.leadTimeDays);if(null===t||null===s||null===r)return null;let n=e.packagingStatus.trim();return{assetReadiness:e.assetReadiness,...void 0!==t?{oneTimeCostCents:t}:{},...void 0!==s?{samplingRounds:s}:{},...void 0!==r?{leadTimeDays:r}:{},...n?{packagingStatus:n}:{}}}(x);if(!t){y({tone:"error",text:d.stageD.errorInvalid}),h(!1);return}let r={candidateId:s,...t,...x.notes.trim()?{notes:x.notes.trim()}:{}};try{let e=await fetch("/api/stages/d/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json().catch(()=>null);if(e.ok)y({tone:"success",text:d.stageD.success});else{var n;let e=null==t||null==(n=t.details)?void 0:n.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageD.errorRun;y({tone:"error",text:s})}}catch(e){console.error(e),y({tone:"error",text:d.stageD.errorRun})}finally{h(!1),await u()}},[l,s,x,u,d.cooldown,d.stageD]),w=b||o||j,k=[{value:"not_started",label:d.stageD.assetReadiness.notStarted},{value:"in_progress",label:d.stageD.assetReadiness.inProgress},{value:"ready",label:d.stageD.assetReadiness.ready}];return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageD.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageD.title})]}),(0,r.jsx)(_,{summary:m,strings:d.stageD,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:N,children:[(0,r.jsx)(O,{form:x,setForm:g,disabled:w,strings:d.stageD,readinessOptions:k,onEdit:()=>f(!0)}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[v?(0,r.jsx)("span",{className:"success"===v.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:v.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:j?d.cooldown.activeMessage:d.stageD.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:w,children:d.stageD.runLabel})]})]})]})}function q(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}function z(e){var t,s,l,i,o,d,u;let{candidateId:c,disabled:m,strings:x,notAvailable:p}=e,[f,b]=(0,n.useState)([]),[h,v]=(0,n.useState)([]),[y,j]=(0,n.useState)(!0),[N,w]=(0,n.useState)(!1),[k,C]=(0,n.useState)(null),[S,R]=(0,n.useState)(null),M=(0,n.useCallback)(async()=>{j(!0),C(null);try{let e=await fetch("/api/logistics/lanes?limit=200&active=true");if(!e.ok)return void C({tone:"error",text:x.errorLoad});let t=await e.json();t.ok&&Array.isArray(t.lanes)?b(t.lanes):C({tone:"error",text:x.errorLoad})}catch(e){console.error(e),C({tone:"error",text:x.errorLoad})}finally{j(!1)}},[x.errorLoad]);(0,n.useEffect)(()=>{M()},[M]);let P=(0,n.useMemo)(()=>f.filter(e=>{var t;return null==(t=e.latestVersion)?void 0:t.id}),[f]),D=(0,n.useCallback)(e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),A=(0,n.useCallback)(async()=>{if(0===h.length)return void C({tone:"error",text:x.empty});w(!0),C(null);try{let e=await fetch("/api/stages/k/compare-lanes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:c,laneVersionIds:h})}),t=await e.json().catch(()=>null);if(!e.ok||!(null==t?void 0:t.ok))return void C({tone:"error",text:x.errorCompare});R(t),C({tone:"success",text:x.successCompare})}catch(e){console.error(e),C({tone:"error",text:x.errorCompare})}finally{w(!1)}},[c,h,x.empty,x.errorCompare,x.successCompare]),T=null!=(l=null==S||null==(t=S.base)?void 0:t.summary)?l:null,L=null!=(i=null==S||null==(s=S.base)?void 0:s.lane)?i:null,F=null!=(o=null==S?void 0:S.comparisons)?o:[],B=(0,n.useCallback)(e=>e.warnings.map(t=>{var s,r;switch(t.code){case"expired":return x.warningExpired;case"expiring":return x.warningExpiring.replace("{days}",String(null!=(s=t.days)?s:"-"));case"low_confidence":return x.warningLowConfidence.replace("{confidence}",null!=(r=e.laneConfidence)?r:p);case"basis_non_unit":return x.warningBasis;case"missing_cost":return x.warningMissingCost;case"missing_lead_time":return x.warningMissingLeadTime;default:return null}}).filter(Boolean).join(" "),[p,x]);return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:x.label}),(0,r.jsx)("h3",{className:"text-xl font-semibold tracking-tight",children:x.title})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:x.selectLabel}),(0,r.jsxs)(a.xA,{cols:1,gap:2,className:"mt-2",children:[y&&0===P.length?(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.loading}):null,y||0!==P.length?null:(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.noLanes}),P.map(e=>{var t,s;let n=null!=(s=null==(t=e.latestVersion)?void 0:t.id)?s:"",a=h.includes(n);return(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm text-foreground/80",children:[(0,r.jsx)("input",{type:"checkbox",checked:a,onChange:()=>D(n),disabled:m||y||N||!n}),(0,r.jsx)("span",{children:function(e){var t,s;if(!e.latestVersion)return e.name;let r=e.latestVersion,n=null!=(t=r.confidence)?t:"-",a=null===r.costAmount||void 0===r.costAmount?"-":String(r.costAmount),l=null!=(s=r.costBasis)?s:"",i=null===r.leadTimeBaseDays||void 0===r.leadTimeBaseDays?"-":"".concat(r.leadTimeBaseDays,"d");return"".concat(e.name," | ").concat(n," | ").concat(a," ").concat(l," | ").concat(i)}(e)})]},n||e.id)})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"mt-3 gap-3",children:[(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:k?k.text:x.help}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full border border-border-2 px-4 py-2 text-xs font-semibold disabled:cursor-not-allowed disabled:opacity-60",type:"button",onClick:A,disabled:m||y||N||0===h.length,children:x.compareLabel})]})]}),T?(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:x.baseLabel}),(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-2 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryPeakCash}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:q(T.peakCashOutlayCents,p)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryPayback}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(d=T.paybackDay)?d:p})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryReturn}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:(0,g.l9)(T.annualizedCapitalReturnRate)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.baseLaneLabel}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:"object"==typeof L&&L&&null!=(u=L.laneName)?u:p})]})]})]}):null,F.length>0?(0,r.jsxs)("div",{className:"mt-6 grid gap-4",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:x.resultsLabel}),F.map(e=>{var t,s,n,l,i,o,d,u,c,m;let f=B(e);return(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-4",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:null!=(t=e.laneName)?t:p}),(0,r.jsxs)("div",{className:"mt-1 text-xs text-foreground/60",children:[null!=(s=e.laneModel)?s:p," |"," ",null!=(n=e.laneConfidence)?n:p," |"," ",null!=(l=e.laneCostAmount)?l:p," ",null!=(i=e.laneCostBasis)?i:""]}),(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryPeakCash}),(0,r.jsxs)("div",{className:"mt-1 text-sm font-semibold",children:[q(e.summary.peakCashOutlayCents,p)," ",(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:function(e,t,s){if(!e||!t)return s;try{let s=BigInt(t)-BigInt(e);if(0n===s)return"0";let r=s>0n?"+":"-",n=(0,g.vv)(s<0n?-s:s);return"".concat(r).concat(n)}catch(e){return s}}(null==T?void 0:T.peakCashOutlayCents,e.summary.peakCashOutlayCents,p)})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryPayback}),(0,r.jsxs)("div",{className:"mt-1 text-sm font-semibold",children:[null!=(o=e.summary.paybackDay)?o:p," ",(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:function(e,t,s){if(null==e||null==t)return s;let r=t-e;return Number.isFinite(r)?0===r?"0d":"".concat(r>0?"+":"-").concat(Math.abs(r),"d"):s}(null!=(d=null==T?void 0:T.paybackDay)?d:null,null!=(u=e.summary.paybackDay)?u:null,p)})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:x.summaryReturn}),(0,r.jsxs)("div",{className:"mt-1 text-sm font-semibold",children:[(0,g.l9)(e.summary.annualizedCapitalReturnRate)," ",(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:function(e,t,s){if(null==e||null==t)return s;let r=t-e;if(!Number.isFinite(r))return s;if(0===r)return"0pp";let n=r>0?"+":"-",a=100*Math.abs(r);return"".concat(n).concat((0,g.ZV)(a),"pp")}(null!=(c=null==T?void 0:T.annualizedCapitalReturnRate)?c:null,null!=(m=e.summary.annualizedCapitalReturnRate)?m:null,p)})]})]})]}),f?(0,r.jsx)("div",{className:"mt-3 text-xs text-amber-600",children:f}):null]},e.laneVersionId)})]}):null]})}function K(){return{horizonDays:120,cashflows:[{day:0,amountCents:-68e3},{day:18,amountCents:-6400},{day:30,amountCents:22e3},{day:45,amountCents:28e3},{day:60,amountCents:22e3},{day:85,amountCents:18e3}],unitsPlanned:500,unitsSoldByDay:Array.from({length:121},(e,t)=>Math.min(500,Math.round(5.2*t))),sellThroughTargetPct:.8,salvageValueCents:2800}}function V(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}function H(e){var t,s;let{candidateId:l,candidate:i,stageRuns:o,loading:d,strings:u,onRun:c}=e,m=(0,n.useMemo)(()=>o.find(e=>"K"===e.stage),[o]),x=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(m),[m]),[p,f]=(0,n.useState)(()=>{var e;return JSON.stringify(null!=(e=V(m))?e:K(),null,2)}),[b,h]=(0,n.useState)(null),[v,y]=(0,n.useState)(!1),[j,N]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)(null),R=!!(null==i||null==(t=i.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e;v||(f(JSON.stringify(null!=(e=V(m))?e:K(),null,2)),h(function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;let t=e.input.scenario;return t&&"object"==typeof t?t:null}(m)))},[v,m]);let M=(0,n.useCallback)(async()=>{S(null),k(!0);try{var e;let t=await fetch("/api/stages/k/compose",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:l})}),s=await t.json().catch(()=>null);if(!t.ok)return void((null==s?void 0:s.error)==="stage_b_required"?S({tone:"error",text:u.stageK.composeMissingStageB}):(null==s?void 0:s.error)==="stage_c_required"?S({tone:"error",text:u.stageK.composeMissingStageC}):S({tone:"error",text:u.stageK.composeError}));if(!(null==s?void 0:s.input))return void S({tone:"error",text:u.stageK.composeError});f(JSON.stringify(s.input,null,2)),h(null!=(e=s.scenario)?e:null),y(!0),S({tone:"success",text:u.stageK.composeSuccess})}catch(e){console.error(e),S({tone:"error",text:u.stageK.composeError})}finally{k(!1)}},[l,u.stageK]),P=(0,n.useCallback)(async e=>{let t;e.preventDefault(),S(null),N(!0);try{t=JSON.parse(p)}catch(e){S({tone:"error",text:u.stageK.errorInvalidJson}),N(!1);return}try{let e=await fetch("/api/stages/k/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidateId:l,input:t,...b?{scenario:b}:{}})}),r=await e.json().catch(()=>null);if(e.ok)S({tone:"success",text:u.stageK.success});else{var s;let e=null==r||null==(s=r.details)?void 0:s.reasonCode,t=(null==r?void 0:r.error)==="cooldown_active"?"".concat(u.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):u.stageK.errorRun;S({tone:"error",text:t})}}catch(e){console.error(e),S({tone:"error",text:u.stageK.errorRun})}finally{N(!1),await c()}},[l,p,c,b,u.stageK,u.cooldown]),D=j||d||R,A=w||j||d||R;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:u.stageK.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:u.stageK.title})]}),x?(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageK.summaryPeakCash}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:function(e){if(!e)return"-";try{return(0,g.vv)(BigInt(e))}catch(e){return"-"}}(x.peakCashOutlayCents)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageK.summaryPayback}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(s=x.paybackDay)?s:u.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageK.summaryReturn}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:(0,g.l9)(x.annualizedCapitalReturnRate)})]})]}):null,(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(z,{candidateId:l,disabled:D,strings:u.stageK.laneCompare,notAvailable:u.notAvailable})}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4",onSubmit:P,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3",children:[(0,r.jsx)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:u.stageK.inputLabel}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full border border-border-1 bg-surface-2 px-4 py-2 text-xs font-semibold text-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"button",onClick:M,disabled:A,children:u.stageK.composeLabel})]}),(0,r.jsx)("textarea",{className:"mt-2 min-h-56 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-xs text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p,onChange:e=>{f(e.target.value),h(null),y(!0)},disabled:D})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3",children:[C?(0,r.jsx)("span",{className:"success"===C.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:C.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:R?u.cooldown.activeMessage:"".concat(u.stageK.inputHelp," ").concat(u.stageK.composeHelp)}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:D,children:u.stageK.runLabel})]})]})]})}function G(e,t){return null==e||Number.isNaN(e)?t:new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR",maximumFractionDigits:2}).format(e)}function Y(e){var t,s,n,l;let{summary:o,strings:d,notAvailable:u}=e;if(!o)return null;let c=function(e,t,s){let r=[],n=function(e,t,s){if(!e)return"";switch(e){case"amazon_search":return t.kindAmazonSearch;case"amazon_listing":return t.kindAmazonListing;case"taobao_listing":return t.kindTaobaoListing;default:return e}}(e.kind,t,0);return n&&r.push(n),e.marketplace&&r.push(e.marketplace.toUpperCase()),e.query?r.push(e.query):e.url&&r.push(e.url),r.length>0?r.join(" | "):s}(o,d,u),m=i(null!=(t=o.generatedAt)?t:null,u),x=function(e,t,s){let r=[];if(e.captureMode&&r.push("".concat(t.summaryCaptureMode,": ").concat(e.captureMode)),null!==e.headless&&void 0!==e.headless&&r.push("".concat(t.summaryHeadless,": ").concat(e.headless?t.summaryHeadlessOn:t.summaryHeadlessOff)),null!==e.humanGate&&void 0!==e.humanGate){let s=e.humanGate?t.summaryHumanGateOn:t.summaryHumanGateOff;"accepted"===e.humanGateOutcome?s=t.summaryHumanGateAccepted:"declined"===e.humanGateOutcome&&(s=t.summaryHumanGateDeclined),r.push("".concat(t.summaryHumanGate,": ").concat(s))}return e.playbook&&r.push("".concat(t.summaryPlaybook,": ").concat(e.playbook)),e.sessionProfile&&r.push("".concat(t.summarySession,": ").concat(e.sessionProfile)),null!==e.durationMs&&void 0!==e.durationMs&&r.push("".concat(t.summaryDuration,": ").concat(function(e,t){if(null==e||Number.isNaN(e))return t;let s=e/1e3;return s<1?"".concat(Math.round(e),"ms"):"".concat(s.toFixed(1),"s")}(e.durationMs,s))),r.length>0?r.join(" | "):null}(o,d,u);return(0,r.jsxs)(a.BJ,{gap:3,className:"mt-4",children:[(0,r.jsxs)(a.BJ,{gap:1,className:"text-xs text-foreground/60",children:[(0,r.jsxs)("div",{children:[d.summaryContext,": ",c]}),(0,r.jsxs)("div",{children:[d.summaryGeneratedAt,": ",m]}),x?(0,r.jsxs)("div",{children:[d.summaryCapture,": ",x]}):null]}),(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"md:grid-cols-5",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:d.summaryPriceRange}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:(n=o.priceMin,l=o.priceMax,null==n||null==l?u:"".concat(G(n,u)," - ").concat(G(l,u)))})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:d.summaryMedianPrice}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:G(o.priceMedian,u)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:d.summaryReviewMedian}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==o.reviewMedian&&void 0!==o.reviewMedian?(0,g.ZV)(o.reviewMedian):u})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:d.summarySponsoredShare}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==o.sponsoredShare&&void 0!==o.sponsoredShare?(0,g.l9)(o.sponsoredShare):u})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:d.summarySampleCount}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(s=o.sampleCount)?s:u})]})]})]})}function W(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){let t=Number(e);if(Number.isFinite(t))return t}return null}function Z(e){return"string"==typeof e&&e.trim()?e:null}function Q(e){if("boolean"==typeof e)return e;if("string"==typeof e){if("true"===e.toLowerCase())return!0;if("false"===e.toLowerCase())return!1}return null}let $=/^[a-zA-Z0-9._-]+$/;function X(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onQueued:u}=e,[c,m]=(0,n.useState)(!1),[x,g]=(0,n.useState)(null),[p,f]=(0,n.useState)(null),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)({kind:"amazon_search",captureMode:"runner",captureProfile:"",marketplace:"de",query:"",url:"",maxResults:"20"});(0,n.useEffect)(()=>{l&&y(e=>{var t,s;return{...e,query:e.query||(null==(t=l.lead)?void 0:t.title)||"",url:e.url||(null==(s=l.lead)?void 0:s.url)||""}})},[l]);let j=(0,n.useCallback)(async()=>{if("runner"===v.captureMode){h(!0);try{var e;let t=await fetch("/api/runner/status");if(!t.ok)return void f(null);let s=await t.json().catch(()=>null);f(null!=(e=null==s?void 0:s.runner)?e:null)}catch(e){console.error(e),f(null)}finally{h(!1)}}},[v.captureMode]);(0,n.useEffect)(()=>{if("runner"!==v.captureMode)return;j();let e=setInterval(j,15e3);return()=>clearInterval(e)},[v.captureMode,j]);let N=(0,n.useMemo)(()=>i.some(e=>"M"===e.stage&&("queued"===e.status||"running"===e.status)),[i]),w=(0,n.useMemo)(()=>i.find(e=>"M"===e.stage&&"succeeded"===e.status),[i]),k=(0,n.useMemo)(()=>(function(e){var t;if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let s=e.output,r=(t=s.captureMeta)&&"object"==typeof t?t:null;return{kind:Z(s.kind),marketplace:Z(s.marketplace),query:Z(s.query),url:Z(s.url),priceMin:W(s.priceMin),priceMax:W(s.priceMax),priceMedian:W(s.priceMedian),reviewMedian:W(s.reviewMedian),sponsoredShare:W(s.sponsoredShare),sampleCount:function(e){if(!Array.isArray(e))return null;let t=e.filter(e=>"number"==typeof e).length;return t>0?t:null}(s.priceSample),generatedAt:Z(s.generatedAt),captureMode:Z(null==r?void 0:r.mode),headless:Q(null==r?void 0:r.headless),humanGate:Q(null==r?void 0:r.humanGate),humanGateOutcome:Z(null==r?void 0:r.humanGateOutcome),playbook:Z(null==r?void 0:r.playbook),sessionProfile:Z(null==r?void 0:r.sessionProfile),durationMs:W(null==r?void 0:r.durationMs)}})(w),[w]),C=!!(null==l||null==(t=l.cooldown)?void 0:t.active),S=C?d.cooldown.activeMessage:N?d.stageM.queueingLabel:l?d.stageM.readyLabel:d.notAvailable,R=c||o||!l||C,M=(0,n.useMemo)(()=>{if("runner"!==v.captureMode)return null;if(b&&!p)return d.stageM.runnerStatusChecking;if(!p)return d.stageM.runnerStatusUnknown;let e=[p.stale?d.stageM.runnerStatusStale:d.stageM.runnerStatusReady],t=function(e,t){if(!e)return t;let s=Date.parse(e);if(!Number.isFinite(s))return t;let r=Math.max(0,Date.now()-s);if(r<1e3)return"now";let n=Math.floor(r/1e3);if(n<60)return"".concat(n,"s");let a=Math.floor(n/60);if(a<60)return"".concat(a,"m");let l=Math.floor(a/60);return"".concat(l,"h")}(p.lastSeen,d.notAvailable);return p.lastSeen&&e.push("".concat(d.stageM.runnerStatusLastSeen,": ").concat(t)),p.mode&&e.push("".concat(d.stageM.runnerStatusMode,": ").concat(p.mode)),null!==p.headless&&void 0!==p.headless&&e.push("".concat(d.stageM.runnerStatusBrowser,": ").concat(p.headless?d.stageM.summaryHeadlessOn:d.stageM.summaryHeadlessOff)),p.sessionProfile&&e.push("".concat(d.stageM.runnerStatusSession,": ").concat(p.sessionProfile)),e.join(" | ")},[v.captureMode,p,b,d.stageM,d.notAvailable]),P=p&&!1===p.stale?"text-emerald-600":p&&p.stale?"text-amber-600":"text-foreground/60",D=(0,n.useCallback)(async e=>{var t,r,n,a,i,o,c,x;if(e.preventDefault(),!l)return;g(null),m(!0);let p=v.marketplace.trim(),f=v.query.trim(),b=v.url.trim(),h=v.captureProfile.trim(),y=Number.parseInt(v.maxResults,10),j=Number.isFinite(y)?y:void 0;if(h&&!$.test(h)){g({tone:"error",text:d.stageM.captureProfileErrorInvalid}),m(!1);return}if("runner"===v.captureMode&&!h){g({tone:"error",text:d.stageM.captureProfileErrorRequired}),m(!1);return}let N={candidateId:s,kind:v.kind,captureMode:v.captureMode,...j?{maxResults:j}:{},...h?{captureProfile:h}:{}};if("amazon_search"===v.kind){let e=f||(null==(r=l.lead)||null==(t=r.title)?void 0:t.trim())||"";if(!e||!p){g({tone:"error",text:d.stageM.errorMessage}),m(!1);return}N.query=e,N.marketplace=p}if("amazon_listing"===v.kind){let e=b||(null==(a=l.lead)||null==(n=a.url)?void 0:n.trim())||"";if(!e||!p){g({tone:"error",text:d.stageM.errorMessage}),m(!1);return}N.url=e,N.marketplace=p}if("taobao_listing"===v.kind){let e=b||(null==(o=l.lead)||null==(i=o.url)?void 0:i.trim())||"";if(!e){g({tone:"error",text:d.stageM.errorMessage}),m(!1);return}N.url=e}try{let e=await fetch("/api/stages/m/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)}),t=await e.json().catch(()=>null);if(e.ok)g({tone:"success",text:d.stageM.successMessage});else{let e=null==t||null==(c=t.details)?void 0:c.reasonCode,s=null==t||null==(x=t.details)?void 0:x.site,r=d.stageM.budgetMessage.replace("{site}","taobao"===s?"Taobao":"Amazon"),n=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):(null==t?void 0:t.error)==="budget_exceeded"?r:(null==t?void 0:t.error)==="capture_profile_required"?d.stageM.captureProfileErrorRequired:(null==t?void 0:t.error)==="capture_profile_invalid"?d.stageM.captureProfileErrorInvalid:(null==t?void 0:t.error)==="capture_profile_not_allowed"?d.stageM.captureProfileErrorNotAllowed:d.stageM.errorMessage;g({tone:"error",text:n})}}catch(e){console.error(e),g({tone:"error",text:d.stageM.errorMessage})}finally{m(!1),await u()}},[l,s,v,u,d.stageM,d.cooldown]);return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageM.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageM.title})]}),(0,r.jsx)(Y,{summary:k,strings:d.stageM,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:D,children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.kindLabel,(0,r.jsxs)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.kind,onChange:e=>y(t=>({...t,kind:e.target.value})),disabled:R,children:[(0,r.jsx)("option",{value:"amazon_search",children:d.stageM.kindAmazonSearch}),(0,r.jsx)("option",{value:"amazon_listing",children:d.stageM.kindAmazonListing}),(0,r.jsx)("option",{value:"taobao_listing",children:d.stageM.kindTaobaoListing})]})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.captureModeLabel,(0,r.jsxs)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.captureMode,onChange:e=>{let t=e.target.value;y(e=>({...e,captureMode:t,captureProfile:"runner"===t?e.captureProfile:""}))},disabled:R,children:[(0,r.jsx)("option",{value:"queue",children:d.stageM.captureModeQueue}),(0,r.jsx)("option",{value:"runner",children:d.stageM.captureModeRunner})]})]}),"runner"===v.captureMode&&(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.captureProfileLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.captureProfile,onChange:e=>y(t=>({...t,captureProfile:e.target.value})),disabled:R,type:"text",placeholder:d.stageM.captureProfilePlaceholder,pattern:$.source}),(0,r.jsx)("span",{className:"mt-2 block text-xs text-foreground/60 normal-case tracking-normal",children:d.stageM.captureProfileHelp})]}),"runner"===v.captureMode&&(0,r.jsxs)("div",{className:"md:col-span-2 rounded-2xl border border-border-1 bg-surface-1 px-3 py-2 text-xs",children:[(0,r.jsx)("span",{className:"block text-xs uppercase tracking-widest text-foreground/60",children:d.stageM.runnerStatusLabel}),(0,r.jsx)("span",{className:"mt-1 block ".concat(P),children:null!=M?M:d.stageM.runnerStatusUnknown})]}),("amazon_search"===v.kind||"amazon_listing"===v.kind)&&(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.marketplaceLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.marketplace,onChange:e=>y(t=>({...t,marketplace:e.target.value})),disabled:R,type:"text"})]}),"amazon_search"===v.kind&&(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.queryLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.query,onChange:e=>y(t=>({...t,query:e.target.value})),disabled:R,type:"text"})]}),("amazon_listing"===v.kind||"taobao_listing"===v.kind)&&(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.urlLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.url,onChange:e=>y(t=>({...t,url:e.target.value})),disabled:R,type:"url"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageM.maxResultsLabel,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:v.maxResults,onChange:e=>y(t=>({...t,maxResults:e.target.value})),disabled:R,type:"number",min:1,max:100})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[x?(0,r.jsx)("span",{className:"success"===x.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:x.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:S}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:c||N||o||!l||C,children:c?d.stageM.queueingLabel:d.stageM.runLabel})]})]})]})}function ee(e){var t,s,n,l,i,o,d;let{summary:u,strings:c,notAvailable:m}=e;if(!u)return null;let x=function(e,t,s){if(!e)return s;switch(e){case"not_started":return t.notStarted;case"in_progress":return t.inProgress;case"waiting_on_supplier":return t.waitingOnSupplier;case"terms_improved":return t.termsImproved;case"no_progress":return t.noProgress;default:return s}}(null!=(t=u.status)?t:null,c.statuses,m);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:c.summaryStatus}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:x})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:c.summarySupplier}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(s=u.supplierName)?s:m})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:c.summaryTargetUnitCost}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:function(e,t){if(!e)return t;try{return(0,g.vv)(BigInt(e))}catch(e){return t}}(u.targetUnitCostCents,m)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:c.summaryTargetMoq}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(n=u.targetMoq)?n:m})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-xs text-foreground/60",children:[c.summaryLeadTime,": ",null!=(l=u.targetLeadTimeDays)?l:m," \xb7"," ",c.summaryDeposit,": ",null!=(i=u.targetDepositPct)?i:m,null!==u.targetDepositPct&&void 0!==u.targetDepositPct?"%":""," ","\xb7 ",c.summaryPaymentTerms,": ",null!=(o=u.targetPaymentTerms)?o:m," ","\xb7 ",c.summaryIncoterms,": ",null!=(d=u.targetIncoterms)?d:m]}),(0,r.jsxs)("div",{className:"mt-4 rounded-2xl border border-border-1 bg-surface-2 px-4 py-3 text-sm",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:c.summaryTasks}),u.tasks&&u.tasks.length>0?(0,r.jsx)(a.BJ,{gap:1,className:"mt-2 text-xs text-foreground/70",children:u.tasks.map((e,t)=>(0,r.jsx)("div",{children:e},"".concat(e,"-").concat(t)))}):(0,r.jsx)("div",{className:"mt-2 text-xs text-foreground/60",children:c.summaryTasksEmpty})]})]})}function et(e){let{form:t,setForm:s,disabled:n,strings:a,statusOptions:l,onEdit:i}=e,o=e=>t=>{let r=t.target.value;s(t=>({...t,[e]:r})),i()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputStatus,(0,r.jsx)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.status,onChange:e=>{s(t=>({...t,status:e.target.value})),i()},disabled:n,children:l.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputSupplier,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.supplierName,onChange:o("supplierName"),disabled:n,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetUnitCost,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetUnitCost,onChange:o("targetUnitCost"),disabled:n,type:"number",min:0,step:"0.01"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetMoq,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetMoq,onChange:o("targetMoq"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetLeadTime,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetLeadTimeDays,onChange:o("targetLeadTimeDays"),disabled:n,type:"number",min:0,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetDepositPct,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetDepositPct,onChange:o("targetDepositPct"),disabled:n,type:"number",min:0,max:100,step:"1"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetPaymentTerms,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetPaymentTerms,onChange:o("targetPaymentTerms"),disabled:n,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[a.inputTargetIncoterms,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.targetIncoterms,onChange:o("targetIncoterms"),disabled:n,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputTasks,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.tasks,onChange:o("tasks"),disabled:n})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[a.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:t.notes,onChange:o("notes"),disabled:n})]})]})}let es={status:"not_started",supplierName:"",targetUnitCost:"",targetMoq:"",targetLeadTimeDays:"",targetDepositPct:"",targetPaymentTerms:"",targetIncoterms:"",tasks:"",notes:""};function er(e){let t=e.trim();if(!t)return;let s=Number.parseInt(t,10);return!Number.isFinite(s)||s<0?null:s}function en(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"N"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(es),[p,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),j=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t,s,r,n,a;p||g((e=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c))?{status:null!=(t=e.status)?t:"not_started",supplierName:null!=(s=e.supplierName)?s:"",targetUnitCost:void 0!==e.targetUnitCostCents?String(e.targetUnitCostCents/100):"",targetMoq:void 0!==e.targetMoq?String(e.targetMoq):"",targetLeadTimeDays:void 0!==e.targetLeadTimeDays?String(e.targetLeadTimeDays):"",targetDepositPct:void 0!==e.targetDepositPct?String(e.targetDepositPct):"",targetPaymentTerms:null!=(r=e.targetPaymentTerms)?r:"",targetIncoterms:null!=(n=e.targetIncoterms)?n:"",tasks:e.tasks?e.tasks.join(", "):"",notes:null!=(a=e.notes)?a:""}:es)},[p,c]);let N=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;y(null),h(!0);let t=function(e){let t=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0?null:Math.round(100*s)}(e.targetUnitCost),s=er(e.targetMoq),r=er(e.targetLeadTimeDays),n=function(e){let t=e.trim();if(!t)return;let s=Number.parseFloat(t);return!Number.isFinite(s)||s<0||s>100?null:s}(e.targetDepositPct);if(null===t||null===s||null===r||null===n)return null;let a=e.supplierName.trim(),l=e.targetPaymentTerms.trim(),i=e.targetIncoterms.trim();return{status:e.status,...a?{supplierName:a}:{},...void 0!==t?{targetUnitCostCents:t}:{},...void 0!==s?{targetMoq:s}:{},...void 0!==r?{targetLeadTimeDays:r}:{},...void 0!==n?{targetDepositPct:n}:{},...l?{targetPaymentTerms:l}:{},...i?{targetIncoterms:i}:{}}}(x);if(!t){y({tone:"error",text:d.stageN.errorInvalid}),h(!1);return}let r=x.tasks.split(/[\n,]/).map(e=>e.trim()).filter(Boolean),n={candidateId:s,...t,...r.length?{tasks:r}:{},...x.notes.trim()?{notes:x.notes.trim()}:{}};try{let e=await fetch("/api/stages/n/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json().catch(()=>null);if(e.ok)y({tone:"success",text:d.stageN.success});else{var a;let e=null==t||null==(a=t.details)?void 0:a.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageN.errorRun;y({tone:"error",text:s})}}catch(e){console.error(e),y({tone:"error",text:d.stageN.errorRun})}finally{h(!1),await u()}},[l,s,x,u,d.cooldown,d.stageN]),w=b||o||j,k=[{value:"not_started",label:d.stageN.statuses.notStarted},{value:"in_progress",label:d.stageN.statuses.inProgress},{value:"waiting_on_supplier",label:d.stageN.statuses.waitingOnSupplier},{value:"terms_improved",label:d.stageN.statuses.termsImproved},{value:"no_progress",label:d.stageN.statuses.noProgress}];return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageN.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageN.title})]}),(0,r.jsx)(ee,{summary:m,strings:d.stageN,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:N,children:[(0,r.jsx)(et,{form:x,setForm:g,disabled:w,strings:d.stageN,statusOptions:k,onEdit:()=>f(!0)}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[v?(0,r.jsx)("span",{className:"success"===v.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:v.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:j?d.cooldown.activeMessage:d.stageN.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:w,children:d.stageN.runLabel})]})]})]})}function ea(e){return e&&0!==e.length?e.join(", "):""}function el(e){return e.split(/[,\n]/).map(e=>e.trim()).filter(Boolean)}function ei(e,t,s){if(null==e)return s;let r=t?t.toUpperCase():s;return"".concat(e," (").concat(r,")")}let eo={riskScore:"50",effortScore:"50",riskDrivers:"",effortDrivers:"",notes:""};function ed(e){var t,s;let{candidateId:l,candidate:i,stageRuns:o,loading:d,strings:u,onRun:c}=e,m=(0,n.useMemo)(()=>o.find(e=>"R"===e.stage),[o]),x=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(m),[m]),[p,f]=(0,n.useState)(eo),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),w=!!(null==i||null==(t=i.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e;if(b)return;let t=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(m);if(!t)return void f(eo);f({riskScore:void 0!==t.riskScore?String(t.riskScore):"50",effortScore:void 0!==t.effortScore?String(t.effortScore):"50",riskDrivers:ea(t.riskDrivers),effortDrivers:ea(t.effortDrivers),notes:null!=(e=t.notes)?e:""})},[b,m]);let k=(0,n.useCallback)(async e=>{e.preventDefault(),N(null),y(!0);let t=Number.parseFloat(p.riskScore),s=Number.parseFloat(p.effortScore);if(!Number.isFinite(t)||!Number.isFinite(s)||t<0||t>100||s<0||s>100){N({tone:"error",text:u.stageR.errorInvalid}),y(!1);return}let r={candidateId:l,riskScore:t,effortScore:s,riskDrivers:el(p.riskDrivers),effortDrivers:el(p.effortDrivers),...p.notes.trim()?{notes:p.notes.trim()}:{}};try{let e=await fetch("/api/stages/r/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json().catch(()=>null);if(e.ok)N({tone:"success",text:u.stageR.success});else{var n;let e=null==t||null==(n=t.details)?void 0:n.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(u.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):u.stageR.errorRun;N({tone:"error",text:s})}}catch(e){console.error(e),N({tone:"error",text:u.stageR.errorRun})}finally{y(!1),await c()}},[l,p.effortDrivers,p.effortScore,p.notes,p.riskDrivers,p.riskScore,c,u.cooldown.activeMessage,u.stageR.errorInvalid,u.stageR.errorRun,u.stageR.success]),C=null!=(s=null==x?void 0:x.nextAction)?s:null,S="ADVANCE"===C?u.stageR.nextActions.advance:"REVIEW_RISK"===C?u.stageR.nextActions.reviewRisk:"REVIEW_EFFORT"===C?u.stageR.nextActions.reviewEffort:"NEED_STAGE_K"===C?u.stageR.nextActions.needStageK:u.notAvailable;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:u.stageR.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:u.stageR.title})]}),x?(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageR.summaryRisk}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:ei(x.riskScore,x.riskBand,u.notAvailable)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageR.summaryEffort}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:ei(x.effortScore,x.effortBand,u.notAvailable)})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageR.summaryRank}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!==x.rankScore&&void 0!==x.rankScore?(0,g.l9)(x.rankScore):u.notAvailable})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:u.stageR.summaryNext}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:S})]})]}):null,(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:k,children:[(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[u.stageR.inputRiskScore,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p.riskScore,onChange:e=>{f(t=>({...t,riskScore:e.target.value})),h(!0)},disabled:v||w,type:"number",min:0,max:100})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[u.stageR.inputEffortScore,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p.effortScore,onChange:e=>{f(t=>({...t,effortScore:e.target.value})),h(!0)},disabled:v||w,type:"number",min:0,max:100})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[u.stageR.inputRiskDrivers,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p.riskDrivers,onChange:e=>{f(t=>({...t,riskDrivers:e.target.value})),h(!0)},disabled:v||w})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[u.stageR.inputEffortDrivers,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p.effortDrivers,onChange:e=>{f(t=>({...t,effortDrivers:e.target.value})),h(!0)},disabled:v||w})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[u.stageR.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-20 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:p.notes,onChange:e=>{f(t=>({...t,notes:e.target.value})),h(!0)},disabled:v||w})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[j?(0,r.jsx)("span",{className:"success"===j.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:j.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:w?u.cooldown.activeMessage:u.stageR.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:v||d||w,children:u.stageR.runLabel})]})]})]})}function eu(e){var t,s,n,l;let{summary:i,strings:o,notAvailable:d}=e;if(!i)return null;let u=null!=(s=i.overallRisk)?s:null,c=null!=(n=i.action)?n:null,m="ADVANCE"===c?o.actions.advance:"REVIEW"===c?o.actions.review:"BLOCK"===c?o.actions.block:d,x="high"===u?o.riskBands.high:"medium"===u?o.riskBands.medium:"low"===u?o.riskBands.low:d,p=null!==i.matchingConfidence&&void 0!==i.matchingConfidence?"".concat((0,g.ZV)(i.matchingConfidence),"%"):d,f=(null==(t=i.flaggedCategories)?void 0:t.length)&&i.flaggedCategories.length>0?i.flaggedCategories.join(", "):d;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryOverallRisk}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:x})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryScore}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:null!=(l=i.feasibilityScore)?l:d})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryMatchingConfidence}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:p})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsx)("div",{className:"text-xs text-foreground/60",children:o.summaryAction}),(0,r.jsx)("div",{className:"mt-1 text-sm font-semibold",children:m})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-xs text-foreground/60",children:[o.summaryFlags,": ",f]})]})}let ec={complianceRisk:"medium",ipRisk:"medium",hazmatRisk:"low",shippingRisk:"medium",listingRisk:"medium",packagingRisk:"medium",matchingConfidence:"60",artifactsRequired:"",notes:""};function em(e){var t;let{candidateId:s,candidate:l,stageRuns:i,loading:o,strings:d,onRun:u}=e,c=(0,n.useMemo)(()=>i.find(e=>"S"===e.stage),[i]),m=(0,n.useMemo)(()=>(function(e){if(!(null==e?void 0:e.output)||"object"!=typeof e.output)return null;let t=e.output.summary;return t&&"object"==typeof t?t:null})(c),[c]),[x,g]=(0,n.useState)(ec),[p,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),j=!!(null==l||null==(t=l.cooldown)?void 0:t.active);(0,n.useEffect)(()=>{var e,t,s,r,n,a,l,i;if(p)return;let o=function(e){if(!(null==e?void 0:e.input)||"object"!=typeof e.input)return null;if("input"in e.input){let t=e.input.input;if(t&&"object"==typeof t)return t}return e.input}(c);if(!o)return void g(ec);g({complianceRisk:null!=(e=o.complianceRisk)?e:"medium",ipRisk:null!=(t=o.ipRisk)?t:"medium",hazmatRisk:null!=(s=o.hazmatRisk)?s:"low",shippingRisk:null!=(r=o.shippingRisk)?r:"medium",listingRisk:null!=(n=o.listingRisk)?n:"medium",packagingRisk:null!=(a=o.packagingRisk)?a:"medium",matchingConfidence:void 0!==o.matchingConfidence?String(o.matchingConfidence):"60",artifactsRequired:(i=o.artifactsRequired)&&0!==i.length?i.join(", "):"",notes:null!=(l=o.notes)?l:""})},[p,c]);let N=(0,n.useCallback)(async e=>{if(e.preventDefault(),!l)return;y(null),h(!0);let t=x.matchingConfidence.trim(),r=""===t?void 0:Number.parseFloat(t);if(void 0!==r&&(!Number.isFinite(r)||r<0||r>100)){y({tone:"error",text:d.stageS.errorInvalid}),h(!1);return}let n={candidateId:s,complianceRisk:x.complianceRisk,ipRisk:x.ipRisk,hazmatRisk:x.hazmatRisk,shippingRisk:x.shippingRisk,listingRisk:x.listingRisk,packagingRisk:x.packagingRisk,...void 0!==r?{matchingConfidence:r}:{}},a=x.artifactsRequired.split(/[,\n]/).map(e=>e.trim()).filter(Boolean);a.length>0&&(n.artifactsRequired=a),x.notes.trim()&&(n.notes=x.notes.trim());try{let e=await fetch("/api/stages/s/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json().catch(()=>null);if(e.ok)y({tone:"success",text:d.stageS.success});else{var i;let e=null==t||null==(i=t.details)?void 0:i.reasonCode,s=(null==t?void 0:t.error)==="cooldown_active"?"".concat(d.cooldown.activeMessage).concat(e?" (".concat(e,")"):""):d.stageS.errorRun;y({tone:"error",text:s})}}catch(e){console.error(e),y({tone:"error",text:d.stageS.errorRun})}finally{h(!1),await u()}},[l,s,x,u,d.cooldown,d.stageS]),w=[{key:"complianceRisk",label:d.stageS.inputComplianceRisk},{key:"ipRisk",label:d.stageS.inputIpRisk},{key:"hazmatRisk",label:d.stageS.inputHazmatRisk},{key:"shippingRisk",label:d.stageS.inputShippingRisk},{key:"listingRisk",label:d.stageS.inputListingRisk},{key:"packagingRisk",label:d.stageS.inputPackagingRisk}],k=[{value:"low",label:d.stageS.riskBands.low},{value:"medium",label:d.stageS.riskBands.medium},{value:"high",label:d.stageS.riskBands.high}];return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:d.stageS.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d.stageS.title})]}),(0,r.jsx)(eu,{summary:m,strings:d.stageS,notAvailable:d.notAvailable}),(0,r.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2",onSubmit:N,children:[w.map(e=>(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[e.label,(0,r.jsx)("select",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x[e.key],onChange:t=>{g(s=>({...s,[e.key]:t.target.value})),f(!0)},disabled:b||j,children:k.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]},e.key)),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60",children:[d.stageS.inputMatchingConfidence,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x.matchingConfidence,onChange:e=>{g(t=>({...t,matchingConfidence:e.target.value})),f(!0)},disabled:b||j,type:"number",min:0,max:100})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[d.stageS.inputArtifactsRequired,(0,r.jsx)("input",{className:"mt-2 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x.artifactsRequired,onChange:e=>{g(t=>({...t,artifactsRequired:e.target.value})),f(!0)},disabled:b||j,type:"text"})]}),(0,r.jsxs)("label",{className:"text-xs uppercase tracking-widest text-foreground/60 md:col-span-2",children:[d.stageS.inputNotes,(0,r.jsx)("textarea",{className:"mt-2 min-h-24 w-full rounded-2xl border border-border-1 bg-surface-2 px-3 py-2 text-sm text-foreground shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",value:x.notes,onChange:e=>{g(t=>({...t,notes:e.target.value})),f(!0)},disabled:b||j})]}),(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-3 md:col-span-2",children:[v?(0,r.jsx)("span",{className:"success"===v.tone?"text-xs text-emerald-600":"text-xs text-red-600",children:v.text}):(0,r.jsx)("span",{className:"text-xs text-foreground/60",children:j?d.cooldown.activeMessage:d.stageS.inputHelp}),(0,r.jsx)("button",{className:"min-h-12 min-w-12 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground disabled:cursor-not-allowed disabled:opacity-60",type:"submit",disabled:b||o||j,children:d.stageS.runLabel})]})]})]})}function ex(e){let{stageRuns:t,strings:s}=e;return(0,r.jsxs)("section",{className:"pp-card p-6",children:[(0,r.jsxs)(a.BJ,{gap:2,children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-widest text-foreground/60",children:s.stageRuns.label}),(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:s.stageRuns.title})]}),(0,r.jsx)(a.BJ,{gap:3,className:"mt-4 text-sm",children:0===t.length?(0,r.jsx)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3 text-foreground/60",children:s.notAvailable}):t.map(e=>(0,r.jsxs)("div",{className:"rounded-2xl border border-border-1 bg-surface-2 px-4 py-3",children:[(0,r.jsxs)(a.d2,{justify:"between",alignY:"center",className:"gap-4",children:[(0,r.jsxs)(a.BJ,{gap:1,children:[(0,r.jsxs)("span",{className:"text-xs text-foreground/60",children:[s.stageRuns.stageLabel,": ",e.stage]}),(0,r.jsxs)("span",{className:"text-sm font-semibold",children:[s.stageRuns.statusLabel,": ",e.status]})]}),(0,r.jsxs)("span",{className:"text-xs text-foreground/60",children:[s.stageRuns.createdLabel,":"," ",i(e.createdAt,s.notAvailable)]})]}),(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"text-xs text-foreground/60",children:[s.stageRuns.startedLabel,":"," ",i(e.startedAt,s.notAvailable)]}),(0,r.jsxs)("div",{className:"text-xs text-foreground/60",children:[s.stageRuns.finishedLabel,":"," ",i(e.finishedAt,s.notAvailable)]}),(0,r.jsxs)("div",{className:"text-xs text-foreground/60",children:[s.stageRuns.statusLabel,": ",e.status]})]}),(0,r.jsxs)(a.xA,{cols:1,gap:3,className:"mt-3 md:grid-cols-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:s.stageRuns.inputLabel}),(0,r.jsx)("pre",{className:"mt-2 max-h-40 overflow-auto whitespace-pre-wrap break-words rounded-xl bg-surface-1 p-3 text-xs text-foreground/70",children:l(e.input)||s.notAvailable})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:s.stageRuns.outputLabel}),(0,r.jsx)("pre",{className:"mt-2 max-h-40 overflow-auto whitespace-pre-wrap break-words rounded-xl bg-surface-1 p-3 text-xs text-foreground/70",children:l(e.output)||s.notAvailable})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-foreground/60",children:s.stageRuns.errorLabel}),(0,r.jsx)("pre",{className:"mt-2 max-h-40 overflow-auto whitespace-pre-wrap break-words rounded-xl bg-surface-1 p-3 text-xs text-foreground/70",children:l(e.error)||s.notAvailable})]})]})]},e.id))})]})}function eg(e){let{candidateId:t,strings:s}=e,[l,i]=(0,n.useState)(null),[c,g]=(0,n.useState)([]),[p,f]=(0,n.useState)([]),[b,h]=(0,n.useState)(!0),v=(0,n.useCallback)(async()=>{h(!0);try{let r=await fetch("/api/candidates/".concat(t));if(!r.ok)return;let n=await r.json();if(n.ok&&n.candidate){var e,s;i(n.candidate),g(null!=(e=n.stageRuns)?e:[]),f(null!=(s=n.artifacts)?s:[])}}catch(e){console.error(e)}finally{h(!1)}},[t]);return(0,n.useEffect)(()=>{v()},[v]),(0,r.jsxs)(a.BJ,{gap:6,children:[(0,r.jsxs)(a.xA,{cols:1,gap:4,className:"md:grid-cols-2",children:[(0,r.jsx)(u,{candidate:l,strings:s}),(0,r.jsx)(x,{candidate:l,strings:s})]}),(0,r.jsx)(X,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onQueued:v}),(0,r.jsx)(y,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(em,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(en,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(U,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(P,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(I,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(H,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(ed,{candidateId:t,candidate:l,stageRuns:c,loading:b,strings:s,onRun:v}),(0,r.jsx)(m,{candidateId:t,candidate:l,loading:b,strings:s,onUpdated:v}),(0,r.jsx)(ex,{stageRuns:c,strings:s}),(0,r.jsx)(d,{candidateId:t,stageRuns:c,loading:b,strings:s,onUploaded:v}),(0,r.jsx)(o,{artifacts:p,strings:s})]})}},5480:(e,t,s)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-GB",s=Number(e)/100;return Number.isFinite(s)?new Intl.NumberFormat(t,{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(s):"-"}function n(e){return null==e||Number.isNaN(e)?"-":new Intl.NumberFormat("en-GB",{maximumFractionDigits:2}).format(e)}function a(e){return null==e||Number.isNaN(e)?"-":new Intl.NumberFormat("en-GB",{style:"percent",maximumFractionDigits:1}).format(e)}s.d(t,{ZV:()=>n,l9:()=>a,vv:()=>r})},9799:(e,t,s)=>{Promise.resolve().then(s.bind(s,773)),Promise.resolve().then(s.bind(s,6423)),Promise.resolve().then(s.bind(s,368)),Promise.resolve().then(s.bind(s,8634)),Promise.resolve().then(s.bind(s,5016)),Promise.resolve().then(s.bind(s,9602)),Promise.resolve().then(s.bind(s,9633)),Promise.resolve().then(s.bind(s,1875)),Promise.resolve().then(s.bind(s,6884)),Promise.resolve().then(s.bind(s,5216)),Promise.resolve().then(s.bind(s,124)),Promise.resolve().then(s.bind(s,4274))}},e=>{var t=t=>e(e.s=t);e.O(0,[2827,9683,7106,4668,8902,9956,2459,7358],()=>t(9799)),_N_E=e.O()}]);